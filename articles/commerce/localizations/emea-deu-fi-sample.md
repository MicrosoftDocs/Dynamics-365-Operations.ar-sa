---
title: عينة تكامل خدمة التسجيل المالي لألمانيا
description: يقدم هذا المقال نظرة عامة على عينة التكامل المالي لألمانيا في Microsoft Dynamics 365 Commerce.
author: EvgenyPopovMBS
ms.date: 10/04/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: josaw
ms.search.validFrom: 2020-05-29
ms.openlocfilehash: a725badbce498e4e7b35aecb2500e273586c7b77
ms.sourcegitcommit: 2bc6680dc6b12d20532d383a0edb84d180885b62
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 10/06/2022
ms.locfileid: "9631443"
---
# <a name="fiscal-registration-service-integration-sample-for-germany"></a>عينة تكامل خدمة التسجيل المالي لألمانيا

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

يقدم هذا المقال نظرة عامة على عينة التكامل المالي لألمانيا في Microsoft Dynamics 365 Commerce.

للوفاء بالمتطلبات المالية المحلية لسجلات النقد في ألمانيا، تتضمن وظيفة Dynamics 365 Commerce لألمانيا عينة تكامل لنقطة البيع (POS) مع خدمة تسجيل مالية خارجية. ويقوم النموذج بتوسيع [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md). وهو يستند إلى حل [EFR (السجل المالي الإلكتروني)](https://www.efsta.eu/de/fiskalloesungen/deutschland) من [EFSTA](https://www.efsta.eu/de/) ويقوم بتمكين الاتصال بخدمة EFR من خلال بروتوكول HTTPS. يجب استضافة خدمة EFR إما على محطة أجهزة البيع بالتجزئة أو على كمبيوتر منفصل يمكن توصيله من محطة الأجهزة. يتم توفير العينة في شكل كود المصدر وهو جزء من مجموعة تطوير برامج التجارة (SDK).

لا تصدر Microsoft إيه أجهزه أو برامج أو وثائق من EFSTA. للحصول علي معلومات حول كيفيه الحصول علي حل EFR وتشغيله، اتصل بـ [EFSTA](https://www.efsta.eu/de/kontakt/kontakt).

## <a name="scenarios"></a>السيناريوهات

تغطي السيناريوهات التالية نموذج تكامل خدمه التسجيل المالي لألمانيا.

### <a name="sales-operations"></a>عمليات المبيعات

- **تسجيل المبيعات والمرتجعات نقدًا وبالاستلام في خدمة التسجيل الضريبي:**

    يتضمن تسجيل عمليات المبيعات الخطوات التالية:

    1. بدء تسجيل الحركة

        يتم تسجيل بداية كل حركه في عنصر الأمان التقني (TSE) المتصل بخدمه EFR. كنتيجة للتسجيل، تقوم TSE بتعيين معرف المعاملة (TID).

    2. بدء تسجيل الحركة

        عند إتمام المعاملة في نقطة البيع، يتم تسجيلها باستخدام نفس TID الذي تم تعيينه أثناء تسجيل بدء المعاملة. في تلك اللحظة، يتم إرسال بيانات المعاملات التفصيلية إلى خدمة التسجيل المالي. تشتمل هذه البيانات علي معلومات بند المبيعات، ومعلومات حول الخصومات والمدفوعات والضرائب.

    3. الحصول على رد من خدمة التسجيل المالي

        يتم استلام بيانات الأمان من TSE كجزء من الاستجابة ويتم حفظها في المعاملة في قاعدة بيانات القناة. تتكون بيانات الأمان من المعلومات التالية:

        - TID
        - تاريخ ووقت بدء المعاملة
        - تاريخ ووقت نهاية المعاملة
        - عداد التوقيع
        - التحقق من القيمة
        - الرقم التسلسلي لـ TSE

- **تسجيل أوامر العميل في خدمه التسجيل المالي:** تعتبر عمليه التسجيل هي نفس عمليه المبيعات والعائدات الخاصة بالنقد.
- **تسجيل العمليات التي تشمل بطاقات الهدايا والودائع:** تعتبر عمليه التسجيل هي نفس عمليه المبيعات والعائدات الخاصة بالنقد.

#### <a name="notifying-users-about-fiscal-registration-failures"></a>اعلام المستخدمين بفشل التسجيل المالي

ويمكن لخدمه التسجيل المالي اعلام المستخدمين بالحالات التي حدثت اثناء التسجيل المالي:

- يستخدم في طباعه معلومات اضافيه من الاستجابة الموجودة في حقل **رسالة المعلومات** في إيصالات الاستلام.
- إظهار الإخطارات من الخدمة المالية كرسائل مستخدم في نقطه البيع.

    > [!NOTE]
    > تتطلب آلية الإعلام هذه تشغيل المعلمة **إظهار إشعارات التسجيل المالي** في **ملفات التعريف الفنية للموصل**.

#### <a name="printing-receipts"></a>تتم الآن طباعة الإيصالات

تعتبر طباعه الإيصال أمرا إلزاميا في ألمانيا. يجب ان تحتوي كافة عمليات الاستلام علي الأقل علي المعلومات التالية:

- اسم وعنوان الشركة
- معلومات عن البضائع، بما في ذلك أسعارها وكمياتها
- معلومات حول المدفوعات التي تم استلامها
- معلومات حول الضرائب، بما في ذلك المبالغ الاجماليه لكل سعر ضريبة
- بيانات الأمان:

    - TID
    - تاريخ ووقت بدء المعاملة
    - تاريخ ووقت نهاية المعاملة
    - عداد التوقيع
    - التحقق من القيمة
    - الرقم التسلسلي لـ TSE

- رسالة إخبارية

> [!NOTE]
> يمكن أيضا طباعه شفره الاستجابة السريعة علي عمليات الاستلام. علي الرغم من ان شفره الاستجابة السريعة اختياريه، الا انه يوصي بها بشده. لمزيد من المعلومات حول كيفيه الحصول علي رمز الاستجابة السريعة (QR) كجزء من خدمه التسجيل المالي، راجع مستند "دليل EFR \[DE\]" الذي تم نشره على موقع ويب [مستندات EFSTA](https://public.efsta.net/efr/).
>
> يعرض حقل **رسالة المعلومات** في الإيصالات اخطارا من خدمه التسجيل المالي. علي سبيل المثال، في حاله انقطاع جهاز توقيع، يمكن طباعه النص الخاص علي الإيصال.

#### <a name="voided-suspended-and-recalled-transactions"></a>المعاملات المبطلة والمعلقة والمسترجعة

- يتم تسجيل حركه ملغاه كطلب لإنهاء أحدي الحركات في خدمه التسجيل المالي.
- يتم تسجيل المعاملة المعلقة كطلب لإنهاء معاملة في خدمة التسجيل المالي.
- يتم تسجيل استدعاء المعاملة المعلقة كبداية معاملة جديدة في خدمة التسجيل المالي.

### <a name="non-sales-transactions-and-shift-closing"></a>المعاملات غير البيعية وإغلاق المناوبة

يتم تسجيل الحركات غير المتعلقة بالمبيعات التالية كعمليات غير مالية في خدمة التسجيل المالي باستخدام علامة **NFS**:

- الإعلان عن مبلغ البدء
- إدخال عائم
- إزالة طريقة الدفع
- إيداع بالخزينة
- إيداع بنكي
- حسابات الإيرادات
- حسابات المصروفات

يتم أيضًا تسجيل عملية **إغلاق الوردية** كعملية غير مالية في خدمة التسجيل المالي باستخدام علامة **NFS**.

### <a name="data-export-and-audit"></a>تصدير البيانات وتدقيقها

يجب ان تكون كافة الحركات موقعه بواسطة TSE لضمان تكاملها ومصادقتها وإكمالها، وللمساعدة في منع معالجه البيانات المسجلة.

> [!WARNING]
> يمكن استخدام شهادة TSE المعتمدة فقط. للحصول على معلومات حول أنواع ونماذج TSE المدعومة في حل EFR، راجع مستند "دليل EFR \[DE\]" المنشور على موقع ويب [مستندات EFSTA](https://public.efsta.net/efr/). للحصول علي معلومات حول كيفيه اختيار TSE والحصول عليه، اتصل بـ [EFSTA](https://www.efsta.eu/at/kontakt).

تتطلب اللوائح في ألمانيا دعم تصدير DSFinV-K. يمكن تشغيل تصدير DSFinV-K في حل EFR. لمزيد من المعلومات حول تصدير DSFinV-K، راجع مستند "دليل EFR \[DE\]" المنشور على موقع ويب [مستندات EFSTA](https://public.efsta.net/efr/).

### <a name="limitations-of-the-sample"></a>قيود العينة

لا تدعم خدمه التسجيل المالي الا السيناريوهات التي يتم تضمين ضريبة المبيعات بها في الأسعار. لذلك، يجب تعيين خيار **ضريبة المبيعات المضمن** إلى **نعم** لكل من المتاجر والعملاء.

لا تدعم الخدمة المالية المواقف التي يتم فيها تطبيق أكثر من كود ضريبة مبيعات علي نفس بند الحركة.

لا يدعم اطار عمل التكامل المالي عروض أسعار المبيعات. التالي، لا يتم تسجيل هذه العمليات في الخدمة المالية.

## <a name="set-up-commerce-for-germany"></a>اعداد Commerce لألمانيا

يصف هذا القسم إعدادات Commerce الخاصة بألمانيا والموصي بها. لمزيد من معلومات الإعداد، راجع [صفحة Commerce الرئيسية](../index.md).

لاستخدام الوظيفة الخاصة بألمانيا، يجب عليك تحديد الإعدادات التالية.

- في العنوان الرئيسي للكيان القانوني، قم بتعيين حقل **البلد/المنطقة** إلى **DEU** (ألمانيا).
- في ملف تعريف وظيفة نقطه البيع لكل متجر موجود في ألمانيا، قم بتعيين حقل **رمز ISO** إلى **DE** (ألمانيا).

يجب أيضا تحديد الإعدادات التالية لألمانيا. تأكد من تشغيل مهام التوزيع المناسبة بعد إكمال الإعداد.

### <a name="set-up-vat-per-german-requirements"></a>إعداد ضريبة القيمة المضافة حسب المتطلبات الألمانية

يجب عليك إنشاء أكواد ضريبة المبيعات ومجموعات ضريبة المبيعات ومجموعات ضريبة مبيعات الأصناف. كما يجب اعداد معلومات ضريبة المبيعات للمنتجات والخدمات. لمزيد من المعلومات حول كيفية إعداد ميزات ضريبة المبيعات واستخدامها، راجع [نظرة عامة على ضريبة المبيعات](../../finance/general-ledger/indirect-taxes-overview.md).

في إيصالات المبيعات، يمكنك طباعة رمز مختصر لرمز ضريبة المبيعات (على سبيل المثال، "أ" أو "ب"). لجعل هذه الوظيفة متاحه، قم بتعيين حقل **كود الطباعة** في صفحة **أكواد ضريبة المبيعات**.

### <a name="set-up-stores"></a>إعداد المتاجر

في صفحة **جميع المتاجر**، قم بتحديث تفاصيل المتجر. على وجه التحديد، قم بتعيين المعلمات التالية:

- في حقل **مجموعة ضريبة المبيعات**، حدد مجموعة ضريبة المبيعات التي يجب استخدامها للمبيعات للعميل الافتراضي.
- قم بتعيين **الأسعار تتضمن ضريبة المبيعات** إلى **نعم**.
- قم بتعيين حقل **الاسم** إلى اسم الشركة. يساعد هذا التغيير في ضمان ظهور اسم الشركة في إيصال المبيعات. وبدلا من ذلك، يمكنك أضافه اسم الشركة إلى تخطيط إيصال استلام المبيعات كنص حر الشكل.
- قم بتعيين حقل **رقم التعريف الضريبي (TIN)** إلى رقم تعريف الشركة. يساعد هذا التغيير في ضمان ظهور رقم تعريف الشركة في إيصال المبيعات. بدلاً من ذلك، يمكنك إضافة رقم تعريف الشركة إلى تخطيط إيصال المبيعات كنص حر.

### <a name="set-up-functionality-profiles"></a>إعداد ملفات تعريف الوظائف

قم بإعداد ملفات تعريف وظائف نقطة البيع. في علامة التبويب السريعة **ترقيم الإيصالات**، قم باعداد ترقيم الإيصال من خلال إنشاء أو تحديث السجلات الخاصة بأنواع حركات إيصالات **المبيعات**، و **أمر المبيعات**، و **الإرجاع**.

### <a name="configure-custom-fields-so-that-they-can-be-used-in-receipt-formats-for-sales-receipts"></a>تكوين الحقول المخصصة بحيث يمكن استخدامها في تنسيقات الاستلام لإيصالات المبيعات

يمكنك تكوين نص اللغة والحقول المخصصة المستخدمة في تنسيقات إيصالات نقطه البيع. يجب ان تكون الشركة الافتراضية للمستخدم الذي يقوم بإنشاء اعداد الإيصال هي نفس الكيان القانوني الذي يتم إنشاء اعداد نص اللغة فيه. وبدلا من ذلك، يجب إنشاء نفس نصوص اللغة في الشركة الافتراضية لكل من المستخدم والكيان القانوني للمتجر الذي تم إنشاء الاعداد له.

في صفحة **نص اللغة**، قم باضافه السجلات التالية لتسميات الحقول المخصصة لتخطيطات الإيصال. لاحظ أن قيم **معرف اللغة** و **معرف النص** و **النص** التي تظهر في الجدول هي أمثله فقط. يمكنك تغييرها لتلبي متطلباتك. ومع ذلك، يجب أن تكون قيم **معرف النص** التي تستخدمها فريدة، ويجب أن تكون مساوية لـ 900001 أو أكثر.

أضف تسميات نقطه البيع التالية إلى قسم **نقطة البيع** لصفحة **نص اللغة**.

| معرف اللغة | معرف النص | النص                                  |
|-------------|---------|---------------------------------------|
| ar‬       | 900001  | شفرة استجابة سريعة                               |
| ar‬       | 900002  | معرف الحركة                        |
| ar‬       | 900003  | كود طباعه البيع بالتجزئة للضريبة                 |
| ar‬       | 900004  | المبلغ الضريبي (المبيعات)                    |
| ar‬       | 900005  | الأساس الضريبي (المبيعات)                     |
| ar‬       | 900006  | وقت وتاريخ بدء الحركة           |
| ar‬       | 900007  | وقت وتاريخ انتهاء الحركة             |
| ar‬       | 900008  | الرقم التسلسلي لعنصر الأمان |
| ar‬       | 900009  | عداد التوقيع                     |
| ar‬       | 900010  | التحقق من القيمة                           |
| ar‬       | 900011  | رسالة المعلومات                          |

في صفحة **الحقول المخصصة**، قم باضافه السجلات التالية للحقول المخصصة لتخطيطات الإيصالات. لاحظ أن قيم **معرف نص التسمية التوضيحية** يجب أن تكون متوافقة مع قيم **معرف النص** التي حددتها في صفحة **نص اللغة**.

| Name                            | النوع    | معرف نص التسمية التوضيحية |
|---------------------------------|---------|-----------------|
| QRCODE\_DE                      | استلام | 900001          |
| TRANSACTIONID\_DE               | استلام | 900002          |
| RETAILPRINTCODE\_DE             | استلام | 900003          |
| SALESTAXAMOUNT\_DE              | استلام | 900004          |
| SALESTAXBASIS\_DE               | استلام | 900005          |
| TRANSACTIONSTARTDATETIME\_DE    | استلام | 900006          |
| TRANSACTIONENDDATETIME\_DE      | استلام | 900007          |
| SECURITYELEMENTSERIALNUMBER\_DE | استلام | 900008          |
| SIGNCOUNTER\_DE                 | استلام | 900009          |
| SIGN\_DE                        | استلام | 900010          |
| INFOMESSAGE\_DE                 | استلام | 900011          |

> [!NOTE]
> من المهم تحديد أسماء الحقول المخصصة الصحيحة، كما هو موضح في الجدول السابق. سيتسبب اسم الحقل المخصص غير صحيح في فقدان البيانات في عمليات الاستلام.

### <a name="configure-receipt-formats"></a>تكوين تنسيقات الإيصالات

بالنسبة لكل تنسيق إيصال مطلوب، قم بتغيير قيمة حقل **سلوك الطباعة** إلى **الطباعة دائمًا**.

في مصمم تنسيق الإيصال، أضف الحقول المخصصة التالية إلى مقاطع الاستلام المناسبة. لاحظ ان أسماء الحقول تتوافق مع نصوص اللغة التي قمت بتحديدها في المقطع السابق.

- **الراس**: قم باضافه الحقول التالية:

    - حقلا **اسم المتجر** و **رقم التعريف الضريبي**، التي تستخدم لطباعه اسم الشركة ورقم التعريف علي إيصالات الاستلام. بدلاً من ذلك، يمكنك إضافة اسم الشركة ورقم التعريف إلى التخطيط كنص حر.
    - حقول **عنوان المتجر**، و **التاريخ**، و **الوقت 24 ساعة**، و **رقم الإيصال** و **رقم السجل**.

- **الأسطر**: قم باضافه الحقول التالية:

    - حقل **اسم الصنف**
    - حقل **الكمية**
    - حقل **السعر الإجمالي شامل الضريبة**
    - حقل **كود طباعة البيع بالتجزئة الضريبي**، الذي يستخدم لطباعه الكود المختصر الذي يتوافق مع كود ضريبة المبيعات الذي ينطبق علي الصنف.

- **التذييل**: قم باضافه الحقول التالية:

    - حقول الدفع، بحيث تتم طباعه مبالغ الدفع الخاصة بكل طريقه دفع. علي سبيل المثال، قم باضافه حقلي **اسم طريقه الدفع** و **مبلغ طريقه الدفع** إلى بند واحد من التخطيط.
    - الحقول الموجودة في مجموعة حقول **تقسيم الضريبة**. يجب طباعه كافة الحقول الموجودة في مجموعه الحقول هذه في بند منفصل واحد.

        - حقل **معرف الضريبة**، وهو حقل قياسي يمكن طباعه ملخص ضريبة المبيعات لكل كود ضريبة مبيعات. يجب أضافه الحقل إلى بند جديد.
        - حقل **النسبة المئوية للضريبة**، وهو عبارة عن حقل قياسي يستخدم لطباعه سعر الضريبة الفعال لكود ضريبة المبيعات.
        - حقل **أساس الضريبة (المبيعات)**، الذي يستخدم لطباعة الإيصال هو إجمالي مبلغ البيع النقدي لكود ضريبة المبيعات. يتم استبعاد الدفعات المقدمة وعمليات بطاقة الهدايا.
        - حقل **مبلغ الضريبة (المبيعات)**، الذي يستخدم لطباعة مبلغ ضريبة الإيصال للمبيعات النقدية لكود ضريبة المبيعات.
        - **كود طباعة البيع بالتجزئة الضريبي**، الذي يستخدم لطباعة الرمز المختصر الذي يتوافق مع رمز ضريبة المبيعات.

    - الحقول التي تحتوي علي بيانات الحركة الامنه التي يتم إرجاعها بواسطة خدمه التسجيل المالي:

        - حقل **معرف الحركة**، الذي يحدد هذا الحقل رقم المعاملة النقدية في خدمة التسجيل المالي
        - حقل **تاريخ ووقت بدء الحركة**
        - حقل **تاريخ ووقت انتهاء الحركة**
        - حقل **الرقم التسلسلي لعنصر الأمان**
        - حقل **عداد التوقيع**
        - حقل **التحقق من القيمة**
        - حقل **رمز الاستجابة السريعة**، الذي يستخدم لطباعه المرجع إلى الحركة النقدية المسجلة في النموذج شفره الاستجابة السريعة

        > [!NOTE]
        > يتم استرداد قيمة **رمز الاستجابة السريعة** من استجابه السجل المالي. يقوم EFR بإرجاع رمز استجابه سريعة في الاستجابة الخاصة به فقط إذا كانت قيمه حقل **السمات** في تكوين EFR موضحه في وثائق EFSTA. يجب تعيين تنسيق رمز الاستجابة السريعة في حقل **السمات** في تكوين EFR إلى **BMP**.

    - حقل **رسالة المعلومات**، بحيث يمكن عرض رسائل الإعلام من خدمة التسجيل المالي على الإيصالات. علي سبيل المثال، في حاله انقطاع جهاز توقيع، يمكن طباعه النص الخاص علي الإيصال.

لمزيد من المعلومات حول كيفية التعامل مع تنسيقات الإيصالات، راجع [إعداد وتصميم تنسيقات الإيصالات](../receipt-templates-printing.md).

## <a name="set-up-fiscal-integration-for-germany"></a>إعداد التكامل المالي لألمانيا

تعتمد عينة تكامل خدمة التسجيل المالي لألمانيا في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهو جزء من Commerce SDK.. تقع العينة في مجلد **src\\FiscalIntegration\\Efr** في مستودع [حلول Dynamics 365 Commerce ](https://github.com/microsoft/Dynamics365Commerce.Solutions/). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) من موفر المستند المالي، وهو امتداد ل Commerce Runtime (CRT)، والموصل المالي، وهو امتداد لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام SDK التجارية ، راجع [تنزيل نماذج sdk والحزم المرجعية الخاصة بالتجارة من GitHub واعداد NuGet](../dev-itpro/retail-sdk/sdk-github.md) تدفقات [بناء لمجموعه SDK](../dev-itpro/build-pipeline.md)المستقلة.

> [!NOTE]
> يتوفر نموذج تكامل خدمة التسجيل المالي لألمانيا في Commerce SDK بدءًا من الإصدار التجاري 10.0.29. في الإصدار التجاري 10.0.28 أو إصدار سابق ، يجب استخدام الإصدار السابق من Retail SDK على جهاز ظاهري للمطور (VM) في Microsoft Dynamics Lifecycle Services (LCS). لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لألمانيا (قديم)](emea-deu-fi-sample-sdk.md).

قم بإكمال خطوات اعداد التكامل المالي كما هو موضح في [اعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md):

1. [إعداد عملية التسجيل المالي](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process). وكذلك قم بتسجيل الإعدادات الخاصة بعمليه التسجيل المالي [الخاصة بنموذج تكامل خدمه التسجيل المالي هذا](#set-up-the-registration-process).
1. [تعيين إعدادات معالجة الأخطاء‬](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).

    > [!WARNING]
    > قد لا تتماشى قدرات معالجة الأخطاء في إطار التكامل المالي بشكل كامل مع اللوائح المالية المحلية.
    >
    > - نوصي بترك الخيار **الاستمرار في الخطأ** في **عملية التسجيل المالي** في وضع إيقاف التشغيل، لأنه يجب تسجيل جميع المعاملات بشكل صحيح، حتى لو لم تنجح المحاولة الأولى للتسجيل المالي.
    > - قبل تشغيل الخيار **تخطي** أو خيار **وضع علامة كمسجل** في صفحة **عملية التسجيل المالي**، يجب مناقشه هذه التغييرات مع عمليه التسجيل المالي مع مستشار الضرائب الخاص بك أو مكتب الضرائب المحلي.

1. [تفعيل التنفيذ اليدوي للتسجيل المالي المؤجل](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-deferred-fiscal-registration).
1. [تكوين مكونات القناة](#configure-channel-components).

### <a name="set-up-the-registration-process"></a>إعداد عملية التسجيل

لتمكين عملية التسجيل، اتبع هذه الخطوات لإعداد مقر Commerce الرئيسي. لمزيد من المعلومات، راجع [إعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).

1. تنزيل ملفات التكوين لموفر المستند المالي والموصل المالي:

    1. افتح مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/).
    1. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك.
    1. افتح **src \> FiscalIntegration \> Efr**.
    1. قم بتنزيل ملف تكوين موفر المستندات المالية في **التكوينات \> DocumentProviders \> DocumentProviderFiscalEFRSampleGermany.xml**.
    1. قم بتنزيل ملف تكوين الرابط المالي في **التكوينات \> الموصلات \> ConnectorEFRSample.xml**.

    > [!NOTE]
    > في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. توجد ملفات التكوين لعينة التكامل المالي هذه في المجلدات التالية من Retail SDK على الجهاز الظاهري VM للمطور في LCS:
    >
    > - **ملفات تكوين موفري المستندات المالية:** RetailSdk\\SampleExtensions\\CommerceRuntime\\Extensions.DocumentProvider.EFRSample\\Configuration\\DocumentProviderFiscalEFRSampleGermany.xml
    > - **ملف تكوين الموصل المالي:** RetailSdk\\SampleExtensions\\HardwareStation\\Extension.EFRSample\\Configuration\\ConnectorEFRSample.xml

1. انتقل إلى **Retail and Commerce \> إعداد Headquarters \> المعلمات \> معلمات Commerce المشتركة**. في علامة التبويب السريعة **عام**، عيّن خيار **تمكين التكامل المالي** إلى **نعم**.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> موفري المستندات المالية**، وقم بتحميل ملف تكوين موفر المستندات المالية الذي قمت بتنزيله مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> الموصلات المالية**، وقم بتحميل ملف تكوين موفر المستندات المالية الذي قمت بتنزيله مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الوظيفية**. أنشئ ملف تعريف الموصل الوظيفي الجديد. حدد موفر المستند والموصل الذي قمت بتحميله سابقًا. قم بتحديث [إعدادات تعيين البيانات](#default-data-mapping) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الفنية**. قم بإنشاء ملف تعريف فني جديد للموصل، وحدد الرابط المالي الذي قمت بتحميله مسبقًا. قم بتحديث [إعدادات الموصل](#fiscal-connector-settings) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> مجموعات الموصلات المالية**. قم بإنشاء مجموعة رابط مالي جديدة لملف التعريف الوظيفي للموصل الذي قمت بإنشائه مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> عمليات التسجيل المالي**. قم بإنشاء عملية تسجيل مالي جديد وخطوة عملية تسجيل مالي، وحدد مجموعة الرابط المالي الذي قمت بإنشائه مسبقًا.
1. انتقل إلى **البيع بالتجزئة والتجارة \> إعداد القناة \> إعداد قناة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الوظائف**. حدد ملف تعريف وظائف مرتبط بالمتجر حيث يجب تنشيط عمليه التسجيل. في علامة التبويب السريعة **عملية التسجيل المالي**، حدد عملية التسجيل المالي التي قمت بإنشائها مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> إعداد نقطة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الأجهزة**. حدد ملف تعريف الجهاز المرتبط بمحطة الأجهزة التي سيتم توصيل خدمة التسجيل المالي بها. في علامة التبويب السريعة **الأجهزة الطرفية المالية**، حدد ملف التعريف الفني للموصل الذي قمت بإنشائه مسبقًا.
1. افتح جدول التوزيع (**Retail وCommerce \>تكنولوجيا معلومات Retail وCommerce\> جدول التوزيع**)، وحدد الوظيفتين **1070** و **1090** لنقل البيانات إلى قاعدة بيانت القناة.

#### <a name="default-data-mapping"></a>تعيين البيانات الافتراضي

يتم تضمين تعيين البيانات الافتراضي التالي في تكوين موفر المستندات المالية الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **تعيين أنواع طرق الدفع** – تعيين طرق الدفع لقيم سمة **PayG** (مجموعة الدفع) في الطلبات التي تم إرسالها إلى الخدمة المالية. هنا هو التعيين الافتراضي:

    ```
    1: 0; 2: 1; 3: 3; 4: 8; 5: 2; 6: 0; 7: 7; 8: 6; 9: 0; 10: 8; 11: 1
    ```

    يمثل المكون الأول في كل زوج طريقه الدفع التي يتم اعدادها للمتجر. يمثل المكون الثاني مجموعة الدفع المقابلة التي تدعمها خدمة التسجيل المالي EFR. لمزيد من المعلومات حول مجموعات الدفع التي تعتمد EFR لألمانيا، راجع [مرجع EFR](https://public.efsta.net/efr/).

    يتوافق تعيين عينه الدفع مع طرق الدفع الخاصة بالمتجر التي يتم تكوينها في بيانات الطريقة التجريبية القياسية.

    | طريقة الدفع | اسم طريقة الدفع |
    |----------------|---------------------|
    | 1              | نقدي                |
    | 2              | الفحص               |
    | 3              | رقم البطاقة                |
    | 4              | حساب العميل    |
    | 5              | ‏‏غير ذلك               |
    | 6              | عملة            |
    | 7              | الإيصال             |
    | 8              | بطاقة الهدايا           |
    | 9              | إزالة/تعويم طريقة الدفع |
    | 10             | بطاقات الولاء       |
    | 11             | عمليات التحقق غير المحلية    |

    التالي، يجب تعديل تعيين النموذج وفقا لطرق الدفع التي تم تكوينها في التطبيق الخاص بك.

- **تضمين بيانات العميل** – إذا تم تشغيل هذه المعلمة، فستحتوي الطلبات إلى الخدمة المالية على معلومات العميل، مثل الأسماء والعناوين، في الحالات التي تتم فيها إضافة عميل إلى حركة.
- **تعيين أسعار ضريبة القيمة المضافة (VAT)** – تعيين قيم النسبة المئوية للضريبة التي تم اعدادها لأكواد ضريبة المبيعات إلى قيم سمة **TaxG** (مجموعه الضرائب) في الطلبات التي يتم إرسالها إلى الخدمة المالية. هنا هو التعيين الافتراضي:

    ```
    A: 19.00; B: 7.00; C: 10.70; D: 5.50; E: 0.00
    ```

    يمثل المكون الأول في كل زوج مجموعه ضرائب ضريبة القيمة المضافة المعتمدة من قبل خدمه التسجيل المالي لـ EFR. المكون الثاني يمثل معدل ضريبة القيمة المضافة المقابلة. لمزيد من المعلومات حول مجموعات ضريبة القيمة المضافة التي تعتمد EFR لألمانيا، راجع [مرجع EFR](https://public.efsta.net/efr/).

- **المجموعة الضريبية لبطاقات الهدايا والودائع** – قيمة سمة **TaxG** في الطلبات التي يتم إرسالها إلى الخدمة المالية، بناءً على العمليات التي تتضمن بطاقات هدايا أو إيداعات. هنا هو التعيين الافتراضي:

    ```
    G
    ```

- **مجموعة الضرائب لإعفاء ضريبة القيمة المضافة** – قيمة سمة **TaxG** في الطلبات التي يتم إرسالها إلى الخدمة المالية، استنادا إلى العمليات المعفاة من التزامات الضرائب. هنا هو التعيين الافتراضي:

    ```
    F
    ```

> [!NOTE]
> تعتبر إعدادات الضريبة في تعيين البيانات الافتراضية مسؤوله عن إعدادات الضريبة المطابقة في مجموعات النظام والضريبة في خدمه EFR. يمكن طباعه مجموعات الضرائب علي عمليات الاستلام فقط إذا تم تعيين حقل **كود الطباعة** في صفحة **أكواد ضريبة المبيعات**.

#### <a name="fiscal-connector-settings"></a>إعدادات الموصل المالي

يتم تضمين الإعدادات التالية في تكوين الرابط المالي الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **عنوان نقطة النهاية** – عنوان URL الخاص بخدمه التسجيل المالية.
- **المهلة** – مقدار الوقت بالمللي ثانية الذي سينتظره الرابط المالي للحصول على استجابة من خدمة التسجيل المالي.
- **إظهار إخطارات التسجيل المالي** – تتحكم هذه العلامة في ما إذا كان سيتم عرض الإخطارات التي ترجعها خدمه التسجيل المالي لعامل التشغيل ام لا.

### <a name="configure-channel-components"></a>تكوين مكونات القناة

> [!NOTE]
> - يتوفر نموذج تكامل خدمة التسجيل المالي لألمانيا في Commerce SDK بدءًا من الإصدار التجاري 10.0.29. في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لألمانيا (قديم)](emea-deu-fi-sample-sdk.md).
> - لا يتم تحديث العينات التجارية التي يتم نشرها في البيئة تلقائيا عند تطبيق تحديثات الخدمة أو الجودة علي مكونات التجارة. يجب تحديث النماذج المطلوبة يدويا.

#### <a name="set-up-the-development-environment"></a>إعداد بيئة التطوير

لإعداد بيئة تطوير لاختبار العينة وتوسيعها، اتبع هذه الخطوات.

1. قم بنسخ مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions) أو تنزيله. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك. لمزيد من المعلومات، راجع [تنزيل نماذج Commerce SDK والحزم المرجعية من GitHub و NuGet](../dev-itpro/retail-sdk/sdk-github.md).
1. افتح حل EFR على **Dynamics365Commerce.Solutions\\FiscalIntegration\\Efr\\EFR.sln**، وقم بإنشائه.
1. تثبيت ملحقات Commerce Runtime:

    1. ابحث عن مثبت ملحق CRT:

        - **Commerce Scale Unit:** في مجلد **Efr\\ScaleUnit\\ScaleUnit.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ScaleUnit.EFR.Installer**.
        - **CRT المحلي على نقطة البيع الحديثة:** في مجلد **Efr\\ModernPOS\\ModernPOS.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ModernPOS.EFR.Installer**.

    1. ابدأ مثبت ملحق CRT من سطر الأوامر:

        - **Commerce Scale Unit:**

            ```Console
            ScaleUnit.EFR.Installer.exe install --verbosity 0
            ```

        - **CRT المحلي في نقطة البيع الحديثة:**

            ```Console
            ModernPOS.EFR.Installer.exe install --verbosity 0
            ```

1. تثبيت ملحقات الموصل المالي

    يمكنك تثبيت ملحقات الموصل المالي في [محطة الأجهزة](fiscal-integration-for-retail-channel.md#fiscal-registration-is-done-via-a-device-connected-to-the-hardware-station) أو [سجل نقطة البيع](fiscal-integration-for-retail-channel.md#fiscal-registration-is-done-via-a-device-or-service-in-the-local-network).

    1. تثبيت ملحقات محطة الأجهزة:

        1. في مجلد **Efr\\HardwareStation\\HardwareStation.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **HardwareStation.EFR.Installer**.
        1. ابدأ بتشغيل مثبت الملحق من سطر الأوامر عن طريق تشغيل الأمر التالي.

            ```Console
            HardwareStation.EFR.Installer.exe install --verbosity 0
            ```

    1. تثبيت ملحقات نقطة البيع:

        1. افتح حل عينة الموصل المالي لنقطة البيع في **Dynamics365Commerce.Solutions\\FiscalIntegration\\PosFiscalConnectorSample\\Contoso.PosFiscalConnectorSample.sln**، وقم بإنشائه.
        1. في مجلد **PosFiscalConnectorSample\\StoreCommerce.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **Contoso.PosFiscalConnectorSample.StoreCommerce.Installer**.
        1. ابدأ بتشغيل مثبت الملحق من سطر الأوامر عن طريق تشغيل الأمر التالي.

            ```Console
            Contoso.PosFiscalConnectorSample.StoreCommerce.Installer.exe install --verbosity 0
            ```

#### <a name="production-environment"></a>بيئة الإنتاج

اتبع الخطوات الواردة في [إعداد تدفق البناء لنموذج تكامل مالي](fiscal-integration-sample-build-pipeline.md) لإنشاء وإصدار وحده مقياس السحابة وحزم الخدمة الذاتية القابلة للنشر لنموذج التكامل المالي. يمكن العثور على ملف YAML لقالب **EFR build-pipeline.yml** في مجلد **Pipeline\\YAML_Files** الخاص بمستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions).

## <a name="design-of-extensions"></a>تصميم الملحقات

تعتمد عينة تكامل خدمة التسجيل المالي لألمانيا في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهو جزء من Commerce SDK.. تقع العينة في مجلد **src\\FiscalIntegration\\Efr** في مستودع [حلول Dynamics 365 Commerce ](https://github.com/microsoft/Dynamics365Commerce.Solutions/). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) من موفر المستند المالي، وهو ملحق لـ (CRT)، والموصل المالي، وهو ملحق لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام SDK التجارية ، راجع [تنزيل نماذج sdk والحزم المرجعية الخاصة بالتجارة من GitHub واعداد NuGet](../dev-itpro/retail-sdk/retail-sdk-overview.md) تدفقات [بناء لمجموعه SDK](../dev-itpro/build-pipeline.md)المستقلة.

> [!NOTE]
> يتوفر نموذج تكامل خدمة التسجيل المالي لألمانيا في Commerce SDK بدءًا من الإصدار التجاري 10.0.29. في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لألمانيا (قديم)](emea-deu-fi-sample-sdk.md).

### <a name="crt-extension-design"></a>تصميم ملحق CRT

الغرض من الامتداد الذي يمثل موفر المستندات المالية هو إنشاء مستندات خاصة بالخدمة ومعالجة الاستجابات من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

يوجد معالج طلب واحد لموفر المستندات، **DocumentProviderEFRFiscalDEU**. يتم استخدام هذا المعالج لإنشاء مستندات مالية لخدمة التسجيل المالي. إنه موروث من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم موفر مستند الموصل المحدد في مقر Commerce الرئيسي.

يدعم الموصل الطلبات التالية:

- **GetFiscalDocumentDocumentProviderRequest** – يحتوي هذا الطلب على معلومات حول المستند الذي يجب إنشاؤه. تقوم بإرجاع مستند خاص بالخدمة يجب تسجيله في خدمة التسجيل المالي.
- **GetFiscalTransactionExtendedDataDocumentProviderRequest** – يعيد هذا الطلب الاستجابة مع البيانات الموسعة.

#### <a name="configuration"></a>تكوين

يوجد ملف التكوين لموفر المستند المالي في **src\\FiscalIntegration\\Efr\\Configurations\\DocumentProviders\\DocumentProviderFiscalEFRSampleGermany.xml** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من هذا الملف هو تمكين إعدادات موفر المستندات المالية المراد تكوينها من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

### <a name="hardware-station-extension-design"></a>تصميم ملحقات محطة الأجهزة

الغرض من الامتداد الذي يعتبر رابطًا ماليًا هو الاتصال بخدمة التسجيل المالي.

ملحق محطة الأجهزة هو **HardwareStation.Extension.EFRSample**. يستخدم بروتوكول HTTP لإرسال المستندات التي ينشئها ملحق CRT لخدمة التسجيل المالية. كما أنه يتعامل مع الاستجابات التي يتم تلقيها من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

معالج طلب **EFRHandler** هو نقطة الإدخال لمعالجة الطلبات إلى خدمة التسجيل المالي. هذا المعالج موروث من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم الموصل المالي المحدد في مقر Commerce الرئيسي.

يدعم الموصل الطلبات التالية:

- **SubmitDocumentFiscalDeviceRequest** – يرسل هذا الطلب المستندات إلى خدمة التسجيل المالي ويعيد ردًا منها.
- **IsReadyFiscalDeviceRequest** – يُستخدم هذا الطلب لإجراء فحص سلامة لخدمة التسجيل المالي.
- **InitializeFiscalDeviceRequest** – يستخدم هذا الطلب لتهيئة خدمة التسجيل المالي.

#### <a name="configuration"></a>تكوين

يوجد ملف التكوين للموصل المالي في **src\\FiscalIntegration\\Efr\\Configurations\\Connectors\\ConnectorEFRSample.xml** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من الملف هو تمكين إعدادات الموصل المالي ليتم تكوينه من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

### <a name="pos-fiscal-connector-extension-design"></a>تصميم ملحق موصل POS المالي

الغرض من امتداد الرابط المالي لنقاط البيع هو التواصل مع خدمة التسجيل المالي من نقطة البيع. يستخدم بروتوكول HTTPS للاتصال.

#### <a name="fiscal-connector-factory"></a>مصنع الموصل المالي

يقوم مصنع الموصل المالي بتعيين اسم الموصل إلى تطبيق الموصل المالي ويوجد في ملف **Pos.Extension\\Connectors\\FiscalConnectorFactory.ts**. يجب أن يتطابق اسم الموصل مع اسم الموصل المالي المحدد في مقر Commerce الرئيسي.

#### <a name="efr-fiscal-connector"></a>الموصل المالي لـ EFR

يوجد الموصل المالي EFR في ملف **Pos.Extension\\Connectors\\Efr\\EfrFiscalConnector.ts**. يقوم بتنفيذ واجهة **IFiscalConnector** التي تدعم الطلبات التالية:

- **FiscalRegisterSubmitDocumentClientRequest** – يرسل هذا الطلب المستندات إلى خدمة التسجيل المالي ويعيد ردًا منها.
- **FiscalRegisterIsReadyClientRequest** – يُستخدم هذا الطلب لإجراء فحص سلامة لخدمة التسجيل المالي.
- **FiscalRegisterInitializeClientRequest** – يستخدم هذا الطلب لتهيئة خدمة التسجيل المالي.

#### <a name="configuration"></a>تكوين

ملف التكوين موجود في مجلد **src\\FiscalIntegration\\Efr\\التكوينات\\الموصلات** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من الملف هو تمكين إعدادات الرابط المالي ليتم تكوينه من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي. تمت إضافة الإعدادات التالية:

- **عنوان نقطة النهاية** – عنوان URL الخاص بخدمه التسجيل المالية.
- **المهلة** – مقدار الوقت بالمللي ثانية الذي سينتظره الموصل للحصول على استجابة من خدمة التسجيل المالي.

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
