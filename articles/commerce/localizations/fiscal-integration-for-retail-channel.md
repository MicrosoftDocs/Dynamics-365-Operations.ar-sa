---
title: نظرة عامة على التكامل المالي لقنوات Commerce
description: يوفر هذا الموضوع نظرة عامة حول قدرات التكامل المالي المتوفرة في Dynamics 365 Commerce.
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 2f1abf29058e773f1645301fcd7a960df488d92b
ms.sourcegitcommit: deac22ba5377a912d93fe408c5ae875706378c2d
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 01/16/2021
ms.locfileid: "5017457"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a><span data-ttu-id="a197a-103">نظرة عامة على التكامل المالي لقنوات Commerce</span><span class="sxs-lookup"><span data-stu-id="a197a-103">Overview of fiscal integration for Commerce channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="a197a-104">مقدمة</span><span class="sxs-lookup"><span data-stu-id="a197a-104">Introduction</span></span>

<span data-ttu-id="a197a-105">هذا الموضوع هو نظرة عامة حول قدرات التكامل المالي المتوفرة في Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="a197a-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Commerce.</span></span> <span data-ttu-id="a197a-106">يتضمن التكامل المالي التكامل مع أجهزة وخدمات مالية مختلفة تمكّن التسجيل المالي للمبيعات وفقًا للقوانين المالية المحلية التي تهدف إلى منع الاحتيال الضريبي في مجال البيع بالتجزئة.</span><span class="sxs-lookup"><span data-stu-id="a197a-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="a197a-107">فيما يلي بعض السيناريوهات النموذجية التي يمكن تغطيتها باستخدام التكامل المالي:</span><span class="sxs-lookup"><span data-stu-id="a197a-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="a197a-108">تسجيل مبيعات على جهاز مالي متصل بنقطة بيع (POS)، مثل الطابعة المالية وطباعة إيصال مالي للعميل.</span><span class="sxs-lookup"><span data-stu-id="a197a-108">Register a sale on a fiscal device that is connected to point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="a197a-109">إرسال معلومات المبيعات والمرتجعات‬ المستكملة في Retail POS إلى خدمة ويب خارجية تشغلها هيئة الضرائب، بطريقة آمنة.</span><span class="sxs-lookup"><span data-stu-id="a197a-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="a197a-110">المساعدة في ضمان عدم قابلية تحول بيانات حركة مبيعات من خلال التواقيع الرقمية.</span><span class="sxs-lookup"><span data-stu-id="a197a-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="a197a-111">تعتبر وظيفة التكامل المالي إطار عمل يوفر حلاً مشتركًا لمزيد من التطوير والتخصيص للتكامل بين Retail POS والأجهزة والخدمات المالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="a197a-112">وتتضمن الوظيفة أيضًا نماذج التكامل المالي التي تدعم السيناريوهات الأساسية لبلدان أو مناطق محددة، والتي تصلح لخدمات أو أجهزة مالية محددة.</span><span class="sxs-lookup"><span data-stu-id="a197a-112">The functionality also includes fiscal integration samples that support basic scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="a197a-113">يتكون نموذج التكامل المالي من عدة ملحقات لمكونات Commerce وهو مضمن في مجموعة تطوير البرنامج (SDK).</span><span class="sxs-lookup"><span data-stu-id="a197a-113">A fiscal integration sample consists of several extensions of Commerce components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="a197a-114">للحصول على مزيد من المعلومات حول عينات التكامل المالي، راجع [نظرة عامة على عينات التكامل المالي في Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span><span class="sxs-lookup"><span data-stu-id="a197a-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="a197a-115">للحصول على مزيد من المعلومات حول كيفية تثبيت واستخدام Retail SDK، راجع [بنية مجموعة تطوير برنامج Retail](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a197a-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="a197a-116">لدعم السيناريوهات الأخرى التي لا يدعمها نموذج التكامل المالي، أو لدمج Retail POS مع أجهزة أو خدمات مالية أخرى، أو لتغطية المتطلبات الخاصة بالبلدان أو المناطق الأخرى، يجب إما توسيع تكامل مالي موجود أو إنشاء نموذج جديد باستخدام نموذج موجود كمثال.</span><span class="sxs-lookup"><span data-stu-id="a197a-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="a197a-117">عملية التسجيل المالي ونماذج التكامل المالي للأجهزة المالية</span><span class="sxs-lookup"><span data-stu-id="a197a-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="a197a-118">بإمكان عملية التسجيل المالي في Retail POS أن تتكون من خطوة واحدة أو أكثر.</span><span class="sxs-lookup"><span data-stu-id="a197a-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="a197a-119">تشتمل كل خطوة على التسجيل المالي لأحداث أو حركات معينة في جهاز مالي واحد أو خدمة مالية واحدة.</span><span class="sxs-lookup"><span data-stu-id="a197a-119">Each step involves fiscal registration of specific transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="a197a-120">تشارك مكونات الحل التالية في التسجيل المالي في جهاز مالي متصل بمحطة أجهزة:</span><span class="sxs-lookup"><span data-stu-id="a197a-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="a197a-121">**ملحق Commerce runtime (CRT)** – يقوم هذا المكون بسلسة بيانات حدث/حركة بالتنسيق الذي يُستخدم أيضًا للتفاعل مع الجهاز المالي، ويحلل الاستجابات من الجهاز المالي ويخزن الاستجابات في قاعدة بيانات القناة.</span><span class="sxs-lookup"><span data-stu-id="a197a-121">**Commerce runtime (CRT) extension** – This component serializes transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="a197a-122">ويحدد الملحق أيضًا الحركات والأحداث المعينة التي يجب تسجيلها.</span><span class="sxs-lookup"><span data-stu-id="a197a-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="a197a-123">يشار إلى هذا المكون في أغلب الأحيان بالاسم *موفر المستندات المالية*.</span><span class="sxs-lookup"><span data-stu-id="a197a-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="a197a-124">**ملحق محطة الأجهزة** - يقوم هذا المكون بتهيئة الاتصال بالجهاز المالي، ويرسل الطلبات ويوجه الأوامر إلى الجهاز المالي استنادًا إلى بيانات الحركة/الحدث المستخرجة من المستند المالي، ويتلقى الاستجابات من الجهاز المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="a197a-125">يشار إلى هذا المكون في أغلب الأحيان بالاسم *موصل مالي*.</span><span class="sxs-lookup"><span data-stu-id="a197a-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="a197a-126">يحتوي نموذج التكامل المالي لجهاز مالي على ملحقات وقت التشغيل التجاري (CRT) ومحطة الأجهزة لموفر مستندات مالية وموصل مالي، على التوالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="a197a-127">ويحتوي أيضًا على تكوينات المكونات التالية:</span><span class="sxs-lookup"><span data-stu-id="a197a-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="a197a-128">**تكوين موفر المستندات المالية** - يحدد هذا التكوين أسلوب إخراج وتنسيق للمستندات المالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="a197a-129">ويحتوي أيضًا على تعيين بيانات للضرائب وطرق الدفع، لجعل البيانات من Retail POS متوافقة مع القيم المعرّفة بشكل مسبق في البرنامج الثابت للجهاز المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="a197a-130">**تكوين الموصل المالي** - يحدد هذا التكوين الاتصال الفعلي بالجهاز المالي المحدد.</span><span class="sxs-lookup"><span data-stu-id="a197a-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="a197a-131">يتم تعريف عملية تسجيل مالي لسجل نقطة بيع معين بواسطة إعداد مناظر في ملف تعريف وظائف نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="a197a-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="a197a-132">لمزيد من التفاصيل حول كيفية تكوين عملية تسجيل مالي، وتحميل موفر المستندات المالية وتكوينات الموصل المالي، وتغيير معلماتها، راجع [إعداد عملية تسجيل مالي](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span><span class="sxs-lookup"><span data-stu-id="a197a-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="a197a-133">يوضح المثال التالي تدفق تنفيذ تسجيل مالي نموذجي لجهاز مالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="a197a-134">يبدأ التدفق بحدث في نقطة البيع (على سبيل المثال، إنجاز حركة مبيعات) وينفذ تسلسل الخطوات التالية:</span><span class="sxs-lookup"><span data-stu-id="a197a-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="a197a-135">تطلب نقطة البيع مستندًا ماليًا من CRT.</span><span class="sxs-lookup"><span data-stu-id="a197a-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="a197a-136">يحدد CRT ما إذا كان الحدث الحالي يحتاج إلى تسجيل مالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="a197a-137">استنادًا إلى إعدادات عملية التسجيل المالي، يحدد CRT موصلاً ماليًا وموفر المستندات المالية المناظر لاستخدامه في التسجيل المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="a197a-138">يشغل CRT موفر المستندات المالية المسؤول عن إنشاء مستند مالي (على سبيل المثال، مستند XML) يمثل الحدث أو الحركة.</span><span class="sxs-lookup"><span data-stu-id="a197a-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the transaction or event.</span></span>
5. <span data-ttu-id="a197a-139">ترسل نقطة البيع المستند المالي الذي يقوم CRT بإعداده إلى محطة أجهزة.</span><span class="sxs-lookup"><span data-stu-id="a197a-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="a197a-140">تشغّل محطة الأجهزة الموصل المالي الذي يعالج المستند المالي وتبلغ عنه الجهاز المالي أو الخدمة المالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="a197a-141">تحلل نقطة البيع استجابة الجهاز المالي أو الخدمة المالية لتحديد ما إذا كان التسجيل المالي قد تم بنجاح.</span><span class="sxs-lookup"><span data-stu-id="a197a-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="a197a-142">يحفظ CRT الاستجابة في قناة قاعدة البيانات.</span><span class="sxs-lookup"><span data-stu-id="a197a-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="a197a-143">![مخطط الحل](media/emea-fiscal-integration-solution.png "مخطط الحل")</span><span class="sxs-lookup"><span data-stu-id="a197a-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="a197a-144">معالجة الأخطاء</span><span class="sxs-lookup"><span data-stu-id="a197a-144">Error handling</span></span>

<span data-ttu-id="a197a-145">يوفر إطار عمل التكامل المالي الخيارات التالية للتعامل مع حالات الفشل أثناء التسجيل المالي:</span><span class="sxs-lookup"><span data-stu-id="a197a-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="a197a-146">**إعادة المحاولة** - بإمكان العاملين استخدام هذا الخيار عندما يكون حل الفشل بسرعة ممكنًا، ويمكن إعادة تشغيل التسجيل المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="a197a-147">على سبيل المثال، يمكن استخدام هذا الخيار عندما لا يكون الجهاز المالي متصلاً، ونفاد الورق من طابعة الضرائب المحصلة، أو هناك ازدحام ورق في طابعة الضرائب المحصلة.</span><span class="sxs-lookup"><span data-stu-id="a197a-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="a197a-148">**إلغاء** - يسمح هذا الخيار للعاملين بتأجيل التسجيل المالي للحدث الحالي أو الحركة الحالية في حال فشله.</span><span class="sxs-lookup"><span data-stu-id="a197a-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="a197a-149">بعد تأجيل التسجيل، بإمكان العامل متابعة العمل في نقطة البيع وإكمال أي عملية لا تحتاج إلى تسجيل مالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="a197a-150">عند وقوع أي حدث يحتاج إلى تسجيل مالي في نقطة البيع (على سبيل المثال، فتح حركة جديدة)، يظهر مربع حوار معالجة الأخطاء بشكل تلقائي لإبلاغ العامل أن الحركة السابقة لم تسجل بشكل صحيح ولتوفير خيارات معالجة الأخطاء.</span><span class="sxs-lookup"><span data-stu-id="a197a-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="a197a-151">**تخطي** - بإمكان العاملين استخدام هذا الخيار عندما يكون تجاهل التسجيل المالي ممكنًا في ظل شروط معينة ويمكن متابعة العمليات العادية في نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="a197a-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="a197a-152">على سبيل المثال، يمكن استخدام هذا الخيار عندما يمكن تسجيل حركة مبيعات فشلت عملية التسجيل المالي لها المالي في دفتر يومية ورقي خاص.</span><span class="sxs-lookup"><span data-stu-id="a197a-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="a197a-153">**وضع علامة كمسجل** - بإمكان العاملين استخدام هذا الخيار إذا تم تسجيل الحركة فعليًا في الجهاز المالي (على سبيل المثال، تمت طباعة أيصال مالي)، ولكن حدث فشل أثناء حفظ الاستجابة المالية إلى قاعدة بيانات القناة.</span><span class="sxs-lookup"><span data-stu-id="a197a-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="a197a-154">يجب تنشيط الخيارين **تخطي** و **ووضع علامة كمسجل** في عملية التسجيل المالي قبل استخدامهما.</span><span class="sxs-lookup"><span data-stu-id="a197a-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="a197a-155">بالإضافة إلى ذلك، يجب أن يُمنح العاملون أذونات مطابقة.</span><span class="sxs-lookup"><span data-stu-id="a197a-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="a197a-156">يسمح الخياران **تخطي** و **وضع علامة كمسجل** لأكواد المعلومات بتسجيل معلومات معينة حول الفشل، مثل سبب الفشل أو تبرير تخطي التسجيل المالي أو وضع علامة على الحركة كمسجلة.</span><span class="sxs-lookup"><span data-stu-id="a197a-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="a197a-157">للحصول على مزيد من التفاصيل حول كيفية إعداد المعلمات لمعالجة الأخطاء، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="a197a-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="a197a-158">التسجيل المالي الاختياري</span><span class="sxs-lookup"><span data-stu-id="a197a-158">Optional fiscal registration</span></span>

<span data-ttu-id="a197a-159">قد يكون التسجيل المالي إلزاميًا لبعض العمليات ولكن اختياريًا للبعض الآخر.</span><span class="sxs-lookup"><span data-stu-id="a197a-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="a197a-160">على سبيل المثال، قد يكون التسجيل المالي لعمليات البيع والإرجاع العادية إلزاميًا، ولكن التسجيل المالي للعمليات المرتبطة بإيداعات العملاء قد يكون اختياريًا.</span><span class="sxs-lookup"><span data-stu-id="a197a-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="a197a-161">وفي هذه الحالة، من المفترض أن يؤدي عدم إتمام عملية التسجيل المالي لعملية مبيعات إلى منع عمليات مبيعات إضافية، ولكن عدم إتمام عملية التسجيل المالي لإيداع العميل لا يؤدي إلى حظر عمليات مبيعات إضافية.</span><span class="sxs-lookup"><span data-stu-id="a197a-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="a197a-162">للتمييز بين العمليات الإلزامية والاختيارية، فإننا ننصح بضرورة معالجتها من خلال موفري مستندات مختلفين، وبأن تقوم بإعداد خطوات منفصلة في عملية التسجيل المالي لهؤلاء الموفرين.</span><span class="sxs-lookup"><span data-stu-id="a197a-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="a197a-163">يجب تمكين المعلمة **المتابعة مع وجود الخطأ‬** لأي خطوة تتعلق بالتسجيل المالي الاختياري.</span><span class="sxs-lookup"><span data-stu-id="a197a-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="a197a-164">للحصول على مزيد من التفاصيل حول كيفية إعداد المعلمات لمعالجة الأخطاء، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="a197a-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="a197a-165">تشغيل التسجيل المالي يدويًا</span><span class="sxs-lookup"><span data-stu-id="a197a-165">Manually running fiscal registration</span></span>

<span data-ttu-id="a197a-166">إذا تم تأجيل التسجيل المالي لحركة أو حدث بعد حدوث فشل (على سبيل المثال، إذا حدد المشغل **إلغاء** في مربع حوار معالجة الأخطاء)، فيمكنك إعادة تشغيل التسجيل المالي يدويًا عن طريق استدعاء عملية مناظرة.</span><span class="sxs-lookup"><span data-stu-id="a197a-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="a197a-167">للحصول على مزيد من التفاصيل، راجع [تمكين التنفيذ اليدوي للتسجيل المالي المؤجل](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span><span class="sxs-lookup"><span data-stu-id="a197a-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="a197a-168">فحص صحة التسجيل المالي</span><span class="sxs-lookup"><span data-stu-id="a197a-168">Fiscal registration health check</span></span>

<span data-ttu-id="a197a-169">يتحقق إجراء فحص صحة عمليات التسجيل المالي من توفر الجهاز المالي أو الخدمة المالية عند وقوع أحداث معينة.</span><span class="sxs-lookup"><span data-stu-id="a197a-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="a197a-170">إذا تعذر إكمال التسجيل المالي في الوقت الحالي، فسيتم إعلام المشغل بشكل مسبق.</span><span class="sxs-lookup"><span data-stu-id="a197a-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="a197a-171">تقوم نقطة البيع بتشغيل فحص الصحة عند وقوع الأحداث التالية:</span><span class="sxs-lookup"><span data-stu-id="a197a-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="a197a-172">فتح حركة جديدة.</span><span class="sxs-lookup"><span data-stu-id="a197a-172">A new transaction is opened.</span></span>
- <span data-ttu-id="a197a-173">إعادة استدعاء حركة معلقة.</span><span class="sxs-lookup"><span data-stu-id="a197a-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="a197a-174">إنجاز عملية مبيعات أو إرجاع.</span><span class="sxs-lookup"><span data-stu-id="a197a-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="a197a-175">إذا فشل فحص الصحة، تُظهر نقطة البيع مربع حوار فحص الصحة.</span><span class="sxs-lookup"><span data-stu-id="a197a-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="a197a-176">يوفر مربع الحوار هذا الأزرار التالية:</span><span class="sxs-lookup"><span data-stu-id="a197a-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="a197a-177">**موافق** – يتيح هذا الزر للمشغل تجاهل خطأ فحص الصحة ومتابعة معالجة العملية.</span><span class="sxs-lookup"><span data-stu-id="a197a-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="a197a-178">بإمكان المشغلين تحديد هذا الزر فقط إذا تم تمكين الإذن **السماح بتخطي خطأ فحص الصحة** لهم.</span><span class="sxs-lookup"><span data-stu-id="a197a-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="a197a-179">**إلغاء** – إذا حدد المشغل هذا الزر، تلغي نقطة البيع الإجراء الأخير (على سبيل المثال، لا يُضاف أحد العناصر إلى حركة جديدة).</span><span class="sxs-lookup"><span data-stu-id="a197a-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="a197a-180">يتم تشغيل فحص الصحة فقط إذا كانت العملية الحالية تحتاج إلى تسجيل مالي، وإذا تم تعطيل المعلمة **المتابعة مع وجود الخطأ‬** للخطوة الحالية من عملية التسجيل المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="a197a-181">للحصول على مزيد من التفاصيل، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="a197a-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="a197a-182">تخزين الاستجابة المالية في الحركة المالية</span><span class="sxs-lookup"><span data-stu-id="a197a-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="a197a-183">عند نجاح التسجيل المالي الحركة أو حدث، يتم إنشاء حركة مالية في قاعدة بيانات القناة ويتم ربطها بالحركة أو الحدث الأصلي.</span><span class="sxs-lookup"><span data-stu-id="a197a-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="a197a-184">وبشكل مماثل، إذا تم تحديد الخيار **تخطي** أو **وضع علامة كمسجل** لتسجيل مالي فاشل، يتم تخزين هذه المعلومات في حركة مالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="a197a-185">تتضمن الحركة المالية الاستجابة المالية للجهاز المالي أو الخدمة المالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="a197a-186">وإذا كانت عملية التسجيل المالي مكونة من عدة خطوات، يتم إنشاء حركة مالية لكل خطوة من العملية التي أدت إلى تسجيل ناجح أو فاشل.</span><span class="sxs-lookup"><span data-stu-id="a197a-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="a197a-187">يتم تحويل الحركات المالية إلى المراكز الرئيسية بواسطة *وظيفة P* مع الحركات.</span><span class="sxs-lookup"><span data-stu-id="a197a-187">Fiscal transactions are transferred to Headquarters by the *P-job*, together with transactions.</span></span> <span data-ttu-id="a197a-188">على علامة التبويب السريعة **الحركات المالية** في صفحة **حركات المتجر**، يمكنك عرض الحركات المالية المرتبطة بحركات.</span><span class="sxs-lookup"><span data-stu-id="a197a-188">On the **Fiscal transactions** FastTab of the **Store transactions** page, you can view the fiscal transactions that are linked to transactions.</span></span>

<span data-ttu-id="a197a-189">تخزن الحركة المالية التفاصيل التالية:</span><span class="sxs-lookup"><span data-stu-id="a197a-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="a197a-190">تفاصيل عملية التسجيل المالية (العملية، ومجموعة الموصلات، وموصل، وغير ذلك).</span><span class="sxs-lookup"><span data-stu-id="a197a-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="a197a-191">وهي تخزن أيضًا الرقم التسلسلي للجهاز المالي في الحقل **رقم السجل**، إذا تم تضمين هذه المعلومات في الاستجابة المالية.</span><span class="sxs-lookup"><span data-stu-id="a197a-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="a197a-192">حالة التسجيل المالي: **مكتمل** لنجاح التسجيل، أو **تخطي** إذا حدد العامل الخيار **تخطي** لعملية تسجيل فاشلة أو **وضع علامة كمسجل** إذا حدد العامل الخيار  **وضع علامة كمسجل‏‎**.</span><span class="sxs-lookup"><span data-stu-id="a197a-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="a197a-193">حركات أكواد المعلومات‬ المرتبطة بحركة مالية محددة.</span><span class="sxs-lookup"><span data-stu-id="a197a-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="a197a-194">لعرض حركات أكواد المعلومات، في علامة التبويب السريعة **الحركات المالية**، حدد حركة مالية بالحالة **تخطي** أو **وضع علامة كمسجل**، ثم حدد **حركات أكواد المعلومات**.</span><span class="sxs-lookup"><span data-stu-id="a197a-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="a197a-195">النصوص المالية للخصومات</span><span class="sxs-lookup"><span data-stu-id="a197a-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="a197a-196">تضع بعض البلدان أو المناطق شروطًا معينة حول النصوص الإضافية التي يجب طباعتها على الإيصالات المالية عند تطبيق أنواع مختلفة من الخصومات.</span><span class="sxs-lookup"><span data-stu-id="a197a-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="a197a-197">تسمح لك وظيفة التكامل المالي بإعداد نص خاص للخصم يُطبع بعد سطر خصم على إيصال مالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="a197a-198">وبالنسبة إلى الخصومات اليدوية، يمكنك تكوين نص مالي لكود المعلومات المحدد في كود المعلومات **خصم المنتج** في ملف تعريف وظائف نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="a197a-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="a197a-199">للحصول على مزيد من التفاصيل حول كيفية إعداد النصوص المالية للخصومات، راجع [إعداد النصوص المالية للخصومات](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span><span class="sxs-lookup"><span data-stu-id="a197a-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="a197a-200">طباعة التقارير المالية X وZ</span><span class="sxs-lookup"><span data-stu-id="a197a-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="a197a-201">تدعم وظيفة التكامل المالي إنشاء كشوفات نهاية اليوم الخاصة بالجهاز أو الخدمة المالية المتكاملة:</span><span class="sxs-lookup"><span data-stu-id="a197a-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="a197a-202">يجب إضافة أزرار جديدة تقوم بتشغيل عمليات مناظرة إلى تخطيط شاشة نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="a197a-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="a197a-203">للحصول على مزيد من التفاصيل، راجع [إعداد التقارير المالية X/Z من نقطة البيع](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span><span class="sxs-lookup"><span data-stu-id="a197a-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="a197a-204">في نموذج التكامل المالي، يجب أن تتطابق هذه العمليات مع العمليات المناظر للجهاز المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="a197a-205">نماذج التكامل المالي في Retail SDK</span><span class="sxs-lookup"><span data-stu-id="a197a-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="a197a-206">في الوقت الحالي، تتوفر عينات التكامل المالي التالية في Retail SDK:</span><span class="sxs-lookup"><span data-stu-id="a197a-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="a197a-207">عينة تكامل طابعة الضرائب المحصلة لإيطاليا</span><span class="sxs-lookup"><span data-stu-id="a197a-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="a197a-208">عينة تكامل طابعة الضرائب المحصلة لبولندا</span><span class="sxs-lookup"><span data-stu-id="a197a-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="a197a-209">عينة تكامل خدمة التسجيل المالي للنمسا</span><span class="sxs-lookup"><span data-stu-id="a197a-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="a197a-210">عينة تكامل خدمة التسجيل المالي لجمهورية التشيك‬</span><span class="sxs-lookup"><span data-stu-id="a197a-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)
- [<span data-ttu-id="a197a-211">نموذج تكامل وحدة التحكم للسويد</span><span class="sxs-lookup"><span data-stu-id="a197a-211">Control unit integration sample for Sweden</span></span>](./emea-swe-fi-sample.md)
- [<span data-ttu-id="a197a-212">عينة تكامل خدمة التسجيل المالي لألمانيا</span><span class="sxs-lookup"><span data-stu-id="a197a-212">Fiscal registration service integration sample for Germany</span></span>](./emea-deu-fi-sample.md)

<span data-ttu-id="a197a-213">تتوفر أيضًا وظيفة التكامل المالي التالية في Retail SDK ولكنها لا تستفيد حاليًا من إطار عمل التكامل المالي.</span><span class="sxs-lookup"><span data-stu-id="a197a-213">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="a197a-214">تم التخطيط لعملية ترحيل هذه الوظيفة إلى إطار عمل التكامل المالي لتحديثات لاحقة.</span><span class="sxs-lookup"><span data-stu-id="a197a-214">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>


- [<span data-ttu-id="a197a-215">التوقيع الرقمي الخاص بفرنسا</span><span class="sxs-lookup"><span data-stu-id="a197a-215">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="a197a-216">التوقيع الرقمي الخاص بالنرويج‬</span><span class="sxs-lookup"><span data-stu-id="a197a-216">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)

<span data-ttu-id="a197a-217">لا تستخدم وظيفة التكامل المالي القديمة التالية المتاحة في Retail SDK إطار عمل التكامل المالي، وسوف تُهمل في التحديثات اللاحقة:</span><span class="sxs-lookup"><span data-stu-id="a197a-217">The following legacy fiscal integration functionality that is available in Retail SDK does not use the fiscal integration framework and will be deprecated in later updates:</span></span>

- [<span data-ttu-id="a197a-218">نموذج تكامل وحدة التحكم للسويد (قديم)</span><span class="sxs-lookup"><span data-stu-id="a197a-218">Control unit integration sample for Sweden (legacy)</span></span>](./retail-sdk-control-unit-sample.md)
