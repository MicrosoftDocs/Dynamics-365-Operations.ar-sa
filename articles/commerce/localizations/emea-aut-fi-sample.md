---
title: عينة تكامل خدمة التسجيل المالي للنمسا
description: يقدم هذا الموضوع نظرة عامة على عينة التكامل المالي في النمسا في Microsoft Dynamics 365 Commerce.
author: EvgenyPopovMBS
ms.date: 12/20/2021
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: epopov
ms.search.validFrom: 2019-3-1
ms.openlocfilehash: f03eab49f0abfc8a279ea43f69fa2ac0100bd34a
ms.sourcegitcommit: 0d2de52e12fdb9928556d37a4813a67b303695dc
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 12/21/2021
ms.locfileid: "7945029"
---
# <a name="fiscal-registration-service-integration-sample-for-austria"></a>عينة تكامل خدمة التسجيل المالي للنمسا

[!include[banner](../includes/banner.md)]

يقدم هذا الموضوع نظرة عامة على عينة التكامل المالي في النمسا في Microsoft Dynamics 365 Commerce.

للوفاء بالمتطلبات المالية المحلية لسجلات النقد في النمسا، تتضمن وظيفة Dynamics 365 Retail للنمسا عينة تكامل لنقطة البيع (POS) مع خدمة تسجيل مالية خارجية. ويقوم النموذج بتوسيع [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md). وهو يستند إلى حل [EFR (السجل المالي الإلكتروني)](https://www.efsta.eu/at/fiskalloesungen/oesterreich) من [EFSTA](https://www.efsta.eu/at/) ويقوم بتمكين الاتصال بخدمة EFR من خلال بروتوكول HTTPS. يجب استضافة خدمة EFR إما على محطة أجهزة البيع بالتجزئة أو على جهاز منفصل يمكن توصيله من محطة الأجهزة. يتم توفير العينة في شكل كود المصدر وهي جزء من مجموعة تطوير برامج البيع بالتجزئة (SDK).

لا تصدر Microsoft إيه أجهزه أو برامج أو وثائق من EFSTA. للحصول علي معلومات حول كيفيه الحصول علي حل EFR وتشغيله، اتصل بـ [EFSTA](https://www.efsta.eu/at/kontakt).

## <a name="scenarios"></a>السيناريوهات

تغطي السيناريوهات التالية نموذج تكامل خدمه التسجيل المالي للنمسا:

- تسجيل الحركات النقدية في خدمه التسجيل المالي:

    - إرسال بيانات الحركة التفصيلية إلى خدمه التسجيل المالي. تشتمل هذه البيانات علي معلومات بند المبيعات، ومعلومات حول الخصومات والمدفوعات والضرائب.
    - التقاط استجابه من خدمه التسجيل المالي. تتضمن هذه الاستجابة توقيعا رقميا وارتباطا بالحركة المسجلة.
    - يتيح تسجيل الضرائب وتعيينها إلى أكواد الضريبة الخاصة بخدمه التسجيل المالي.
    - يستخدم هذا الزر في طباعه شفره الاستجابة السريعة لحركه مسجله علي الإيصال.

- تسجيل عمليات بطاقة الهدايا وعمليات إيداع العملاء كحركات غير نقديه في خدمه التسجيل المالي:

    - إصدار أو إضافة أموال إلى بطاقة هدايا.
    - تسجيل إيداع حساب العميل.
    - تسجيل إيداع طلب العميل.

- تسجيل المعاملات والأحداث غير المتعلقة بالمبيعات كمعاملات غير نقدية في خدمة التسجيل المالي:

    - فتح وردية وإغلاق وردية
    - مبلغ البداية وإدخال التعويم وأزاله طريقه الدفع
    - تجاوز السعر
    - تجاوز الضريبة
    - طباعة نسخة من إيصال الاستلام
    - فتح الدرج
    - طباعة التقرير X
    - طباعة التقرير Z

- طباعه كشوفات نهاية اليوم (تقارير X/Z) التي لها حقول خاصه بالنمسا:

    - إجمالي عدد المنتجات أو الخدمات التي تم تسليمها إلى العملاء
    - تصنيف المبيعات حسب معدل الضريبة
    - تصنيف المدفوعات حسب عامل التشغيل النقدي للكاشير/الكاشير
    - خصومات السعر والمرتجعات التي تقلل من المبيعات اليومية
    - مبيعات صفرية (هدايا مجانية)

- معالجه الأخطاء، مثل الخيارات التالية:

    - قم باعاده محاولة التسجيل المالي إذا كانت أعاده المحاولة ممكنة، كما هو الحال في حاله عدم توفر خدمه التسجيل المالي أو انها غير جاهزه أو لا تستجيب.
    - تأجيل عملية التسجيل المالي.
    - يستخدم لتخطي التسجيل المالي أو وضع علامة علي الحركة كمسجله، وتضمين رموز المعلومات للتقاط سبب الفشل والمعلومات الاضافيه.
    - فحص توفر خدمه التسجيل المالي قبل فتح حركه مبيعات جديده أو إنهاء حركه مبيعات.

### <a name="gift-cards"></a>بطاقات الهدايا

يقوم نموذج تكامل خدمه التسجيل المالي بتطبيق القواعد التالية المرتبطة ببطاقات الهدايا:

- استبعاد سطور المبيعات ذات الصلة *إصدار بطاقة الهدايا* و *إضافة إلى بطاقة هدايا* عمليتان من معاملة نقدية. وبدلا من تسجيل هذه البنود كجزء من حركه نقديه، قم بتسجيلها كحركة منفصلة غير نقديه في خدمه التسجيل المالي.
- لا تقم بطباعه تصنيف الضريبة وكود QR في أحد الإيصالات إذا كانت عمليه الاستلام تتكون من بنود بطاقة الهدايا فقط.
- طباعه المبلغ الإجمالي لبطاقات الهدايا التي تم إصدارها أو أعاده شحنها في الحركة بشكل منفصل عن مبلغ الحركة النقدية في الإيصال.
- حفظ التسويات المحسوبة لبنود الدفع في قاعده بيانات القناة مع وجود مرجع لحركه مالية مقابله.
- ويعتبر الدفع حسب بطاقة الهدايا دفعا منتظما.

### <a name="customer-deposits-and-customer-order-deposits"></a>ودائع العملاء وودائع أوامر العملاء

يطبق نموذج تكامل خدمة التسجيل المالي القواعد التالية المتعلقة بإيداعات العملاء وإيداعات أوامر العميل:

- قم بتسجيل حركه غير نقديه إذا كانت الحركة عبارة عن إيداع للعميل.
- تسجيل حركه غير نقديه إذا كانت الحركة تحتوي علي إيداع أمر عميل أو مبلغ معاد الدفع بالإيداع لأمر العميل.
- خصم مبلغ إيداع أمر العميل من بنود الدفع عند إنشاء أمر عميل مختلط.
- احفظ التعديلات المحسوبة لبنود الدفع في قاعدة بيانات القناة بمرجع إلى حركة مالية لأمر زبون مختلط.

### <a name="limitations-of-the-sample"></a>قيود العينة

لا تدعم خدمه التسجيل المالي الا السيناريوهات التي يتم تضمين ضريبة المبيعات بها في السعر. لذلك، يجب تعيين خيار **السعر شامل ضريبة المبيعات** إلى **نعم** لكل من المتاجر والعملاء.

## <a name="set-up-commerce-for-austria"></a>اعداد Commerce للنمسا

يصف هذا القسم إعدادات Commerce الخاصة بالنمسا والموصي بها. لمزيد من المعلومات حول اعداد المعلومات، راجع [صفحة Commerce الرئيسية](../index.md).

لاستخدام وظيفة خاصه بالنمسا، يجب تحديد الإعدادات التالية:

- في العنوان الرئيسي للكيان القانوني، قم بتعيين حقل **البلد/المنطقة** إلى **AUT** (النمسا).
- في ملف تعريف وظيفة نقطه البيع لكل متجر موجود في النمسا، قم بتعيين حقل **رمز ISO** إلى **AT** (النمسا).

يجب أيضا تحديد الإعدادات التالية للنمسا. لاحظ انه يجب عليك تشغيل مهام التوزيع المناسبة بعد إكمال الاعداد.

### <a name="set-up-vat-per-austrian-requirements"></a>اعداد ضريبة القيمة المضافة لكل متطلبات النمساوية

يجب عليك إنشاء أكواد ضريبة المبيعات ومجموعات ضريبة المبيعات ومجموعات ضريبة مبيعات الأصناف. كما يجب اعداد معلومات ضريبة المبيعات للمنتجات والخدمات. لمزيد من المعلومات حول كيفية إعداد ميزات ضريبة المبيعات واستخدامها، راجع [نظرة عامة على ضريبة المبيعات](../../finance/general-ledger/indirect-taxes-overview.md).

في إيصالات المبيعات، يمكنك طباعة رمز مختصر لرمز ضريبة المبيعات (على سبيل المثال، "أ" أو "ب"). لجعل هذه الوظيفة متاحه، قم بتعيين حقل **كود الطباعة** في صفحة **أكواد ضريبة المبيعات**.

### <a name="set-up-stores"></a>إعداد المتاجر

في صفحة **جميع المتاجر**، قم بتحديث تفاصيل المتجر. على وجه التحديد، قم بتعيين المعلمات التالية:

- في حقل **مجموعة ضريبة المبيعات**، حدد مجموعة ضريبة المبيعات التي يجب استخدامها للمبيعات للعميل الافتراضي.
- قم بتعيين **الأسعار تتضمن ضريبة المبيعات** إلى **نعم**.
- قم بتعيين حقل **الاسم** إلى اسم الشركة. يساعد هذا التغيير علي ظهور اسم الشركة علي إيصال استلام المبيعات. وبدلا من ذلك، يمكنك أضافه اسم الشركة إلى تخطيط إيصال استلام المبيعات كنص حر الشكل.
- قم بتعيين حقل **رقم التعريف الضريبي (TIN)** إلى رقم تعريف الشركة. يساعد هذا التغيير في ضمان ظهور رقم تعريف الشركة في إيصال المبيعات. بدلاً من ذلك، يمكنك إضافة رقم تعريف الشركة إلى تخطيط إيصال المبيعات كنص حر.

### <a name="set-up-functionality-profiles"></a>إعداد ملفات تعريف الوظائف

قم بإعداد ملفات تعريف وظائف نقطة البيع:

- في علامة التبويب السريعة **ترقيم الإيصالات**، قم باعداد ترقيم الإيصال من خلال إنشاء أو تحديث السجلات الخاصة بأنواع حركات إيصالات **المبيعات**، و **أمر المبيعات**، و **الإرجاع**.

### <a name="configure-custom-fields-so-that-they-can-be-used-in-receipt-formats-for-sales-receipts"></a>تكوين الحقول المخصصة بحيث يمكن استخدامها في تنسيقات الاستلام لإيصالات المبيعات

يمكنك تكوين نص اللغة والحقول المخصصة المستخدمة في تنسيقات إيصالات نقطه البيع. يجب ان تكون الشركة الافتراضية للمستخدم الذي يقوم بإنشاء اعداد الإيصال هي نفس الكيان القانوني الذي يتم إنشاء اعداد نص اللغة فيه. وبدلا من ذلك، يجب إنشاء نفس نصوص اللغة في الشركة الافتراضية لكل من المستخدم والكيان القانوني للمتجر الذي تم إنشاء الاعداد له.

في صفحة **نص اللغة**، قم باضافه السجلات التالية لتسميات الحقول المخصصة لتخطيطات الإيصال. لاحظ أن قيم **معرف اللغة** و **معرف النص** و **النص** التي تظهر في الجدول هي أمثله فقط. يمكنك تغييرها لتلبي متطلباتك. ومع ذلك، يجب أن تكون قيم **معرف النص** التي تستخدمها فريدة، ويجب أن تكون مساوية لـ 900001 أو أكثر.

أضف تسميات نقطه البيع التالية إلى قسم **نقطة البيع** لـ **نص اللغة** من الجدول:

| معرف اللغة | معرف النص | النص                      |
|-------------|---------|---------------------------|
| ar‬       | 900001  | شفرة استجابة سريعة (QR)                   |
| ar‬       | 900002  | العدد المستمر         |
| ar‬       | 900003  | كود طباعه البيع بالتجزئة للضريبة     |
| ar‬       | 900004  | إجمالي (المبيعات)             |
| ar‬       | 900005  | إجمالي الضريبة (المبيعات)         |
| ar‬       | 900006  | إجمالي الضرائب المتضمنة (المبيعات) |
| ar‬       | 900007  | المبلغ الضريبي (المبيعات)        |
| ar‬       | 900008  | الأساس الضريبي (المبيعات)         |

في صفحة **الحقول المخصصة**، قم باضافه السجلات التالية للحقول المخصصة لتخطيطات الإيصالات. لاحظ أن قيم **معرف نص التسمية التوضيحية** يجب أن تكون متوافقة مع قيم **معرف النص** التي حددتها في صفحة **نص اللغة**:

| Name                 | النوع    | معرف نص التسمية التوضيحية |
|----------------------|---------|-----------------|
| QRCODE               | استلام | 900001          |
| CONTINUOUSNUMBER     | استلام | 900002          |
| RETAILPRINTCODE      | استلام | 900003          |
| SALESTOTAL           | استلام | 900004          |
| SALESTOTALTAX        | استلام | 900005          |
| SALESTOTALINCLUDETAX | استلام | 900006          |
| SALESTAXAMOUNT       | استلام | 900007          |
| SALESTAXBASIS        | استلام | 900008          |

> [!NOTE]
> من المهم تحديد أسماء الحقول المخصصة الصحيحة، كما هو موضح في الجدول السابق. سيتسبب اسم الحقل المخصص غير صحيح في فقدان البيانات في عمليات الاستلام.

### <a name="configure-receipt-formats"></a>تكوين تنسيقات الإيصالات

بالنسبة لكل تنسيق إيصال مطلوب، قم بتغيير قيمة حقل **سلوك الطباعة** إلى **الطباعة دائمًا**.

في مصمم تنسيق الإيصال، أضف الحقول المخصصة التالية إلى مقاطع الاستلام المناسبة. لاحظ ان أسماء الحقول تتوافق مع نصوص اللغة التي قمت بتحديدها في المقطع السابق.

- **الراس**: قم باضافه الحقول التالية:

    - حقلا **اسم المتجر** و **رقم التعريف الضريبي**، التي تستخدم لطباعه اسم الشركة ورقم الهوية علي إيصالات الاستلام. بدلاً من ذلك، يمكنك إضافة اسم الشركة ورقم الهوية إلى التخطيط كنص حر.
    - حقول **عنوان المتجر**، و **التاريخ**، و **الوقت 24 ساعة**، و **رقم الإيصال** و **رقم السجل**.
    - حقول **العدد المستمر**، لتحديد رقم الحركة النقدية في خدمه التسجيل المالي.

- **الأسطر**: قم باضافه الحقول التالية:

    - **اسم الصنف**.
    - **الكمية**.
    - **السعر الإجمالي شامل الضريبة**.
    - **كود طباعة البيع بالتجزئة الضريبي**، الذي يستخدم لطباعه الكود المختصر الذي يتوافق مع كود ضريبة المبيعات الذي ينطبق علي الصنف.

- **التذييل**: قم باضافه الحقول التالية:

    - حقول الدفع، بحيث تتم طباعه مبالغ الدفع الخاصة بكل طريقه دفع. علي سبيل المثال، قم باضافه حقلي **اسم طريقه الدفع** و **مبلغ طريقه الدفع** إلى بند واحد من التخطيط.
    - مجموعه حقول **إجمالي المبيعات**:

        - حقل **الإجمالي (مبيعات)**، الذي يستخدم لطباعه إجمالي مبلغ المبيعات النقدية للإيصال. المبلغ لا يشمل الضرائب. يتم استبعاد الدفعات المقدمة وعمليات بطاقة الهدايا.
        - حقل **إجمالي الضرائب المتضمنة (المبيعات)**، الذي يستخدم لطباعه إجمالي مبلغ المبيعات النقدية للإيصال. المبلغ يشمل الضريبة. يتم استبعاد الدفعات المقدمة وعمليات بطاقة الهدايا.
        - حقل **إجمالي الضرائب المتضمنة (المبيعات)**، الذي يستخدم لطباعة مبلغ ضريبة الإيصال الإجمالي للمبيعات النقدية. يتم استبعاد الدفعات المقدمة وعمليات بطاقة الهدايا.

    - مجموعه حقول **تقسيم الضريبة**. يجب طباعه كافة الحقول الموجودة في مجموعه الحقول هذه في بند منفصل واحد.

        - حقل **معرف الضريبة**، وهو حقل قياسي يمكن طباعه ملخص ضريبة المبيعات لكل كود ضريبة مبيعات. يجب أضافه الحقل إلى بند جديد.
        - حقل **النسبة المئوية للضريبة**، وهو عبارة عن حقل قياسي يستخدم لطباعه سعر الضريبة الفعال لكود ضريبة المبيعات.
        - حقل **أساس الضريبة (المبيعات)**، الذي يستخدم لطباعة الإيصال هو إجمالي مبلغ البيع النقدي لكود ضريبة المبيعات. يتم استبعاد الدفعات المقدمة وعمليات بطاقة الهدايا.
        - حقل **مبلغ الضريبة (المبيعات)**، الذي يستخدم لطباعة مبلغ ضريبة الإيصال للمبيعات النقدية لكود ضريبة المبيعات.
        - **كود طباعة البيع بالتجزئة الضريبي**، الذي يستخدم لطباعة الرمز المختصر الذي يتوافق مع رمز ضريبة المبيعات.

    - حقل **رمز الاستجابة السريعة**، الذي يستخدم لطباعه المرجع إلى الحركة النقدية المسجلة في النموذج شفره الاستجابة السريعة.

        > [!NOTE]
        > يتم استرداد قيمة **رمز الاستجابة السريعة** من استجابه السجل المالي. يقوم EFR بإرجاع رمز استجابه سريعة في الاستجابة الخاصة به فقط إذا كانت قيمه حقل **السمات** في تكوين EFR موضحه في وثائق EFSTA. يجب تعيين تنسيق رمز الاستجابة السريعة في حقل **السمات** في تكوين EFR إلى **BMP**.

لمزيد من المعلومات حول كيفية التعامل مع تنسيقات الإيصالات، راجع [إعداد وتصميم تنسيقات الإيصالات](../receipt-templates-printing.md).

## <a name="set-up-fiscal-integration-for-austria"></a>إعداد التكامل المالي للنمسا

تعتمد عينة تكامل خدمة التسجيل المالي للنمسا في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهي جزء من Retail SDK. النموذج موجود في مجلد **src\\FiscalIntegration\\Efr** الخاص [بحلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/)، المستودع (على سبيل المثال [النموذج في الإصدار/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33/src/FiscalIntegration/Efr)). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices) من موفر المستند المالي، وهو امتداد لCommerce Runtime (CRT)، والموصل المالي، وهو امتداد لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام Retail SDK، راجع [هندسة Retail SDK](../dev-itpro/retail-sdk/retail-sdk-overview.md)و[قم بإعداد تدفق البناء لمجموعة SDK المستقلة](../dev-itpro/build-pipeline.md).

> [!WARNING]
> وبسبب قيود [التعبئة المستقلة الجديدة ونموذج التوسيع](../dev-itpro/build-pipeline.md)، لا يمكن استخدامها حاليًا لنموذج التكامل المالي هذا. يجب استخدام الإصدار السابق من Retail SDK على الجهاز الظاهري (VM) للمطور في Microsoft Dynamics Lifecycle Services (LCS). لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي للنمسا (قديم)](emea-aut-fi-sample-sdk.md). يتم تخطيط الدعم الخاص بالتعبئة المستقلة الجديدة ونموذج الملحق الخاص بنماذج التكامل المالي للإصدارات اللاحقة.

قم بإكمال خطوات اعداد التكامل المالي كما هو موضح في [اعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md):

1. [إعداد عملية التسجيل المالي](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process). وكذلك قم بتسجيل الإعدادات الخاصة بعمليه التسجيل المالي [الخاصة بنموذج تكامل خدمه التسجيل المالي هذا](#set-up-the-registration-process).
1. [تعيين إعدادات معالجة الأخطاء‬](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).
1. [تمكين التنفيذ اليدوي للتسجيل المالي المؤجل](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).
1. [تكوين مكونات القناة](#configure-channel-components).

### <a name="set-up-the-registration-process"></a>إعداد عملية التسجيل

لتمكين عملية التسجيل، اتبع هذه الخطوات لإعداد مقر Commerce الرئيسي. لمزيد من المعلومات، راجع [إعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).

1. تنزيل ملفات التكوين لموفر المستند المالي والموصل المالي:

    1. افتح مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/).
    1. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك (علي سبيل المثال، **[إصدار/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33)**).
    1. افتح **src \> FiscalIntegration \> Efr**.
    1. افتح **التكوينات \> DocumentProviders**، وقم بتنزيل ملفات تكوين موفري المستندات المالية: **DocumentProviderFiscalEFRSampleAustria.xml** و **DocumentProviderNonFiscalEFRSampleAustria.xml** (على سبيل المثال، [موقع الملفات للإصدار/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33/src/FiscalIntegration/Efr/Configurations/DocumentProviders)).
    1. قم بتنزيل ملف تكوين الموصل المالي في **التكوينات \> الموصلات \> ConnectorEFRSample.xml** (على سبيل المثال، [ملف الإصدار/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/blob/release/9.33/src/FiscalIntegration/Efr/Configurations/Connectors/ConnectorEFRSample.xml)).

    > [!WARNING]
    > وبسبب قيود [التعبئة المستقلة الجديدة ونموذج التوسيع](../dev-itpro/build-pipeline.md)، لا يمكن استخدامها حاليًا لنموذج التكامل المالي هذا. يجب استخدام الإصدار السابق من Retail SDK على الجهاز الظاهري (VM) للمطور في LCS. توجد ملفات التكوين لعينة التكامل المالي هذه في المجلدات التالية من Retail SDK على الجهاز الظاهري VM للمطور في LCS:
    >
    > - **ملفات تكوين موفري المستندات المالية:** RetailSdk\\SampleExtensions\\CommerceRuntime\\Extensions.DocumentProvider.EFRSample\\Configuration
    > - **ملف تكوين الموصل المالي:** RetailSdk\\SampleExtensions\\HardwareStation\\Extension.EFRSample\\Configuration
    > 
    > يتم تخطيط الدعم الخاص بالتعبئة المستقلة الجديدة ونموذج الملحق الخاص بنماذج التكامل المالي للإصدارات اللاحقة.

1. انتقل إلى **Retail and Commerce \> إعداد Headquarters \> المعلمات \> معلمات Commerce المشتركة**. في علامة التبويب السريعة **عام**، عيّن خيار **تمكين التكامل المالي** إلى **نعم**.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> موفري المستندات المالية**، وقم بتحميل ملفات تكوين موفر المستندات المالية التي قمت بتنزيلها مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> الموصلات المالية**، وقم بتحميل ملف تكوين موفر المستندات المالية الذي قمت بتنزيله مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الوظيفية**. قم بإنشاء ملفي تعريف وظائفيتين جديدين للموصل، أحدهما لكل موفر مستند مالي قمت بتحميله سابقا، وحدد الموصل المالي الذي قمت بتحميله سابقا. قم بتحديث [إعدادات تعيين البيانات](#default-data-mapping) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الفنية**. قم بإنشاء ملف تعريف فني جديد للموصل، وحدد الرابط المالي الذي قمت بتحميله مسبقًا. قم بتحديث [إعدادات الموصل](#fiscal-connector-settings) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> مجموعات الموصلات المالية**. قم بإنشاء مجموعتي موصلات ماليتين جديدتين، واحده لكل ملف تعريف وظيفة الموصل الذي قمت بإنشاءه سابقا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> عمليات التسجيل المالي**. قم بإنشاء عمليه تسجيل مالية جديده وخطوتين لعمليه تسجيل ماليين، وحدد مجموعات الموصلات المالية التي قمت بإنشاءها سابقا.
1. انتقل إلى **البيع بالتجزئة والتجارة \> إعداد القناة \> إعداد قناة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الوظائف**. حدد ملف تعريف وظائف مرتبط بالمتجر حيث يجب تنشيط عمليه التسجيل. في علامة التبويب السريعة **عملية التسجيل المالي**، حدد عملية التسجيل المالي التي قمت بإنشائها مسبقًا. لتمكين تسجيل الاحداث غير المالية في نقطه البيع، في علامة التبويب السريعة **الوظائف**، ضمن **نقطه البيع**، قم بتعيين خيار **التدقيق** إلى **نعم**.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> إعداد نقطة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الأجهزة**. حدد ملف تعريف الجهاز المرتبط بمحطة الأجهزة التي سيتم توصيل الطابعة المالية بها. في علامة التبويب السريعة **الأجهزة الطرفية المالية**، حدد ملف التعريف الفني للموصل الذي قمت بإنشائه مسبقًا.
1. افتح جدول التوزيع (**Retail وCommerce \>تكنولوجيا معلومات Retail وCommerce\> جدول التوزيع**)، وحدد الوظيفتين **1070** و **1090** لنقل البيانات إلى قاعدة بيانت القناة.

#### <a name="default-data-mapping"></a>تعيين البيانات الافتراضي

يتم تضمين تعيين البيانات الافتراضي التالي في تكوين موفر المستندات المالية الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **تعيين أسعار ضريبة القيمة المضافة (VAT)** – تعيين قيم النسبة المئوية للضريبة التي تم اعدادها لأكواد ضريبة المبيعات إلى قيم سمة **TaxG** (مجموعه الضرائب) في الطلبات التي يتم إرسالها إلى الخدمة المالية. هنا هو التعيين الافتراضي:

    ```
    A: 20.00; B: 10.00; C: 13.00; D: 0.00; E: 19.00; F: 7.00
    ```

    يمثل المكون الأول في كل زوج مجموعه ضرائب ضريبة القيمة المضافة المعتمدة من قبل خدمه التسجيل المالي لـ EFR. المكون الثاني يمثل معدل ضريبة القيمة المضافة المقابلة. لمزيد من المعلومات حول مجموعات ضريبة القيمة المضافة التي تعتمد EFR للنمسا، راجع [مرجع EFR](https://public.efsta.net/efr/).

#### <a name="fiscal-connector-settings"></a>إعدادات الموصل المالي

يتم تضمين الإعدادات التالية في تكوين الرابط المالي الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **عنوان نقطة النهاية** – عنوان URL الخاص بخدمه التسجيل المالية.
- **مهلة الجهاز** – مقدار الوقت بالمللي ثانية الذي سينتظره الرابط المالي للحصول على استجابة من خدمة التسجيل المالي.
- **إظهار إخطارات التسجيل المالي** – تتحكم هذه العلامة في ما إذا كان سيتم عرض الإخطارات التي ترجعها خدمه التسجيل المالي لعامل التشغيل ام لا.

### <a name="configure-channel-components"></a>تكوين مكونات القناة

> [!WARNING]
> وبسبب قيود [التعبئة المستقلة الجديدة ونموذج التوسيع](../dev-itpro/build-pipeline.md)، لا يمكن استخدامها حاليًا لنموذج التكامل المالي هذا. يجب استخدام الإصدار السابق من Retail SDK على الجهاز الظاهري (VM) للمطور في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي للنمسا (قديم)](emea-aut-fi-sample-sdk.md).
>
> يتم تخطيط الدعم الخاص بالتعبئة المستقلة الجديدة ونموذج الملحق الخاص بنماذج التكامل المالي للإصدارات اللاحقة.

#### <a name="set-up-the-development-environment"></a>إعداد بيئة التطوير

لإعداد بيئة تطوير لاختبار العينة وتوسيعها، اتبع هذه الخطوات.

1. قم بنسخ مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions) أو تنزيله. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك. لمزيد من المعلومات، راجع [تنزيل نماذج Retail SDK والحزم المرجعية من GitHub وNuGet](../dev-itpro/retail-sdk/sdk-github.md).
1. افتح حل EFR على **Dynamics365Commerce.Solutions\\FiscalIntegration\\Efr\\EFR.sln**، وقم بإنشائه.
1. تثبيت ملحقات CRT:

    1. ابحث عن مثبت ملحق CRT:

        - **Commerce Scale Unit:** في مجلد **Efr\\ScaleUnit\\ScaleUnit.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ScaleUnit.EFR.Installer**.
        - **CRT المحلي على نقطة البيع الحديثة:** في مجلد **Efr\\ModernPOS\\ModernPOS.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ModernPOS.EFR.Installer**.

    1. ابدأ مثبت ملحق CRT من سطر الأوامر:

        - **Commerce Scale Unit:**

            ```Console
            ScaleUnit.EFR.Installer.exe install --verbosity 0
            ```

        - **CRT المحلي في نقطة البيع الحديثة:**

            ```Console
            ModernPOS.EFR.Installer.exe install --verbosity 0
            ```

1. تثبيت ملحقات محطة الأجهزة:

    1. في مجلد **Efr\\HardwareStation\\HardwareStation.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **HardwareStation.EFR.Installer**.
    1. أبدا بتشغيل مثبت الملحق من سطر الأوامر.

        ```Console
        HardwareStation.EFR.Installer.exe install --verbosity 0
        ```

#### <a name="production-environment"></a>بيئة الإنتاج

اتبع الخطوات الواردة في [إعداد تدفق البناء لنموذج تكامل مالي](fiscal-integration-sample-build-pipeline.md) لإنشاء وإصدار وحده مقياس السحابة وحزم الخدمة الذاتية القابلة للنشر لنموذج التكامل المالي. يمكن العثور على ملف YAML لقالب **EFR build-pipeline.yml** في مجلد **Pipeline\\YAML_Files** الخاص بمستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions).

## <a name="design-of-extensions"></a>تصميم الملحقات

تعتمد عينة تكامل خدمة التسجيل المالي للنمسا في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهي جزء من Retail SDK. النموذج موجود في مجلد **src\\FiscalIntegration\\Efr** الخاص [بحلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/)، المستودع (على سبيل المثال [النموذج في الإصدار/9.33](https://github.com/microsoft/Dynamics365Commerce.Solutions/tree/release/9.33/src/FiscalIntegration/Efr)). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices) من موفر المستند المالي، وهو ملحق لـ (CRT)، والموصل المالي، وهو ملحق لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام Retail SDK، راجع [هندسة Retail SDK](../dev-itpro/retail-sdk/retail-sdk-overview.md)و[قم بإعداد تدفق البناء لمجموعة SDK المستقلة](../dev-itpro/build-pipeline.md).

> [!WARNING]
> وبسبب قيود [التعبئة المستقلة الجديدة ونموذج التوسيع](../dev-itpro/build-pipeline.md)، لا يمكن استخدامها حاليًا لنموذج التكامل المالي هذا. يجب استخدام الإصدار السابق من Retail SDK على الجهاز الظاهري (VM) للمطور في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي للنمسا (قديم)](emea-aut-fi-sample-sdk.md). يتم تخطيط الدعم الخاص بالتعبئة المستقلة الجديدة ونموذج الملحق الخاص بنماذج التكامل المالي للإصدارات اللاحقة.

### <a name="commerce-runtime-extension-design"></a>تصميم ملحق Commerce Runtime

الغرض من الامتداد الذي يمثل موفر المستندات المالية هو إنشاء مستندات خاصة بالخدمة ومعالجة الاستجابات من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

هناك معالجان لطلب المستندات لموفري المستندات:

- **DocumentProviderEFRFiscalAUT** – يتم استخدام هذا المعالج لإنشاء مستندات مالية لخدمة التسجيل المالي.
- **DocumentProviderEFRNonFiscalAUT** – يتم استخدام هذا المعالج لإنشاء مستندات غير مالية لخدمة التسجيل المالي.

هذه المعالجات موروثة من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم موفر مستند الموصل المحدد في مقر Commerce الرئيسي.

يدعم الموصل الطلبات التالية:

- **GetFiscalDocumentDocumentProviderRequest** – يحتوي هذا الطلب على معلومات حول المستند الذي يجب إنشاؤه. تقوم بإرجاع مستند خاص بالخدمة يجب تسجيله في خدمة التسجيل المالي.
- **GetNonFiscalDocumentDocumentProviderRequest** – يحتوي هذا الطلب على معلومات حول المستند غير المالي الذي يجب إنشاؤه. تقوم بإرجاع مستند خاص بالخدمة يجب تسجيله في خدمة التسجيل المالي.
- **GetSupportedRegistrableEventsDocumentProviderRequest** – يعيد هذا الطلب قائمة الأحداث للاشتراك فيها. حاليًا، يتم دعم الأحداث التالية: المبيعات، وطباعة تقرير X، وطباعة تقرير Z، وإيداعات حساب العميل، وإيداعات أوامر العملاء، وأحداث التدقيق، والمعاملات غير المتعلقة بالمبيعات.
- **GetFiscalRegisterResponseToSaveDocumentProviderRequest** – يقوم هذا الطلب بإرجاع الاستجابة من خدمة التسجيل المالي. يتم اجراء تسلسل لهذه الاستجابة لتكوين سلسله بحيث تكون جاهزه ليتم حفظها.

#### <a name="configuration"></a>تكوين

توجد ملفات التكوين الخاصة بموفر المستندات المالية في مجلد **src\\FiscalIntegration\\Efr\\Configurations\\DocumentProviders** الخاص بمستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/):

- **DocumentProviderFiscalEFRSampleAustria** – ملف التكوين لموفر المستند المالي للمستندات المالية.
- **DocumentProviderNonFiscalEFRSampleAustria** – ملف التكوين لموفر المستندات المالية للمستندات غير المالية.

الغرض من هذه الملفات هو تمكين إعدادات موفر المستندات المالية المراد تكوينها من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

### <a name="hardware-station-extension-design"></a>تصميم ملحقات محطة الأجهزة

الغرض من الامتداد الذي يعتبر رابطًا ماليًا هو الاتصال بخدمة التسجيل المالي. يستخدم ملحق محطة الأجهزة بروتوكول HTTP لإرسال المستندات التي ينشئها ملحق CRT لخدمة التسجيل المالي. كما أنه يتعامل مع الاستجابات التي يتم تلقيها من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

معالج طلب **EFRHandler** هو نقطة الإدخال لمعالجة الطلبات إلى خدمة التسجيل المالي.

المعالج موروث من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم الموصل المالي المحدد في مقر Commerce الرئيسي.

يدعم الرابط المالي الطلبات التالية:

- **SubmitDocumentFiscalDeviceRequest** – يرسل هذا الطلب المستندات إلى خدمة التسجيل المالي ويعيد ردًا منها.
- **IsReadyFiscalDeviceRequest** – يُستخدم هذا الطلب لإجراء فحص سلامة لخدمة التسجيل المالي.
- **InitializeFiscalDeviceRequest** – يستخدم هذا الطلب لتهيئة خدمة التسجيل المالي.

#### <a name="configuration"></a>تكوين

يوجد ملف التكوين للموصل المالي في **src\\FiscalIntegration\\Efr\\Configurations\\Connectors\\ConnectorEFRSample.xml** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من الملف هو تمكين إعدادات الموصل المالي ليتم تكوينه من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
