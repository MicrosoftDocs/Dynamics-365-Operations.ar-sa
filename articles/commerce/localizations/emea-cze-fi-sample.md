---
title: عينة تكامل خدمة التسجيل المالي لجمهورية التشيك‬
description: يقدم هذا المقال نظرة عامة على عينة التكامل المالي في جمهورية التشيك في Microsoft Dynamics 365 Commerce.
author: EvgenyPopovMBS
ms.date: 08/17/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: josaw
ms.search.validFrom: 2019-04-01
ms.openlocfilehash: 3838792c0a420fb88ea9daab0a67c2e644c80681
ms.sourcegitcommit: 0feb5d0b06e04f99903069ff2801577be86b8555
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/18/2022
ms.locfileid: "9313737"
---
# <a name="fiscal-registration-service-integration-sample-for-the-czech-republic"></a>عينة تكامل خدمة التسجيل المالي لجمهورية التشيك‬

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

يقدم هذا المقال نظرة عامة على عينة التكامل المالي في جمهورية التشيك في Microsoft Dynamics 365 Commerce.

للوفاء بالمتطلبات المالية المحلية لسجلات النقد في جمهورية التشيك، تتضمن وظيفة Dynamics 365 Commerce لجمهورية التشيك عينة تكامل لنقطة البيع (POS) مع خدمة تسجيل مالية خارجية. ويقوم النموذج بتوسيع [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md). وهو يستند إلى حل [EFR (السجل المالي الإلكتروني)](https://efsta.org/sicherheitsloesungen/) من [EFSTA](https://efsta.org/) ويقوم بتمكين الاتصال بخدمة EFR من خلال بروتوكول HTTPS. تضمن خدمة EFR التسجيل الإلكتروني للمبيعات (Elektronická evidence tržeb \[EET\]). بمعني آخر ، يضمن الإرسال عبر الإنترنت لبيانات المبيعات إلى خدمه ويب المالية الخاصة بهيئات الضرائب. يجب استضافة خدمة EFR إما على محطة أجهزة Commerce أو على جهاز منفصل يمكن توصيله من محطة الأجهزة. يتم توفير العينة في شكل كود المصدر وهو جزء من مجموعة تطوير برامج التجارة (SDK).

لا تصدر Microsoft إيه أجهزه أو برامج أو وثائق من EFSTA. للحصول علي معلومات حول كيفيه الحصول علي حل EFR وتشغيله، اتصل بـ [EFSTA](https://efsta.org/kontakt/).

## <a name="scenarios"></a>السيناريوهات

تغطي السيناريوهات التالية نموذج تكامل خدمه التسجيل المالي لجمهورية التشيك:

- تسجيل الحركات النقدية في خدمه التسجيل المالي.

    - إرسال بيانات الحركة التفصيلية إلى خدمه التسجيل المالي. تشتمل هذه البيانات علي معلومات بند المبيعات، ومعلومات حول الخصومات والمدفوعات والضرائب. تقوم خدمه التسجيل المالي بإرسال البيانات إلى خدمه الويب الخاصة بهيئات الضرائب وتتلقي تاكيدا منها والتي تتضمن كود التعريف المالي للحركة.
    - التقاط استجابه من خدمه التسجيل المالي. تشتمل هذه الاستجابة علي البيانات المالية مثل كود التعريف المالي وكود الأمان الخاص بالحركة، الخ.
    - اطبع البيانات المالية لحركة مسجلة على الإيصال.

- تسجيل عمليات بطاقات الهدايا وإيداعات العملاء في خدمة التسجيل المالي.

    - إصدار أو إضافة أموال إلى بطاقة هدايا.
    - تسجيل إيداع حساب العميل.
    - إنشاء أمر العميل وتسجيل عمليه إيداع للأمر.
    - قم بتحرير طلب العميل وتجاوز الإيداع للأمر.
    - إلغاء طلب العميل واسترداد الإيداع للأمر.

- معالجه الأخطاء، مثل الخيارات التالية.

    - قم باعاده محاولة التسجيل المالي إذا كانت أعاده المحاولة ممكنة، كما هو الحال في حاله عدم توفر خدمه التسجيل المالي أو انها غير جاهزه أو لا تستجيب.
    - تأجيل عملية التسجيل المالي.
    - يستخدم لتخطي التسجيل المالي أو وضع علامة علي الحركة كمسجله، وتضمين رموز المعلومات للتقاط سبب الفشل والمعلومات الاضافيه.
    - فحص توفر خدمه التسجيل المالي قبل فتح حركه مبيعات جديده أو إنهاء حركه مبيعات.

### <a name="gift-cards"></a>بطاقات الهدايا

يقوم نموذج تكامل خدمه التسجيل المالي بتطبيق القواعد التالية المرتبطة ببطاقات الهدايا.

- يتم تمييز بنود المبيعات المرتبطة بعمليات *إصدار بطاقة الهدايا* أو *إضافة إلى بطاقة الهدايا* في حركة المبيعات بسمه خاصه عندما تكون الحركة مسجله في خدمه التسجيل المالي.
- ويعتبر الدفع بواسطة بطاقة الهدايا دفعا دوريا وتمييزه بسمه خاصه عندما تكون الحركة مسجله في خدمه التسجيل المالي.

### <a name="customer-account-deposits-and-customer-order-deposits"></a>الودائع الخاصة بحساب العميل وإيداعات أمر العميل

يقوم نموذج تكامل خدمة التسجيل المالي بتنفيذ القواعد التالية المتعلقة بإيداعات حساب العميل وإيداعات أوامر العميل.

- يتم تسجيل الحركة المرتبطة بإيداع حساب عميل أو إيداع أمر عميل في خدمه التسجيل المالي كحركة بند فرديه ويتم تمييزها بسمه خاصه. يتم تحديد مجموعه ضريبة القيمة المضافة الخاصة بالإيداع في هذا البند.
- عند إنشاء أمر عميل مختلط، وهو أمر عميل يحتوي علي منتجات يمكن اجراؤها من المتجر بواسطة العميل، بالاضافه إلى المنتجات التي سيتم انتقاؤها أو شحنها لاحقا، تحتوي الحركة المسجلة في خدمه التسجيل المالي علي بنود للمنتجات التي يتم تنفيذها، بالاضافه إلى بند لإيداع الأمر.
- تعتبر الدفعة من حساب العميل دفعة منتظمة ويتم تمييزها بسمة خاصة عند تسجيل الحركة في خدمة التسجيل المالي.
- مبلغ إيداع طلب العميل الذي يتم تطبيقه على عملية استلام أمر العميل دفعة منتظمة ويتم تمييزها بسمة خاصة عندما يتم تسجيل المعاملة في خدمة التسجيل المالي.

### <a name="offline-registration"></a>تسجيل دون اتصال

إذا فشلت خدمة التسجيل المالي في إرسال بيانات المعاملات إلى خدمة الويب المالية للسلطات الضريبية (على سبيل المثال، بسبب مهلة الاستجابة) وتلقي تأكيد من خدمة الويب (أي رمز التعريف المالي للمعاملة)، يقوم بإنشاء توقيع محلي للمعاملة ويتضمن ذلك رمز خطأ خاص في الاستجابة. تعيد خدمة التسجيل المالي إرسال المعاملات بالترتيب الأصلي في الخلفية بمجرد استعادة اتصال الشبكة.

### <a name="limitations-of-the-sample"></a>قيود العينة

لا تدعم خدمه التسجيل المالي الا السيناريوهات التي يتم تضمين ضريبة المبيعات بها في السعر. لذلك، يجب تعيين خيار **السعر شامل ضريبة المبيعات** إلى **نعم** لكل من المتاجر والعملاء.

## <a name="set-up-commerce-for-the-czech-republic"></a>إعداد Commerce لجمهورية التشيك

يصف هذا القسم إعدادات Commerce الخاصة بجمهورية التشيك والموصي بها. - لمزيد من المعلومات، راجع [صفحة Commerce الرئيسية](../index.md).

لاستخدام وظيفة خاصه بجمهورية التشيك، يجب تحديد الإعدادات التالية.

- في العنوان الرئيسي للكيان القانوني، قم بتعيين حقل **البلد/المنطقة** إلى **CZE** (جمهورية التشيك).
- في ملف تعريف وظيفة نقطه البيع لكل متجر موجود في جمهورية التشيك، قم بتعيين حقل **رمز ISO** إلى **CZ** (جمهورية التشيك).

يجب أيضا تحديد الإعدادات التالية لجمهورية التشيك. لاحظ انه يجب عليك تشغيل مهام التوزيع المناسبة بعد إكمال الاعداد.

### <a name="set-up-vat-per-czech-republic-requirements"></a>إعداد ضريبة القيمة المضافة حسب متطلبات جمهورية التشيك


يجب عليك إنشاء أكواد ضريبة المبيعات ومجموعات ضريبة المبيعات ومجموعات ضريبة مبيعات الأصناف. كما يجب اعداد معلومات ضريبة المبيعات للمنتجات والخدمات. لمزيد من المعلومات حول كيفية إعداد ميزات ضريبة المبيعات واستخدامها، راجع [نظرة عامة على ضريبة المبيعات](../../finance/general-ledger/indirect-taxes-overview.md).

### <a name="set-up-stores"></a>إعداد المتاجر

في صفحة **جميع المتاجر**، قم بتحديث تفاصيل المتجر. على وجه التحديد، قم بتعيين المعلمات التالية.

- في حقل **مجموعة ضريبة المبيعات**، حدد مجموعة ضريبة المبيعات التي يجب استخدامها للمبيعات للعميل الافتراضي.
- قم بتعيين **الأسعار تتضمن ضريبة المبيعات** إلى **نعم**.
- قم بتعيين حقل **الاسم** إلى اسم الشركة. يساعد هذا التغيير علي ظهور اسم الشركة علي إيصال استلام المبيعات. وبدلا من ذلك، يمكنك أضافه اسم الشركة إلى تخطيط إيصال استلام المبيعات كنص حر الشكل.
- قم بتعيين حقل **رقم التعريف الضريبي (TIN)** إلى رقم تعريف الشركة. يساعد هذا التغيير في ضمان ظهور رقم تعريف الشركة في إيصال المبيعات. بدلاً من ذلك، يمكنك إضافة رقم تعريف الشركة إلى تخطيط إيصال المبيعات كنص حر.

### <a name="set-up-functionality-profiles"></a>إعداد ملفات تعريف الوظائف

قم بإعداد ملفات تعريف وظائف نقطة البيع.

- في علامة التبويب السريعة **ترقيم الإيصالات**، قم باعداد ترقيم الإيصال من خلال إنشاء أو تحديث السجلات الخاصة بأنواع حركات إيصالات **المبيعات**، و **أمر المبيعات**، و **الإرجاع**.

### <a name="set-up-registration-numbers"></a>إعداد أرقام التسجيل

1. انتقل إلى **إدارة المؤسسة \> دفتر العناوين العمومي \> أنواع التسجيل \> أنواع التسجيل**. أنشئ نوع تسجيل جديدًا. حدد حقل **البلد/المنطقة** إلى **CZE** (جمهورية التشيك) واجعله مقصورًا على المؤسسة.
2. انتقل إلى **إدارة المؤسسة \> دفتر العناوين العمومي \> أنواع التسجيل \> فئات التسجيل**. أنشئ فئة تسجيل جديدة. حدد نوع التسجيل من الخطوة السابقة وقم بتعيين **فئة التسجيل** إلى **معرف مكان العمل**.
3. انتقل إلى **إدارة المؤسسة \> المؤسسات \> وحدات التشغيل**. بالنسبة لكل متجر يقع في جمهورية التشيك، حدد الوحدة المتعلقة بالمتجر. في علامة التبويب السريعة **العنوان**، قم بتوسيع القائمة المنسدلة **مزيد من الخيارات**، ثم حدد **متقدم**. 
4. في صفحة **إدارة العناوين** المفتوحة، يجب عليك تحديد الإعدادات التالية:

    - في علامة التبويب السريعة **العنوان**، قم بتعيين **البلد/المنطقة** إلى **CZE**.
    - في علامة التبويب السريعة **معرف التسجيل**، قم بإنشاء سجل جديد. حدد نوع التسجيل الذي تم إنشاؤه مسبقًا وقم بتعيين رقم التسجيل.

### <a name="configure-custom-fields-so-that-they-can-be-used-in-receipt-formats-for-sales-receipts"></a>تكوين الحقول المخصصة بحيث يمكن استخدامها في تنسيقات الاستلام لإيصالات المبيعات

يمكنك تكوين نص اللغة والحقول المخصصة المستخدمة في تنسيقات إيصالات نقطه البيع. يجب ان تكون الشركة الافتراضية للمستخدم الذي يقوم بإنشاء اعداد الإيصال هي نفس الكيان القانوني الذي يتم إنشاء اعداد نص اللغة فيه. وبدلا من ذلك، يجب إنشاء نفس نصوص اللغة في الشركة الافتراضية لكل من المستخدم والكيان القانوني للمتجر الذي تم إنشاء الاعداد له.

في صفحة **نص اللغة**، قم باضافه السجلات التالية لتسميات الحقول المخصصة لتخطيطات الإيصال. لاحظ أن قيم **معرف اللغة** و **معرف النص** و **النص** التي تظهر في الجدول هي أمثله فقط. يمكنك تغييرها لتلبي متطلباتك. ومع ذلك، يجب أن تكون قيم **معرف النص** التي تستخدمها فريدة، ويجب أن تكون مساوية لـ 900001 أو أكثر.

أضف تسميات نقطه البيع التالية إلى قسم **نقطة البيع** لـ **نص اللغة** من الجدول:

| معرف اللغة | معرف النص | النص                   |
|-------------|---------|------------------------|
| ar‬       | 900001  | معرف provozovny/pokladny |
| ar‬       | 900002  | BKP                    |
| ar‬       | 900003  | PKP                    |
| ar‬       | 900004  | FIK                    |
| ar‬       | 900005  | معلومات                   |
| ar‬       | 900006  | الرقم التسلسلي        |

في صفحة **الحقول المخصصة**، قم باضافه السجلات التالية للحقول المخصصة لتخطيطات الإيصالات. لاحظ أن قيم **معرف نص التسمية التوضيحية** يجب أن تكون متوافقة مع قيم **معرف النص** التي حددتها في صفحة **نص اللغة**:

| Name                 | النوع    | معرف نص التسمية التوضيحية |
|----------------------|---------|-----------------|
| TLT                  | استلام | 900001          |
| SEC                  | استلام | 900002          |
| علامة                 | استلام | 900003          |
| مالي               | استلام | 900004          |
| معلومات                 | استلام | 900005          |
| CONTINUOUSNUMBER     | استلام | 900006          |

> [!NOTE]
> من المهم تحديد أسماء الحقول المخصصة الصحيحة، كما هو موضح في الجدول السابق. سيتسبب اسم الحقل المخصص غير صحيح في فقدان البيانات في عمليات الاستلام.

### <a name="configure-receipt-formats"></a>تكوين تنسيقات الإيصالات

بالنسبة لكل تنسيق إيصال مطلوب، قم بتغيير قيمة حقل **سلوك الطباعة** إلى **الطباعة دائمًا**.

في مصمم تنسيق الإيصال، أضف الحقول المخصصة التالية إلى مقاطع الاستلام المناسبة. لاحظ ان أسماء الحقول تتوافق مع نصوص اللغة التي قمت بتحديدها في المقطع السابق.

- **الراس**: قم باضافه الحقول التالية.

    - حقلا **اسم المتجر** و **رقم التعريف الضريبي**: يُستخدم هذين الحقلين لطباعه اسم الشركة ورقم الهوية علي إيصالات الاستلام. بدلاً من ذلك، يمكنك إضافة اسم الشركة ورقم الهوية إلى التخطيط كنص حر.
    - **عنوان المتجر**، و **التاريخ**، و **الوقت 24 ساعة**، و **رقم الإيصال** و **رقم السجل**.
    - **الرقم المسلسل**: يحدد هذا الحقل رقم المعاملة النقدية في خدمة التسجيل المالي.

- **الأسطر**: قم باضافه الحقول التالية.

    - **اسم الصنف**
    - **الكمية**
    - **السعر الإجمالي شامل الضريبة**

- **التذييل**: قم باضافه الحقول التالية.

    - حقول الدفع، بحيث تتم طباعه مبالغ الدفع الخاصة بكل طريقه دفع. علي سبيل المثال، قم باضافه حقلي **اسم طريقه الدفع** و **مبلغ طريقه الدفع** إلى بند واحد من التخطيط.
    - **معرف provozovny/pokladny**: يقوم هذا الحقل بطباعه معرفات الشركة الداخلية والسجل النقدي.
    - **BKP**: يقوم هذا الحقل بطباعه كود أمان الممول الذي تم تعيينه بواسطة خدمه التسجيل المالي.
    - **FIK**: يقوم هذا الحقل بطباعه كود التعريف المالي للحركة التي تم تعيينها بواسطة خدمه الويب الخاصة بالضرائب في حاله وجود تسجيل مباشر.
    - **PKP**: يقوم هذا الحقل بطباعه كود توقيع الممول الذي تم إنشاؤه بواسطة خدمه التسجيل المالية في حاله التسجيل دون اتصال.
    - **معلومات**: يقوم هذا الحقل بطباعه المعلومات الاضافيه من خدمه التسجيل المالي.

لمزيد من المعلومات حول كيفية التعامل مع تنسيقات الإيصالات، راجع [إعداد وتصميم تنسيقات الإيصالات](../receipt-templates-printing.md).

## <a name="set-up-fiscal-integration-for-the-czech-republic"></a>إعداد التكامل المالي لجمهورية التشيك

تعتمد عينة تكامل خدمة التسجيل المالي لجمهورية التشيك في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهي جزء من Commerce SDK. تقع العينة في مجلد **src\\FiscalIntegration\\Efr** في مستودع [حلول Dynamics 365 Commerce ](https://github.com/microsoft/Dynamics365Commerce.Solutions/). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) من موفر المستند المالي، وهو امتداد ل Commerce Runtime (CRT)، والموصل المالي، وهو امتداد لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام SDK التجارية ، راجع [تنزيل نماذج sdk والحزم المرجعية الخاصة بالتجارة من GitHub واعداد NuGet](../dev-itpro/retail-sdk/sdk-github.md) تدفقات [بناء لمجموعه SDK](../dev-itpro/build-pipeline.md)المستقلة.

> [!NOTE]
> يتوفر نموذج تكامل خدمة التسجيل المالي لجمهورية التشيك في Commerce SDK اعتبارًا من الإصدار 10.0.29 من Commerce. في الإصدار التجاري 10.0.28 أو إصدار سابق ، يجب استخدام الإصدار السابق من Retail SDK على جهاز ظاهري للمطور (VM) في Microsoft Dynamics Lifecycle Services (LCS). لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لجمهورية التشيك (قديم)](emea-cze-fi-sample-sdk.md).

قم بإكمال خطوات اعداد التكامل المالي كما هو موضح في [اعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md):

1. [إعداد عملية التسجيل المالي](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process). وكذلك قم بتسجيل الإعدادات الخاصة بعمليه التسجيل المالي [الخاصة بنموذج تكامل خدمه التسجيل المالي هذا](#set-up-the-registration-process).
1. [تعيين إعدادات معالجة الأخطاء‬](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).
1. [تمكين التنفيذ اليدوي للتسجيل المالي المؤجل](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).
1. [تكوين مكونات القناة](#configure-channel-components).

### <a name="set-up-the-registration-process"></a>إعداد عملية التسجيل

لتمكين عملية التسجيل، اتبع هذه الخطوات لإعداد مقر Commerce الرئيسي. لمزيد من المعلومات، راجع [إعداد التكامل المالي لقنوات Commerce](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).

1. تنزيل ملفات التكوين لموفر المستند المالي والموصل المالي:

    1. افتح مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/).
    1. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك.
    1. افتح **src \> FiscalIntegration \> Efr**.
    1. قم بتنزيل ملف تكوين موفر المستندات المالية في **التكوينات \> مقدم المستند \>DocumentProviderFiscalEFRSampleCzech.xml**.
    1. قم بتنزيل ملف تكوين الرابط المالي في **التكوينات \> الموصلات \> ConnectorEFRSample.xml**.

    > [!NOTE]
    > في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. توجد ملفات التكوين لعينة التكامل المالي هذه في المجلدات التالية من Retail SDK على الجهاز الظاهري VM للمطور في LCS:
    >
    > - **ملفات تكوين موفري المستندات المالية:** RetailSdk\\SampleExtensions\\CommerceRuntime\\Extensions.DocumentProvider.EFRSample\\Configuration\\DocumentProviderFiscalEFRSampleCzech.xml
    > - **ملف تكوين الموصل المالي:** RetailSdk\\SampleExtensions\\HardwareStation\\Extension.EFRSample\\Configuration\\ConnectorEFRSample.xml

1. انتقل إلى **Retail and Commerce \> إعداد Headquarters \> المعلمات \> معلمات Commerce المشتركة**. في علامة التبويب السريعة **عام**، عيّن خيار **تمكين التكامل المالي** إلى **نعم**.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> موفري المستندات المالية**، وقم بتحميل ملف تكوين موفر المستندات المالية الذي قمت بتنزيله مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> الموصلات المالية**، وقم بتحميل ملف تكوين موفر المستندات المالية الذي قمت بتنزيله مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الوظيفية**. أنشئ ملف تعريف الموصل الوظيفي الجديد. حدد موفر المستند والموصل الذي قمت بتحميله سابقًا. قم بتحديث [إعدادات تعيين البيانات](#default-data-mapping) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> ملفات تعريف الموصل الفنية**. قم بإنشاء ملف تعريف فني جديد للموصل، وحدد الرابط المالي الذي قمت بتحميله مسبقًا. قم بتحديث [إعدادات الموصل](#fiscal-connector-settings) كما هو مطلوب.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> مجموعات الموصلات المالية**. قم بإنشاء مجموعة رابط مالي جديدة لملف التعريف الوظيفي للموصل الذي قمت بإنشائه مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> التكامل المالي \> عمليات التسجيل المالي**. قم بإنشاء عملية تسجيل مالي جديد وخطوة عملية تسجيل مالي، وحدد مجموعة الرابط المالي الذي قمت بإنشائه مسبقًا.
1. انتقل إلى **البيع بالتجزئة والتجارة \> إعداد القناة \> إعداد قناة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الوظائف**. حدد ملف تعريف وظائف مرتبط بالمتجر حيث يجب تنشيط عمليه التسجيل. في علامة التبويب السريعة **عملية التسجيل المالي**، حدد عملية التسجيل المالي التي قمت بإنشائها مسبقًا.
1. انتقل إلى **Retail وCommerce \> إعداد القناة \> إعداد نقطة البيع \> ملفات تعريف نقطة البيع \> ملفات تعريف الأجهزة**. حدد ملف تعريف الجهاز المرتبط بمحطة الأجهزة التي سيتم توصيل خدمة التسجيل المالي بها. في علامة التبويب السريعة **الأجهزة الطرفية المالية**، حدد ملف التعريف الفني للموصل الذي قمت بإنشائه مسبقًا.
1. افتح جدول التوزيع (**Retail وCommerce \>تكنولوجيا معلومات Retail وCommerce\> جدول التوزيع**)، وحدد الوظيفتين **1070** و **1090** لنقل البيانات إلى قاعدة بيانت القناة.

#### <a name="default-data-mapping"></a>تعيين البيانات الافتراضي

يتم تضمين تعيين البيانات الافتراضي التالي في تكوين موفر المستندات المالية الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **تعيين أسعار ضريبة القيمة المضافة (VAT)** – تعيين قيم النسبة المئوية للضريبة التي تم اعدادها لأكواد ضريبة المبيعات إلى قيم سمة **TaxG** (مجموعه الضرائب) في الطلبات التي يتم إرسالها إلى الخدمة المالية. هنا هو التعيين الافتراضي:

    ```
    A: 21.00; B: 15.00; C: 10.00; Z: 0.00
    ```

    يمثل المكون الأول في كل زوج مجموعه ضرائب ضريبة القيمة المضافة المعتمدة من قبل خدمه التسجيل المالي لـ EFR. المكون الثاني يمثل معدل ضريبة القيمة المضافة المقابلة. لمزيد من المعلومات حول مجموعات ضريبة القيمة المضافة التي تعتمد EFR لجمهورية التشيك، راجع [مرجع EFR](https://public.efsta.net/efr/).

- **تعيين مجموعه ضريبة القيمة المضافة الافتراضي** - سيتم تعيين إيه مبالغ ضريبة قيمه مضافه لا يمكن تعيينها إلى أحدي مجموعات ضريبة القيمة المضافة المحددة مسبقا إلى مجموعه ضريبة القيمة المضافة الافتراضية (الاساسيه). هنا هو التعيين الافتراضي:

    ```
    A
    ```

- **إيداع تعيين مجموعة ضريبة القيمة المضافة** - سيتم تعيين مبالغ إيداعات العميل ومبالغ إيداع أمر العميل إلى مجموعه ضريبة القيمة المضافة الخاصة بالإيداع. هنا هو التعيين الافتراضي:

    ```
    Z
    ```

#### <a name="fiscal-connector-settings"></a>إعدادات الموصل المالي

يتم تضمين الإعدادات التالية في تكوين الرابط المالي الذي يتم توفيره كجزء من نموذج التكامل المالي:

- **عنوان نقطة النهاية** – عنوان URL الخاص بخدمه التسجيل المالية.
- **المهلة** – مقدار الوقت بالمللي ثانية الذي سينتظره الرابط المالي للحصول على استجابة من خدمة التسجيل المالي.

### <a name="configure-channel-components"></a>تكوين مكونات القناة

> [!NOTE]
> - يتوفر نموذج تكامل خدمة التسجيل المالي لجمهورية التشيك في Commerce SDK اعتبارًا من الإصدار 10.0.29 من Commerce. في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لجمهورية التشيك (قديم)](emea-cze-fi-sample-sdk.md).
> - لا يتم تحديث العينات التجارية التي يتم نشرها في البيئة تلقائيا عند تطبيق تحديثات الخدمة أو الجودة علي مكونات التجارة. يجب تحديث النماذج المطلوبة يدويا.

#### <a name="set-up-the-development-environment"></a>إعداد بيئة التطوير

لإعداد بيئة تطوير لاختبار العينة وتوسيعها، اتبع هذه الخطوات.

1. قم بنسخ مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions) أو تنزيله. حدد إصدار فرع إصدار صحيح وفقا لإصدار التطبيق أو SDK الخاص بك. لمزيد من المعلومات، راجع [تنزيل نماذج Commerce SDK والحزم المرجعية من GitHub و NuGet](../dev-itpro/retail-sdk/sdk-github.md).
1. افتح حل EFR على **Dynamics365Commerce.Solutions\\FiscalIntegration\\Efr\\EFR.sln**، وقم بإنشائه.
1. تثبيت ملحقات CRT:

    1. ابحث عن مثبت ملحق CRT:

        - **Commerce Scale Unit:** في مجلد **Efr\\ScaleUnit\\ScaleUnit.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ScaleUnit.EFR.Installer**.
        - **CRT المحلي على نقطة البيع الحديثة:** في مجلد **Efr\\ModernPOS\\ModernPOS.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **ModernPOS.EFR.Installer**.

    1. ابدأ مثبت ملحق CRT من سطر الأوامر:

        - **Commerce Scale Unit:**

            ```Console
            ScaleUnit.EFR.Installer.exe install --verbosity 0
            ```

        - **CRT المحلي في نقطة البيع الحديثة:**

            ```Console
            ModernPOS.EFR.Installer.exe install --verbosity 0
            ```

1. تثبيت ملحقات الموصل المالي

    يمكنك تثبيت ملحقات الموصل المالي في [محطة الأجهزة](fiscal-integration-for-retail-channel.md#fiscal-registration-is-done-via-a-device-connected-to-the-hardware-station) أو [سجل نقطة البيع](fiscal-integration-for-retail-channel.md#fiscal-registration-is-done-via-a-device-or-service-in-the-local-network).

    1. تثبيت ملحقات محطة الأجهزة:

        1. في مجلد **Efr\\HardwareStation\\HardwareStation.EFR.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **HardwareStation.EFR.Installer**.
        1. ابدأ بتشغيل مثبت الملحق من سطر الأوامر عن طريق تشغيل الأمر التالي.

            ```Console
            HardwareStation.EFR.Installer.exe install --verbosity 0
            ```

    1. تثبيت ملحقات نقطة البيع:

        1. افتح حل عينة الموصل المالي لنقطة البيع في **Dynamics365Commerce.Solutions\\FiscalIntegration\\PosFiscalConnectorSample\\Contoso.PosFiscalConnectorSample.sln**، وقم بإنشائه.
        1. في مجلد **PosFiscalConnectorSample\\StoreCommerce.Installer\\bin\\Debug\\net461**، ابحث عن مثبت **Contoso.PosFiscalConnectorSample.StoreCommerce.Installer**.
        1. ابدأ بتشغيل مثبت الملحق من سطر الأوامر عن طريق تشغيل الأمر التالي.

            ```Console
            Contoso.PosFiscalConnectorSample.StoreCommerce.Installer.exe install --verbosity 0
            ```

#### <a name="production-environment"></a>بيئة الإنتاج

اتبع الخطوات الواردة في [إعداد تدفق البناء لنموذج تكامل مالي](fiscal-integration-sample-build-pipeline.md) لإنشاء وإصدار وحده مقياس السحابة وحزم الخدمة الذاتية القابلة للنشر لنموذج التكامل المالي. يمكن العثور على ملف YAML لقالب **EFR build-pipeline.yml** في مجلد **Pipeline\\YAML_Files** الخاص بمستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions).

## <a name="design-of-extensions"></a>تصميم الملحقات

تعتمد عينة تكامل خدمة التسجيل المالي لجمهورية التشيك في [وظيفة التكامل المالي](fiscal-integration-for-retail-channel.md) وهي جزء من Commerce SDK. تقع العينة في مجلد **src\\FiscalIntegration\\Efr** في مستودع [حلول Dynamics 365 Commerce ](https://github.com/microsoft/Dynamics365Commerce.Solutions/). يتكون [النموذج](fiscal-integration-for-retail-channel.md#fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices-and-services) من موفر المستند المالي، وهو ملحق لـ (CRT)، والموصل المالي، وهو ملحق لمحطة أجهزة Commerce. لمزيد من المعلومات حول كيفيه استخدام SDK التجارية ، راجع [تنزيل نماذج sdk والحزم المرجعية الخاصة بالتجارة من GitHub واعداد NuGet](../dev-itpro/retail-sdk/retail-sdk-overview.md) تدفقات [بناء لمجموعه SDK](../dev-itpro/build-pipeline.md)المستقلة.

> [!NOTE]
> يتوفر نموذج تكامل خدمة التسجيل المالي لجمهورية التشيك في Commerce SDK اعتبارًا من الإصدار 10.0.29 من Commerce. في الإصدار التجاري 10.0.28 أو ما قبله ، يجب استخدام الإصدار السابق من Retail SDK على مطور VM في LCS. لمزيد من المعلومات، راجع [إرشادات التوزيع الخاصة بنموذج التكامل المالي لجمهورية التشيك (قديم)](emea-cze-fi-sample-sdk.md).

### <a name="commerce-runtime-extension-design"></a>تصميم ملحق Commerce Runtime

الغرض من الامتداد الذي يمثل موفر المستندات المالية هو إنشاء مستندات خاصة بالخدمة ومعالجة الاستجابات من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

يوجد معالج طلب **DocumentProviderEFRFiscalCZE** لموفر المستندات، والذي يستخدم لإنشاء المستندات المالية لخدمه التسجيل المالي.

هذا المعالج موروث من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم موفر مستند الموصل المحدد في مقر Commerce الرئيسي.

يدعم الموصل الطلبات التالية.

- **GetFiscalDocumentDocumentProviderRequest** – يحتوي هذا الطلب على معلومات حول المستند الذي يجب إنشاؤه. تقوم بإرجاع مستند خاص بالخدمة يجب تسجيله في خدمة التسجيل المالي.
- **GetSupportedRegistrableEventsDocumentProviderRequest** – يعيد هذا الطلب قائمة الأحداث للاشتراك فيها. حاليًا، يتم دعم الأحداث التالية: المبيعات وإيداعات حساب العملاء وإيداعات أوامر العملاء.
- **GetFiscalRegisterResponseToSaveDocumentProviderRequest** – يقوم هذا الطلب بإرجاع الاستجابة من خدمة التسجيل المالي. يتم اجراء تسلسل لهذه الاستجابة لتكوين سلسله بحيث تكون جاهزه ليتم حفظها.

#### <a name="configuration"></a>تكوين

يوجد ملف التكوين لموفر المستند المالي في **src\\FiscalIntegration\\Efr\\Configurations\\DocumentProviders\\DocumentProviderFiscalEFRSampleCzech.xml** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من هذا الملف هو تمكين إعدادات موفر المستندات المالية المراد تكوينها من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

### <a name="hardware-station-extension-design"></a>تصميم ملحقات محطة الأجهزة

الغرض من الامتداد الذي يعتبر رابطًا ماليًا هو الاتصال بخدمة التسجيل المالي. يستخدم ملحق محطة الأجهزة بروتوكول HTTP لإرسال المستندات التي ينشئها ملحق CRT لخدمة التسجيل المالي. كما أنه يتعامل مع الاستجابات التي يتم تلقيها من خدمة التسجيل المالي.

#### <a name="request-handler"></a>معالج الطلب

معالج طلب **EFRHandler** هو نقطة الإدخال لمعالجة الطلبات إلى خدمة التسجيل المالي.

المعالج موروث من واجهة **INamedRequestHandler**. طريقة **HandlerName** مسؤولة عن إرجاع اسم المعالج. يجب أن يتطابق اسم المعالج مع اسم الموصل المالي المحدد في مقر Commerce الرئيسي.

يدعم الموصل الطلبات التالية.

- **SubmitDocumentFiscalDeviceRequest** – يرسل هذا الطلب المستندات إلى خدمة التسجيل المالي ويعيد ردًا منها.
- **IsReadyFiscalDeviceRequest** – يُستخدم هذا الطلب لإجراء فحص سلامة لخدمة التسجيل المالي.
- **InitializeFiscalDeviceRequest** – يستخدم هذا الطلب لتهيئة خدمة التسجيل المالي.

#### <a name="configuration"></a>تكوين

يوجد ملف التكوين للموصل المالي في **src\\FiscalIntegration\\Efr\\Configurations\\Connectors\\ConnectorEFRSample.xml** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من الملف هو تمكين إعدادات الموصل المالي ليتم تكوينه من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي.

### <a name="pos-fiscal-connector-extension-design"></a>تصميم ملحق موصل POS المالي

الغرض من امتداد الرابط المالي لنقاط البيع هو التواصل مع خدمة التسجيل المالي من نقطة البيع. يستخدم بروتوكول HTTPS للاتصال.

#### <a name="fiscal-connector-factory"></a>مصنع الموصل المالي

يقوم مصنع الموصل المالي بتعيين اسم الموصل إلى تطبيق الموصل المالي ويوجد في ملف **Pos.Extension\\Connectors\\FiscalConnectorFactory.ts**. يجب أن يتطابق اسم الموصل مع اسم الموصل المالي المحدد في مقر Commerce الرئيسي.

#### <a name="efr-fiscal-connector"></a>الموصل المالي لـ EFR

يوجد الموصل المالي EFR في ملف **Pos.Extension\\Connectors\\Efr\\EfrFiscalConnector.ts**. يقوم بتنفيذ واجهة **IFiscalConnector** التي تدعم الطلبات التالية:

- **FiscalRegisterSubmitDocumentClientRequest** – يرسل هذا الطلب المستندات إلى خدمة التسجيل المالي ويعيد ردًا منها.
- **FiscalRegisterIsReadyClientRequest** – يُستخدم هذا الطلب لإجراء فحص سلامة لخدمة التسجيل المالي.
- **FiscalRegisterInitializeClientRequest** – يستخدم هذا الطلب لتهيئة خدمة التسجيل المالي.

#### <a name="configuration"></a>تكوين

ملف التكوين موجود في مجلد **src\\FiscalIntegration\\Efr\\التكوينات\\الموصلات** في مستودع [حلول Dynamics 365 Commerce](https://github.com/microsoft/Dynamics365Commerce.Solutions/). الغرض من الملف هو تمكين إعدادات الرابط المالي ليتم تكوينه من مقر Commerce الرئيسي. يتوافق تنسيق الملف مع متطلبات تكوين التكامل المالي. تمت إضافة الإعدادات التالية:

- **عنوان نقطة النهاية** – عنوان URL الخاص بخدمه التسجيل المالية.
- **المهلة** – مقدار الوقت بالمللي ثانية الذي سينتظره الموصل للحصول على استجابة من خدمة التسجيل المالي.

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
