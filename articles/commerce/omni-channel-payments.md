---
title: نظرة عامة على دفعات القناة متعددة الاتجاهات.
description: يوفر هذا الموضوع نظرة عامة على دفعات القناة متعددة الاتجاهات في Dynamics 365 Commerce.
author: rubendel
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.custom:
- "141393"
- intro-internal
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 8.1.3
ms.openlocfilehash: 11198795ebc09acd740546e0b18260e8ea2ddfc1dcc2ff38feafecc220655f1f
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/05/2021
ms.locfileid: "6743397"
---
# <a name="omni-channel-payments-overview"></a>نظرة عامة على دفعات القناة متعددة الاتجاهات.

[!include [banner](../includes/banner.md)]

يوفر هذا الموضوع نظرة عامة على دفعات القناة متعددة الاتجاهات في Dynamics 365 Commerce. يتضمن قائمة شاملة من السيناريوهات المدعومة ، ومعلومات حول الوظيفة ، والإعداد ، واستكشاف الأخطاء وإصلاحها ، ووصف لبعض المشاكل المعتادة.

## <a name="key-terms"></a>المصطلحات الأساسية

| الفصل الدراسي | الوصف |
|---|---|
| الرمز المميز | سلسلة من البيانات التي يوفرها معالج الدفع كمرجع. يمكن أن تمثل الرموز أرقام بطاقات الدفع وتفويضات الدفع والتقاطات الدفع السابقة. الرموز المميزة مهمة لأنها تساعد في الحفاظ على البيانات الحساسة خارج نظام نقطة البيع (POS). ويُشار اليها أحيانًا *كمراجع*. |
| رمز البطاقة | الرمز المميز الذي يوفره معالج الدفع للتخزين في نظام نقطة البيع. لا يمكن استخدام الرمز المميز للبطاقات إلا بواسطة التاجر الذي يستلمه. ويُشار إلى رموز البطاقات أحيانًا *كمراجع بطاقات*. |
| رمز التخويل | معرف فريد توفره عملية الدفع كجزء من الاستجابة التي ترسلها إلى نظام نقطة البيع بعد أن يقوم نظام نقطة البيع بتقديم طلب تخويل. يمكن استخدام رمز التخويل في وقت لاحق إذا تم استدعاء المعالج لأداء إجراءات مثل عكس التخويل أو إلغاؤه. ومع ذلك ، يتم استخدامه غالبًا لالتقاط الأموال عند تنفيذ الطلب أو الانتهاء من الحركة. ويُشار إلى رموز التخويل أحيانًا *كمراجع تخويل*. |
| رمز الالتقاط | مرجع يوفره معالج الدفع لنظام نقاط البيع عند الانتهاء من عملية الدفع أو التقاطها. يمكن عندئذٍ استخدام رمز الالتقاط للإشارة إلى التقاط الدفع في العمليات اللاحقة ، مثل طلبات استرداد الأموال. | 
| البطاقة غير موجودة | مصطلح يشير إلى معاملات الدفع التي لا يتم فيها تقديم بطاقة فعلية. على سبيل المثال ، يمكن أن تحدث هذه المعاملات في سيناريوهات التجارة الإلكترونية أو مركز الاتصال. بالنسبة لهذه المعاملات ، يتم إدخال المعلومات المتعلقة بالدفع يدويًا على موقع التجارة الإلكترونية ، أو في تدفق مركز الاتصال ، أو على نقطة البيع أو محطة الدفع. |
| البطاقة موجودة | مصطلح يشير إلى معاملات الدفع حيث يتم تقديم بطاقة فعلية واستخدامها في وحدة طرفية للدفع متصلة بنظام نقطة بيع Microsoft Dynamics 365. |

## <a name="overview"></a>نظرة عامة

بشكل عام، تصف *دفعات القناة متعددة الاتجاهات* القدرة على إنشاء أمر في قناة واحدة وتنفيذها في قناة أخرى. إن مفتاح دعم الدفع عبر قناة متعددة الاتجاهات هو الحفاظ على تفاصيل الدفع مع بقية تفاصيل الطلب ، ثم استخدام تفاصيل الدفع هذه عند استدعاء الطلب أو معالجته في قناة أخرى. مثال كلاسيكي هو سيناريو "الشراء عبر الإنترنت، الاستلام في المتجر". في هذا السيناريو ، تتم إضافة تفاصيل الدفع عند إنشاء الطلب عبر الإنترنت. ويتم استدعاؤها لاحقًا في نقطة البيع لشحن بطاقة الدفع الخاصة بالعميل في وقت الاستلام. 

يمكن تنفيذ جميع السيناريوهات الموضحة في هذا الموضوع باستخدام مجموعة تطوير برامج المدفوعات (SDK) القياسية التي يتم توفيرها مع Commerce. يوفر [موصل دفع Dynamics 365 لـ Adyen‬](/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) تطبيقًا مبتكرًا لكل سيناريو موصوف هنا. 

### <a name="prerequisites"></a>المتطلبات الأساسية

يتطلب كل سيناريو موصوف في هذا الموضوع موصل دفع يدعم دفعات القناة متعددة الاتجاهات. يمكن أيضًا استخدام موصل Adyen مبتكر لأنه يدعم السيناريوهات التي يتم توفيرها من خلال دفعات SDK. لمزيد من المعلومات حول كيفية تنفيذ موصلات الدفع، وحول Retail SDK بشكل عام، يُرجى زيارة[الصفحة الرئيسية للبيع بالتجزئة لمحترفي تكنولوجيا المعلومات والمطورين](/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).

#### <a name="supported-versions"></a>الإصدارات المدعومة

تم إصدار إمكانات الدفع للقناة متعددة الاتجاهات الموضحة في هذا الموضوع كجزء من إصدار Microsoft Dynamics 365 for Retail رقم 8.1.3. 

#### <a name="card-present-and-card-not-present-connectors"></a>موصلات "البطاقة وجودة" و"البطاقة غير موجودة"

تعتمد مجموعة تطوير برامج الدفعات على مجموعتين من واجهات برمجة التطبيقات (APIs) للدفعات. تُعرف المجموعة الأولى من واجهات برمجة التطبيقات باسم **iPaymentProcessor**. يتم استخدامها لتنفيذ موصلات الدفع "البطاقة غير موجودة" التي يمكن استخدامها في مراكز الاتصال ومع النظام الأساسي للتجارة الإلكترونية في Microsoft Dynamics. لمزيد من المعلومات حول واجهة **iPaymentProcessor**، راجع المستند التقني [تطبيق موصل الدفع وجهاز الدفع](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf)، الذي يغطي الدفعات. 

تُعرف المجموعة الثانية من واجهات برمجة التطبيقات باسم **iNamedRequestHandler**. وهو يدعم تنفيذ عمليات تكامل الدفع "البطاقة موجودة" التي تستخدم وحدة طرفية للدفع. لمزيد من المعلومات حول واجهة **iNamedRequestHandler**، راجع [إنشاء تكامل الدفع للوحدة الطرفية للدفع‬](/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension). 

### <a name="setup-and-configuration"></a>الإعداد والتكوين

المكونات التالية وخطوات الإعداد مطلوبة:

- **تكامل التجارة الإلكترونية:** التكامل مع Commerce مطلوب لدعم السيناريوهات التي ينشأ فيها الطلب في واجهة متجر على الإنترنت. لمزيد من المعلومات حول مجموعة تطوير برامج التجارة الإلكترونية للبيع بالتجزئة، راجع [مجموعة تطوير برامج الأنظمة الأساسية للتجارة (SDK)](/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk). في بيئة العرض التوضيحي ، تدعم واجهة المتجر المرجعية سيناريوهات دفع القناة متعددة الاتجاهات. 
- **تكوين الدفعات على الإنترنت:** يجب أن يتضمن إعداد القناة عبر الإنترنت موصل دفع تم تحديثه لدعم دفعات القناة متعددة الاتجاهات. بدلاً من ذلك ، يمكن استخدام موصل الدفع المبتكر. للحصول على معلومات حول كيفية تكوين موصل دفع Adyen للمتاجر عبر الإنترنت، راجع [موصل دفع Adyen](/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce). بالإضافة إلى خطوات إعداد التجارة الإلكترونية الموضحة في هذا الموضوع، يجب تعيين معلمة **السماح بحفظ معلومات الدفع في التجارة الإلكترونية** إلى **True** في إعدادات موصل Adyen. 
- **تكوين دفعات القناة متعددة الاتجاهات:** في مكتب الدعم، انتقل إلى **Retail and Commerce \> إعداد المقرات الرئيسية \> المعلمات \> المعلمات المشتركة للبيع بالتجزئة**. ثم في علامة التبويب **دفعات القناة متعدد الاتجاهات**، قم بتعيين خيار **استخدام دفعات القناة متعددة الاتجاهات** إلى **نعم**. في الإصدار 10.0.12 من Commerce والإصدارات اللاحقة، يوجد هذا الإعداد في مساحة عمل **إدارة الميزات**. حدد **ميزة دفعات القناة متعددة الاتجاهات** وانقر فوق **تمكين الآن**. 
- **خدمات الدفع:** يستخدم مركز الاتصال موصل الدفع الافتراضي في صفحة **خدمات الدفع** لمعالجة الدفعات. لدعم سيناريوهات مثل "شراء في مركز الاتصال، وانتقاء في المتجر"، يجب أن يكون موصل الدفع الافتراضي هذا هو موصل دفع Adyen أو موصل الدفع الذي يفي بمتطلبات التنفيذ لدفعات القناة متعددة الاتجاهات.
- **خدمة EFT:** يجب إعداد الدفعات من خلال وحدة الدفع الطرفية في علامة التبويب السريع **خدمة EFT** في ملف تعريف الأجهزة. يدعم موصل Adyen سيناريوهات دفعات القناة متعددة الاتجاهات المبتكرة. يمكن أيضًا استخدام موصلات الدفع الأخرى التي تدعم **iNamedRequestHandler** إذا كانت تدعم دفعات القناة متعددة الاتجاهات.
- **توفر موصل الدفع** : عندما يتم استدعاء أمر ما ، تتضمن خطوط مناقصة الدفع التي يتم استدعاؤها مع الأمر اسم موصل الدفع الذي تم استخدامه لإنشاء التراخيص المرتبطة بهذا الأمر. عند استيفاء الأمر، تحاول مجموعة تطوير برامج الدفعات استخدام نفس الموصل الذي تم استخدامه لإنشاء التخويل الأصلي. لذلك ، يجب أن يكون موصل الدفع الذي له نفس خصائص التاجر متاحًا لالتقاط الصور. 
- **أنواع البطاقات:** لكي تعمل سيناريوهات القناة متعددة القنوات بشكل صحيح ، يجب أن يكون لدى كل قناة نفس الإعداد لأنواع المناقصات التي يمكن استخدامها للقناة متعددة الاتجاهات. يتضمن هذا الإعداد معرفات طريقة الدفع ومعرفات نوع البطاقة. على سبيل المثال، إذا كان نوع المناقصة **البطاقات** يشتمل على معرف **2** في إعداد المتجر عبر الإنترنت ، فيجب أن يكون له نفس المعرف في إعدادات متجر البيع بالتجزئة. ينطبق نفس الشرط على معرفات نوع البطاقة. إذا تم تعيين رقم البطاقة **12** إلى **تأشيرة** في المتجر على الإنترنت، فيجب إعداد نفس المعرف لمتجر البيع بالتجزئة. 
- The Retail Modern POS لـ Windows أو Android مع محطة أجهزة مضمنة -أو-
- Modern POS for iOS أو Cloud POS مع محطة أجهزة مشتركة متصلة. 

### <a name="basic-principle-supporting-omni-channel-payments"></a>المبدأ الأساسي لدعم دفعات القناة متعددة الاتجاهات

تستخدم موصلات الدفع ومعالجات الدفع الرموز المميزة أو المراجع للإشارة إلى التفاعلات المتعلقة بمدفوعات البطاقات. على سبيل المثال ، عند طلب تفويض بالدفع ، يتم توفير إشارة إلى ذلك التفويض. لذلك ، يمكن الرجوع إلى التفويض لاحقًا ، عندما يتم جمع الأموال في وقت التنفيذ. هذا التفويض فريد من نوعه للتاجر وموصل الدفع والمعالج. 

إذا تم استلام الطلب الذي تم إنشاؤه عبر الإنترنت في المتجر ، فيجب تذكر نفس تفاصيل الدفع لهذا الطلب واستخدامها. عندما يتم تقديم التفاصيل الأصلية كجزء من طلب الحصول على دفعة مقابل التخويل الأصلي ، سيتمكن معالج الدفع من معالجة الطلب والتقاط الدفعة. 

للإشارة بشكل صحيح إلى الطلب عبر الإنترنت ، يجب أن يتوفر أيضًا موصل دفع "بطاقة غير موجودة" يدعم نفس المعالج. وبهذه الطريقة ، يمكن أن يحتوي نظام نقطة البيع على معالج واحد لدفعات "البطاقة موجودة"، ولكن يمكن أيضًا الوصول إلى روابط الدفع الأخرى حتى يتمكن من الوفاء بالطلبات التي يتم إنشاؤها في قنوات أخرى باستخدام معالجات دفع مختلفة. 

## <a name="supported-scenarios"></a>السيناريوهات المدعومة

يتم دعم سيناريوهات دفعات القناة متعددة الاتجاهات التالية:

- شراء على الإنترنت، انتقاء في المتجر
- شراء في مركز الاتصال، انتقاء في متجر
- شراء في المتجر A، انتقاء في المتجر B
- شراء في المتجر A، شحن إلى العميل

    > [!NOTE]
    > يجب وضع علامة على الدُفعات التي يتم تسديدها في مركز الاتصال والمعيّنة إلى وظيفة الدفع "العادية" على أنها **دفعة مقدمة** = **نعم** كي تظهر في المبلغ المستحق عند استدعاء الأمر في نقطة البيع. لا يتم التعرف على الدُفعات غير الدفع المقدم من النوع "عادي" عند استدعاء الأمر في نقطة البيع. 

كما يتم دعم الأشكال المختلفة لهذه السيناريوهات. على سبيل المثال ، قد يتضمن الطلب عبر الإنترنت كلا الخطين اللذين سيتم شحنهما إلى العميل والخطوط التي سيتم التقاطها في أحد المتاجر. يتم اعتماد كافة خيارات تنفيذ الأمر من خلال دفعات القناة متعددة الاتجاهات. 

تصف الأقسام التالية الخطوات الخاصة بكل سيناريو وتظهر كيفية تشغيل السيناريو باستخدام بيانات العرض التوضيحي. 

### <a name="buy-online-pick-up-in-store"></a>شراء على الإنترنت، انتقاء في المتجر

قبل البدء ، تأكد من توفر المتطلبات التالية:

- لديك واجهة مرجع حيث تم تكوين موصل Adyen.
- تم تعيين خيار **دفعات القناة متعددة الاتجاهات** في صفحة **معلمات Commerce المشتركة** إلى **True**. في الإصدارات اللاحقة، تم نقل هذا الإعداد إلى مساحة عمل **إدارة الميزات** حيث يمكنك تحديد ميزة **دفعات القناة متعددة الاتجاهات** والنقر فوق **تمكين الآن**. 
- تم تكوين موصل دفع Adyen لسجل نقطة بيع هوستون.
- The Retail Modern POS لـ Windows أو Android مع محطة أجهزة مضمنة -أو-
- Modern POS for iOS أو Cloud POS مع محطة أجهزة مشتركة متصلة. 

اتبع هذه الخطوات لتشغيل السيناريو.

1. في واجهة المتجر المرجعية ، أنشئ طلبًا للاستلام داخل المتجر. تأكد من تحديد متجر **هوستون**. 
2. انتقل إلى خطوات الخروج، وادفع باستخدام رقم بطاقة ائتمان اختبار. يمكنك العثور على أرقام بطاقات الائتمان الخاصة بالاختبارات في صفحة [أرقام بطاقات اختبارات Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)>
3. في Commerce، استخدم الوظيفة الدفعية **مزامنة الأوامر** وجدول توزيع **P-001** لإنشاء الأوامر في مكتب الدعم.
4. في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر. 
5. حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.

    تم استرداد الطلب من مكتب الدعم. 

6. عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.
7. حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.

    يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر). 

8. حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت. 
9. حدد أي طريقة دفع لإكمال المعاملة. 

### <a name="buy-in-call-center-pick-up-in-store"></a>شراء في مركز الاتصال، انتقاء في متجر

1. في Commerce، في صفحة **خدمة العملاء**، أدخل **كارين بيرغ** في ‬شريط البحث، ثم حدد **بحث**. 
3. حدد **كارين بيرغ** في نتائج البحث.
4. بعد تحميل كارين على صفحة **خدمة العملاء**، حدد **أمر المبيعات الجديد**.
5. في صفحة أمر المبيعات الجديد، حدد **الرأس** لعرض رأس الأمر. 
6. في صفحة **رأس الأمر**، قم بتعيين الموقع إلى **مركزي** والمستودع إلى **هوستون**.
7. في علامة التبويب **تسليم**، قم بتعيين حقل **طريقة التسليم** إلى **60** لانتقاء العميل.
8. حدد **بنود**، ثم أضف بندًا واحدًا أو أكثر إلى الأمر. 
9. حدد **إكمال** لإدخال تدفق إكمال الأمر.
10. قم بالتمرير لأسفل إلى قسم الدفعات، وحدد **إضافة**، ثم حدد البند الذي يتم فيه تعيين نوع طريقة الدفع إلى **البطاقات**. 
11. حدد علامة الجمع (**+**) لإضافة دفع بالبطاقة. 
12. أدخل التفاصيل الخاصة برقم بطاقة ائتمان الاختبار الذي وجدته على [صفحة أرقام بطاقات اختبار Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)، ثم حدد **موافق**.

    > [!NOTE]
    > إذا كانت علامة البطاقة الخاصة برقم البطاقة التي أدخلتها تختلف عن العلامة التجارية التي تم تحديدها عند بدء الدفع ، فسيستمر الدفع. ومع ذلك ، سيتم نشرها على الحسابات التي تم تعيينها إلى علامة البطاقة التي حددتها في الخطوة 10.

12. حدد **موافق** مره أخرى لإغلاق مربع حوار **دفعات إكمال الأوامر**.
13. في صفحة **ملخص أمر المبيعات**، حدد **إرسال**.
14. في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر. 
15. حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.

    تم استرداد الطلب من مكتب الدعم. 

16. عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.
17. حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.

    يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر).

18. حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت. 
19. حدد أي طريقة دفع لإكمال المعاملة. 

### <a name="buy-in-store-a-pick-up-in-store-b"></a>شراء في المتجر A، انتقاء في المتجر B

1. ابدأ تشغيل نقطة البيع لمتجر هوستون.
2. في صفحة **الحركة**، أضف كارين بيرغ إلى الحركة باستخدام لوحه الأرقام لإدخال **2001**.
3. أضف بند واحد أو أكثر إلى الحركة.
4. حدد **الأوامر** لعرض خيارات الأوامر.
5. حدد **انتقاء الكل**، ثم عند المطالبة، حدد **أمر العميل**.
6. في شريط البحث، أدخل **سياتل**، ثم حدد متجر **سياتل** للانتقاء. 
7. حدد **موافق** لقبول التاريخ الحالي كتاريخ انتقاء.
9. حدد **بطاقة الدفع** لبدء الدفع.
10. اعرض دفع البطاقة للمبلغ المستحق للإيداع. 
11. أكمل دفع الوديعة في الوحدة الطرفية للدفع. 
12. بعد دفع الإيداع ، حدد خيار استخدام نفس البطاقة للوفاء ، وانتظر حتى يكتمل الأمر. 
13. ابدأ تشغيل نقطة البيع لمتجر ساتيل.
14. في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر. 
15. حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.

    تم استرداد الطلب من مكتب الدعم. 

16. عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.
17. حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.

    يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر).

18. حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت. 
19. حدد أي طريقة دفع لإكمال المعاملة. 

### <a name="buy-in-store-a-ship-to-customer"></a>شراء في المتجر A، شحن إلى العميل

1. ابدأ تشغيل نقطة البيع لمتجر هوستون.
2. في صفحة **الحركة**، أضف كارين بيرغ إلى الحركة باستخدام لوحه الأرقام لإدخال **2001**.
3. أضف بند واحد أو أكثر إلى الحركة.
4. حدد **الأوامر** لعرض خيارات الأوامر.
5. حدد **شحن الكل**، ثم عند المطالبة، حدد **أمر العميل**.
6. في صفحة أسلوب الشحن، حدد **ليلي قياسي**، ثم حدد **موافق** لقبول تاريخ اليوم كتاريخ الشحن. 
7. حدد **موافق** لقبول التاريخ الحالي كتاريخ انتقاء.
8. حدد **بطاقة الدفع** لبدء الدفع.
9. اعرض دفع البطاقة للمبلغ المستحق للإيداع. 
10. أكمل دفع الوديعة في الوحدة الطرفية للدفع. 
11. بعد دفع الإيداع ، حدد خيار استخدام نفس البطاقة للوفاء ، وانتظر حتى يكتمل الأمر.

عند اختيار الطلب وتعبئته وفوترته في مكتب الدعم، سيتم استخدام تفاصيل الدفع التي يتم توفيرها في نقاط البيع لالتقاط الأموال للبضائع التي يتم شحنها إلى العميل. 

## <a name="scenario-details"></a>تفاصيل السيناريو

بالإضافة إلى السيناريوهات الأساسية التي تم وصفها للتو، تم إجراء العديد من التحسينات على مجموعة تطوير برامج الدفع لدعم دفعات القناة متعددة الاتجاهات. 

### <a name="pos"></a>نقطة البيع

#### <a name="single-swipedip-for-customer-orders"></a>مسح/تمرير واحد لأوامر العملاء

قبل تنفيذ ميزة دفعات القناة متعددة الاتجاهات، عندما تم إنشاء أوامر العملاء التي تضمنت الودائع في نقاط البيع، كان يتعين على العملاء مسح (أو تمرير) بطاقتهم مرتين: مرة واحدة لدفع الإيداع ومرة واحدة لتذكير البطاقة لاستيفاء أمر لاحق. عند تشغيل ميزة الرمز المميز للقناة متعددة الاتجاهات، يتعين على العملاء تمرير بطاقتهم مرة واحدة فقط لدفع الإيداع وتفويض المبلغ المستحق للسلع التي سيتم الوفاء بها لاحقًا. في وقت الوفاء ، يتم الحصول على الأموال المصرح بها. قبل تنفيذ ميزة رمز القناة متعددة الاتجاهات، تم إنشاء رمز مميز للبطاقة المتكررة للوفاء بالطلبات اللاحقة. لذلك ، لم يتم التصريح بأموال الوفاء المعلقة، ولأن هذه الأموال لم تكن محتجزة لهذا الشراء المحدد ، فقد كان من المحتمل أن يتم الاستيلاء عليها لاحقًا.

> [!NOTE]
> التمرير المفرد غير مدعوم في إصدار Retail رقم 8.1.3. تستخدم أوامر العملاء في الإصدار 8.1.3 نفس التدفق الذي تم استخدامه قبل تطبيق ميزة ترميز رموز القناة متعددة الاتجاهات. 

### <a name="cards-that-cant-issue-recurring-card-tokens"></a>البطاقات التي لا يمكنها إصدار رموز بطاقات متكررة

لا يمكن استخدام بعض البطاقات لدفعات القناة متعددة الاتجاهات، لأنها لا تدعم إصدار الرموز المميزة للبطاقات المتكررة. عند إنشاء أمر في نقطة البيع، إذا تم دفع الإيداع باستخدام بطاقة لا تدعم الرموز المميزة للبطاقة المتكررة، فسيتم استخدام تدفق الرمز المميز للبطاقة السابق. لذلك ، يجب على العميل الذي يرغب في تقديم دفعة يتم استخدامها لتنفيذ الأمر اللاحق تقديم بطاقة ثانية. إذا كانت البطاقة الثانية لا تدعم الرموز المميزة للبطاقات المتكررة ، فسيتم رفض إجراء الرمز المميز ، وسيُطلب من الكاشير مطالبة العميل بتقديم بطاقة مختلفة. 

### <a name="using-a-different-card"></a>استخدام بطاقة مختلفة

لدى العميل الذي يأتي إلى المتجر لاستلام الطلبات خيار استخدام بطاقة مختلفة. عندما يستلم الكاشير مطالبة **استخدام طريقة الدفع المتاحة** في وقت استلام الطلب ، يمكن أن يسأل الكاشيير عما إذا كان العميل يريد استخدام نفس البطاقة أم لا. إذا فقد العميل البطاقة التي تم استخدامها لإنشاء الأمر ويريد دفع ثمن الأمر باستخدام بطاقة مختلفة، يستطيع الكاشير تحديد **استخدام بطاقة دفع مختلفة**. إذا عاد العميل لاحقًا لالتقاط المزيد من العناصر لنفس الأمر، وإذا كان ترخيص البطاقة الأصلي لا يزال صالحًا، يستطيع الكاشير مرة أخرى أن يسأل عما إذا كان العميل يريد استخدام تلك البطاقة.

### <a name="invalid-authorizations"></a>التخويلات غير الصالحة

إذا لم تعد البطاقة التي تم استخدامها لإنشاء أمر صالحة، عند اختيار المنتجات للاستلام، فسيفشل طلب التقاط الدفع. سيحاول موصل الدفع نقطة البيع إنشاء ترخيص جديد والالتقاط باستخدام تفاصيل البطاقة نفسها. في حالة فشل التفويض الجديد أو الالتقاط، سيتم إبلاغ الكاشير بأنه لا يمكن معالجة الدفعة. ويجب على الكاشير الحصول على دفعة جديدة من العميل. 

### <a name="multiple-available-payments"></a>الدفعات المتعددة المتوفرة

عندما يتم استلام أمر يحتوي على العديد من المناقصات والبنود المتعددة، يتلقى الكاشير أولاً مطالبة **استخدام طريقة الدفع المتاحة**. في حالة وجود بطاقات متعددة، عندما يحدد الكاشير **استخدام طريقة الدفع المتاحة**، سيتم التقاط بنود المناقصات الحالية للبطاقة حتى يتم تحقيق الرصيد للبضائع التي يتم التقاطها حاليًا. لن يكون لدى الكاشير خيار تحديد البطاقة التي يجب استخدامها للبضائع التي يتم التقاطها. 

## <a name="related-topics"></a>مواضيع مرتبطة

- [الأسئلة المتداولة حول الدفعات](/dynamics365/unified-operations/retail/dev-itpro/payments-retail)
- [موصل دفع Dynamics 365 لـ Adyen](/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3)
- [تكوين BOPIS في بيئة تقييم Dynamics 365 Commerce](./cpe-bopis.md)



[!INCLUDE[footer-include](../includes/footer-banner.md)]