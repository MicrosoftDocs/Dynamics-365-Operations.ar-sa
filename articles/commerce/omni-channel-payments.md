---
title: نظرة عامة على دفعات القناة متعددة الاتجاهات.
description: يوفر هذا الموضوع نظرة عامة على دفعات القناة متعددة الاتجاهات في Dynamics 365 Commerce.
author: rubendel
manager: AnnBe
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 8.1.3
ms.openlocfilehash: 3fe64dad3c60560363428d76566d910868b87111
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/15/2021
ms.locfileid: "5244901"
---
# <a name="omni-channel-payments-overview"></a><span data-ttu-id="f39a8-103">نظرة عامة على دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-103">Omni-channel payments overview</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="f39a8-104">يوفر هذا الموضوع نظرة عامة على دفعات القناة متعددة الاتجاهات في Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="f39a8-104">This topic provides an overview of omni-channel payments in Dynamics 365 Commerce.</span></span> <span data-ttu-id="f39a8-105">يتضمن قائمة شاملة من السيناريوهات المدعومة ، ومعلومات حول الوظيفة ، والإعداد ، واستكشاف الأخطاء وإصلاحها ، ووصف لبعض المشاكل المعتادة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-105">It includes a comprehensive list of supported scenarios, information about functionality, setup, and troubleshooting, and descriptions of some typical issues.</span></span>

## <a name="key-terms"></a><span data-ttu-id="f39a8-106">المصطلحات الأساسية</span><span class="sxs-lookup"><span data-stu-id="f39a8-106">Key terms</span></span>

| <span data-ttu-id="f39a8-107">الفصل الدراسي</span><span class="sxs-lookup"><span data-stu-id="f39a8-107">Term</span></span> | <span data-ttu-id="f39a8-108">الوصف</span><span class="sxs-lookup"><span data-stu-id="f39a8-108">Description</span></span> |
|---|---|
| <span data-ttu-id="f39a8-109">الرمز المميز</span><span class="sxs-lookup"><span data-stu-id="f39a8-109">Token</span></span> | <span data-ttu-id="f39a8-110">سلسلة من البيانات التي يوفرها معالج الدفع كمرجع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-110">A string of data that a payment processor provides as a reference.</span></span> <span data-ttu-id="f39a8-111">يمكن أن تمثل الرموز أرقام بطاقات الدفع وتفويضات الدفع والتقاطات الدفع السابقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-111">Tokens can represent payment card numbers, payment authorizations, and previous payment captures.</span></span> <span data-ttu-id="f39a8-112">الرموز المميزة مهمة لأنها تساعد في الحفاظ على البيانات الحساسة خارج نظام نقطة البيع (POS).</span><span class="sxs-lookup"><span data-stu-id="f39a8-112">Tokens are important because they help keep sensitive data out of the point of sale (POS) system.</span></span> <span data-ttu-id="f39a8-113">ويُشار اليها أحيانًا *كمراجع*.</span><span class="sxs-lookup"><span data-stu-id="f39a8-113">They are sometimes also referred to as *references*.</span></span> |
| <span data-ttu-id="f39a8-114">رمز البطاقة</span><span class="sxs-lookup"><span data-stu-id="f39a8-114">Card token</span></span> | <span data-ttu-id="f39a8-115">الرمز المميز الذي يوفره معالج الدفع للتخزين في نظام نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-115">A token that a payment processor provides for storage in the POS system.</span></span> <span data-ttu-id="f39a8-116">لا يمكن استخدام الرمز المميز للبطاقات إلا بواسطة التاجر الذي يستلمه.</span><span class="sxs-lookup"><span data-stu-id="f39a8-116">A card token can be used only by the merchant who receives it.</span></span> <span data-ttu-id="f39a8-117">ويُشار إلى رموز البطاقات أحيانًا *كمراجع بطاقات*.</span><span class="sxs-lookup"><span data-stu-id="f39a8-117">Card tokens are sometimes also referred to as *card references*.</span></span> |
| <span data-ttu-id="f39a8-118">رمز التخويل</span><span class="sxs-lookup"><span data-stu-id="f39a8-118">Authorization (auth) token</span></span> | <span data-ttu-id="f39a8-119">معرف فريد توفره عملية الدفع كجزء من الاستجابة التي ترسلها إلى نظام نقطة البيع بعد أن يقوم نظام نقطة البيع بتقديم طلب تخويل.</span><span class="sxs-lookup"><span data-stu-id="f39a8-119">A unique ID that a payment process provides as part of the response that it sends to a POS system after the POS system makes an authorization request.</span></span> <span data-ttu-id="f39a8-120">يمكن استخدام رمز التخويل في وقت لاحق إذا تم استدعاء المعالج لأداء إجراءات مثل عكس التخويل أو إلغاؤه.</span><span class="sxs-lookup"><span data-stu-id="f39a8-120">An authorization token can be used later if the processor is called to perform actions such as reversing or voiding the authorization.</span></span> <span data-ttu-id="f39a8-121">ومع ذلك ، يتم استخدامه غالبًا لالتقاط الأموال عند تنفيذ الطلب أو الانتهاء من الحركة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-121">However, it's most often used to capture funds when an order is fulfilled or a transaction is finalized.</span></span> <span data-ttu-id="f39a8-122">ويُشار إلى رموز التخويل أحيانًا *كمراجع تخويل*.</span><span class="sxs-lookup"><span data-stu-id="f39a8-122">Authorization tokens are sometimes also referred to as *authorization references*.</span></span> |
| <span data-ttu-id="f39a8-123">رمز الالتقاط</span><span class="sxs-lookup"><span data-stu-id="f39a8-123">Capture token</span></span> | <span data-ttu-id="f39a8-124">مرجع يوفره معالج الدفع لنظام نقاط البيع عند الانتهاء من عملية الدفع أو التقاطها.</span><span class="sxs-lookup"><span data-stu-id="f39a8-124">A reference that a payment processor provides to a POS system when a payment is finalized or captured.</span></span> <span data-ttu-id="f39a8-125">يمكن عندئذٍ استخدام رمز الالتقاط للإشارة إلى التقاط الدفع في العمليات اللاحقة ، مثل طلبات استرداد الأموال.</span><span class="sxs-lookup"><span data-stu-id="f39a8-125">The capture token can then be used to reference the payment capture in subsequent operations, such as refund requests.</span></span> | 
| <span data-ttu-id="f39a8-126">البطاقة غير موجودة</span><span class="sxs-lookup"><span data-stu-id="f39a8-126">Card not present</span></span> | <span data-ttu-id="f39a8-127">مصطلح يشير إلى معاملات الدفع التي لا يتم فيها تقديم بطاقة فعلية.</span><span class="sxs-lookup"><span data-stu-id="f39a8-127">A term that refers to payment transactions where a physical card isn't presented.</span></span> <span data-ttu-id="f39a8-128">على سبيل المثال ، يمكن أن تحدث هذه المعاملات في سيناريوهات التجارة الإلكترونية أو مركز الاتصال.</span><span class="sxs-lookup"><span data-stu-id="f39a8-128">For example, these transactions can occur in e-commerce or call center scenarios.</span></span> <span data-ttu-id="f39a8-129">بالنسبة لهذه المعاملات ، يتم إدخال المعلومات المتعلقة بالدفع يدويًا على موقع التجارة الإلكترونية ، أو في تدفق مركز الاتصال ، أو على نقطة البيع أو محطة الدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-129">For these transactions, the payment-related information is manually entered on an e-commerce website, in a call center flow, or on the POS or payment terminal.</span></span> |
| <span data-ttu-id="f39a8-130">البطاقة موجودة</span><span class="sxs-lookup"><span data-stu-id="f39a8-130">Card present</span></span> | <span data-ttu-id="f39a8-131">مصطلح يشير إلى معاملات الدفع حيث يتم تقديم بطاقة فعلية واستخدامها في وحدة طرفية للدفع متصلة بنظام نقطة بيع Microsoft Dynamics 365.</span><span class="sxs-lookup"><span data-stu-id="f39a8-131">A term that refers to payment transactions where a physical card is presented and used on a payment terminal that is connected to the Microsoft Dynamics 365 POS system.</span></span> |

## <a name="overview"></a><span data-ttu-id="f39a8-132">نظرة عامة</span><span class="sxs-lookup"><span data-stu-id="f39a8-132">Overview</span></span>

<span data-ttu-id="f39a8-133">بشكل عام، تصف *دفعات القناة متعددة الاتجاهات* القدرة على إنشاء أمر في قناة واحدة وتنفيذها في قناة أخرى.</span><span class="sxs-lookup"><span data-stu-id="f39a8-133">In general, the term *omni-channel payments* describes the ability to create an order in one channel and fulfill it in another channel.</span></span> <span data-ttu-id="f39a8-134">إن مفتاح دعم الدفع عبر قناة متعددة الاتجاهات هو الحفاظ على تفاصيل الدفع مع بقية تفاصيل الطلب ، ثم استخدام تفاصيل الدفع هذه عند استدعاء الطلب أو معالجته في قناة أخرى.</span><span class="sxs-lookup"><span data-stu-id="f39a8-134">The key to omni-channel payment support is preserving payment details together with the rest of the order details, and then using those payment details when the order is recalled or processed in another channel.</span></span> <span data-ttu-id="f39a8-135">مثال كلاسيكي هو سيناريو "الشراء عبر الإنترنت، الاستلام في المتجر".</span><span class="sxs-lookup"><span data-stu-id="f39a8-135">A classic example is the "Buy online, pick up in store" scenario.</span></span> <span data-ttu-id="f39a8-136">في هذا السيناريو ، تتم إضافة تفاصيل الدفع عند إنشاء الطلب عبر الإنترنت.</span><span class="sxs-lookup"><span data-stu-id="f39a8-136">In this scenario, the payment details are added when the order is created online.</span></span> <span data-ttu-id="f39a8-137">ويتم استدعاؤها لاحقًا في نقطة البيع لشحن بطاقة الدفع الخاصة بالعميل في وقت الاستلام.</span><span class="sxs-lookup"><span data-stu-id="f39a8-137">They are then recalled at the POS to charge the customer's payment card at the time of pickup.</span></span> 

<span data-ttu-id="f39a8-138">يمكن تنفيذ جميع السيناريوهات الموضحة في هذا الموضوع باستخدام مجموعة تطوير برامج المدفوعات (SDK) القياسية التي يتم توفيرها مع Commerce.</span><span class="sxs-lookup"><span data-stu-id="f39a8-138">All the scenarios that are described in this topic can be implemented by using the standard Payments software development kit (SDK) that is provided with Commerce.</span></span> <span data-ttu-id="f39a8-139">يوفر [موصل دفع Dynamics 365 لـ Adyen‬](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) تطبيقًا مبتكرًا لكل سيناريو موصوف هنا.</span><span class="sxs-lookup"><span data-stu-id="f39a8-139">The [Dynamics 365 Payment Connector for Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) provides an out-of-box implementation of every scenario that is described here.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="f39a8-140">المتطلبات الأساسية</span><span class="sxs-lookup"><span data-stu-id="f39a8-140">Prerequisites</span></span>

<span data-ttu-id="f39a8-141">يتطلب كل سيناريو موصوف في هذا الموضوع موصل دفع يدعم دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-141">Every scenario that is described in this topic requires a payment connector that supports omni-channel payments.</span></span> <span data-ttu-id="f39a8-142">يمكن أيضًا استخدام موصل Adyen مبتكر لأنه يدعم السيناريوهات التي يتم توفيرها من خلال دفعات SDK.</span><span class="sxs-lookup"><span data-stu-id="f39a8-142">The out-of-box Adyen connector can also be used, because it supports the scenarios that are made available through the Payments SDK.</span></span> <span data-ttu-id="f39a8-143">لمزيد من المعلومات حول كيفية تنفيذ موصلات الدفع، وحول Retail SDK بشكل عام، يُرجى زيارة[الصفحة الرئيسية للبيع بالتجزئة لمحترفي تكنولوجيا المعلومات والمطورين](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span><span class="sxs-lookup"><span data-stu-id="f39a8-143">For more information about how to implement payment connectors, and about the Retail SDK in general, visit the [Retail for IT pros and developers home page](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span></span>

#### <a name="supported-versions"></a><span data-ttu-id="f39a8-144">الإصدارات المدعومة</span><span class="sxs-lookup"><span data-stu-id="f39a8-144">Supported versions</span></span>

<span data-ttu-id="f39a8-145">تم إصدار إمكانات الدفع للقناة متعددة الاتجاهات الموضحة في هذا الموضوع كجزء من إصدار Microsoft Dynamics 365 for Retail رقم 8.1.3.</span><span class="sxs-lookup"><span data-stu-id="f39a8-145">The omni-channel payment capabilities that are described in this topic were released as part of Microsoft Dynamics 365 for Retail version 8.1.3.</span></span> 

#### <a name="card-present-and-card-not-present-connectors"></a><span data-ttu-id="f39a8-146">موصلات "البطاقة وجودة" و"البطاقة غير موجودة"</span><span class="sxs-lookup"><span data-stu-id="f39a8-146">"Card present" and "card not present" connectors</span></span>

<span data-ttu-id="f39a8-147">تعتمد مجموعة تطوير برامج الدفعات على مجموعتين من واجهات برمجة التطبيقات (APIs) للدفعات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-147">The Payments SDK relies on two sets of application programming interfaces (APIs) for payments.</span></span> <span data-ttu-id="f39a8-148">تُعرف المجموعة الأولى من واجهات برمجة التطبيقات باسم **iPaymentProcessor**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-148">The first set of APIs is named **iPaymentProcessor**.</span></span> <span data-ttu-id="f39a8-149">يتم استخدامها لتنفيذ موصلات الدفع "البطاقة غير موجودة" التي يمكن استخدامها في مراكز الاتصال ومع النظام الأساسي للتجارة الإلكترونية في Microsoft Dynamics.</span><span class="sxs-lookup"><span data-stu-id="f39a8-149">It's used to implement "card not present" payment connectors that can be used in call centers and with the Microsoft Dynamics e-Commerce platform.</span></span> <span data-ttu-id="f39a8-150">لمزيد من المعلومات حول واجهة **iPaymentProcessor**، راجع المستند التقني [تطبيق موصل الدفع وجهاز الدفع](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf)، الذي يغطي الدفعات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-150">For more information about the **iPaymentProcessor** interface, see the [Implement a payment connector and a payment device](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf) white paper, which covers payments.</span></span> 

<span data-ttu-id="f39a8-151">تُعرف المجموعة الثانية من واجهات برمجة التطبيقات باسم **iNamedRequestHandler**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-151">The second set of APIs is named **iNamedRequestHandler**.</span></span> <span data-ttu-id="f39a8-152">وهو يدعم تنفيذ عمليات تكامل الدفع "البطاقة موجودة" التي تستخدم وحدة طرفية للدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-152">It supports the implementation of "card present" payment integrations that use a payment terminal.</span></span> <span data-ttu-id="f39a8-153">لمزيد من المعلومات حول واجهة **iNamedRequestHandler**، راجع [إنشاء تكامل الدفع للوحدة الطرفية للدفع‬](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span><span class="sxs-lookup"><span data-stu-id="f39a8-153">For more information about the **iNamedRequestHandler** interface, see [Create a payment integration for a payment terminal](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span></span> 

### <a name="setup-and-configuration"></a><span data-ttu-id="f39a8-154">الإعداد والتكوين</span><span class="sxs-lookup"><span data-stu-id="f39a8-154">Setup and configuration</span></span>

<span data-ttu-id="f39a8-155">المكونات التالية وخطوات الإعداد مطلوبة:</span><span class="sxs-lookup"><span data-stu-id="f39a8-155">The following components and setup steps are required:</span></span>

- <span data-ttu-id="f39a8-156">**تكامل التجارة الإلكترونية:** التكامل مع Commerce مطلوب لدعم السيناريوهات التي ينشأ فيها الطلب في واجهة متجر على الإنترنت.</span><span class="sxs-lookup"><span data-stu-id="f39a8-156">**eCommerce integration:** An integration with Commerce is required to support scenarios where an order originates in an online storefront.</span></span> <span data-ttu-id="f39a8-157">لمزيد من المعلومات حول مجموعة تطوير برامج التجارة الإلكترونية للبيع بالتجزئة، راجع [مجموعة تطوير برامج الأنظمة الأساسية للتجارة (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span><span class="sxs-lookup"><span data-stu-id="f39a8-157">For more information about the Retail e-Commerce SDK, see [e-Commerce platform software development kit (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span></span> <span data-ttu-id="f39a8-158">في بيئة العرض التوضيحي ، تدعم واجهة المتجر المرجعية سيناريوهات دفع القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-158">In a demo environment, the reference storefront supports omni-channel payment scenarios.</span></span> 
- <span data-ttu-id="f39a8-159">**تكوين الدفعات على الإنترنت:** يجب أن يتضمن إعداد القناة عبر الإنترنت موصل دفع تم تحديثه لدعم دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-159">**Online payments configuration:** The setup of the online channel must include a payment connector that has been updated to support omni-channel payments.</span></span> <span data-ttu-id="f39a8-160">بدلاً من ذلك ، يمكن استخدام موصل الدفع المبتكر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-160">Alternatively, the out-of-box payment connector can be used.</span></span> <span data-ttu-id="f39a8-161">للحصول على معلومات حول كيفية تكوين موصل دفع Adyen للمتاجر عبر الإنترنت، راجع [موصل دفع Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span><span class="sxs-lookup"><span data-stu-id="f39a8-161">For information about how to configure the Adyen payment connector for online stores, see [Adyen payment connector](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span></span> <span data-ttu-id="f39a8-162">بالإضافة إلى خطوات إعداد التجارة الإلكترونية الموضحة في هذا الموضوع، يجب تعيين معلمة **السماح بحفظ معلومات الدفع في التجارة الإلكترونية** إلى **True** في إعدادات موصل Adyen.</span><span class="sxs-lookup"><span data-stu-id="f39a8-162">In addition to the eCommerce setup steps that are described in that topic, the **Allow saving payment information in e-commerce** parameter must be set to **True** in the settings for the Adyen connector.</span></span> 
- <span data-ttu-id="f39a8-163">**تكوين دفعات القناة متعددة الاتجاهات:** في مكتب الدعم، انتقل إلى **Retail and Commerce \> إعداد المقرات الرئيسية \> المعلمات \> المعلمات المشتركة للبيع بالتجزئة**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-163">**Omni-channel payments configuration:** In the back office, go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**.</span></span> <span data-ttu-id="f39a8-164">ثم في علامة التبويب **دفعات القناة متعدد الاتجاهات**، قم بتعيين خيار **استخدام دفعات القناة متعددة الاتجاهات** إلى **نعم**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-164">Then, on the **Omni-channel payments** tab, set the **Use omni-channel payments** option to **Yes**.</span></span> <span data-ttu-id="f39a8-165">في الإصدار 10.0.12 من Commerce والإصدارات اللاحقة، يوجد هذا الإعداد في مساحة عمل **إدارة الميزات**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-165">In Commerce versions 10.0.12 and later, this setting is in the **Feature Management** workspace.</span></span> <span data-ttu-id="f39a8-166">حدد **ميزة دفعات القناة متعددة الاتجاهات** وانقر فوق **تمكين الآن**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-166">Select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="f39a8-167">**خدمات الدفع:** يستخدم مركز الاتصال موصل الدفع الافتراضي في صفحة **خدمات الدفع** لمعالجة الدفعات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-167">**Payment services:** The call center uses the default payment connector on the **Payment services** page to process payments.</span></span> <span data-ttu-id="f39a8-168">لدعم سيناريوهات مثل "شراء في مركز الاتصال، وانتقاء في المتجر"، يجب أن يكون موصل الدفع الافتراضي هذا هو موصل دفع Adyen أو موصل الدفع الذي يفي بمتطلبات التنفيذ لدفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-168">To support scenarios such as "Buy in call center, pick up in store," this default payment connector must be the Adyen payment connector or a payment connector that meets the implementation requirements for omni-channel payments.</span></span>
- <span data-ttu-id="f39a8-169">**خدمة EFT:** يجب إعداد الدفعات من خلال وحدة الدفع الطرفية في علامة التبويب السريع **خدمة EFT** في ملف تعريف الأجهزة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-169">**EFT service:** Payments through a payment terminal must be set up on the **EFT service** FastTab of the hardware profile.</span></span> <span data-ttu-id="f39a8-170">يدعم موصل Adyen سيناريوهات دفعات القناة متعددة الاتجاهات المبتكرة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-170">The Adyen connector supports omni-channel payments scenarios out of the box.</span></span> <span data-ttu-id="f39a8-171">يمكن أيضًا استخدام موصلات الدفع الأخرى التي تدعم **iNamedRequestHandler** إذا كانت تدعم دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-171">Other payment connectors that support the **iNamedRequestHandler** interface can also be used if they support omni-channel payments.</span></span>
- <span data-ttu-id="f39a8-172">**توفر موصل الدفع** : عندما يتم استدعاء أمر ما ، تتضمن خطوط مناقصة الدفع التي يتم استدعاؤها مع الأمر اسم موصل الدفع الذي تم استخدامه لإنشاء التراخيص المرتبطة بهذا الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-172">**Payment connector availability:** When an order is recalled, the payment tender lines that are recalled together with the order include the name of the payment connector that was used to create the authorizations that are associated with that order.</span></span> <span data-ttu-id="f39a8-173">عند استيفاء الأمر، تحاول مجموعة تطوير برامج الدفعات استخدام نفس الموصل الذي تم استخدامه لإنشاء التخويل الأصلي.</span><span class="sxs-lookup"><span data-stu-id="f39a8-173">When the order is fulfilled, the Payments SDK tries to use the same connector that was used to create the original authorization.</span></span> <span data-ttu-id="f39a8-174">لذلك ، يجب أن يكون موصل الدفع الذي له نفس خصائص التاجر متاحًا لالتقاط الصور.</span><span class="sxs-lookup"><span data-stu-id="f39a8-174">Therefore, a payment connector that has the same merchant properties must be available for capture.</span></span> 
- <span data-ttu-id="f39a8-175">**أنواع البطاقات:** لكي تعمل سيناريوهات القناة متعددة القنوات بشكل صحيح ، يجب أن يكون لدى كل قناة نفس الإعداد لأنواع المناقصات التي يمكن استخدامها للقناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-175">**Card types:** For omni-channel scenarios to work properly, each channel must have the same setup for tender types that can be used for omni-channel.</span></span> <span data-ttu-id="f39a8-176">يتضمن هذا الإعداد معرفات طريقة الدفع ومعرفات نوع البطاقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-176">This setup includes payment method IDs and card type IDs.</span></span> <span data-ttu-id="f39a8-177">على سبيل المثال، إذا كان نوع المناقصة **البطاقات** يشتمل على معرف **2** في إعداد المتجر عبر الإنترنت ، فيجب أن يكون له نفس المعرف في إعدادات متجر البيع بالتجزئة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-177">For example, if the **Cards** tender type has an ID of **2** in the online store setup, it should have the same ID in the retail store setup.</span></span> <span data-ttu-id="f39a8-178">ينطبق نفس الشرط على معرفات نوع البطاقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-178">The same requirement applies to card type IDs.</span></span> <span data-ttu-id="f39a8-179">إذا تم تعيين رقم البطاقة **12** إلى **تأشيرة** في المتجر على الإنترنت، فيجب إعداد نفس المعرف لمتجر البيع بالتجزئة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-179">If card number **12** is set to **VISA** in the online store, the same ID should be set up for the retail store.</span></span> 
- <span data-ttu-id="f39a8-180">The Retail Modern POS لـ Windows أو Android مع محطة أجهزة مضمنة -أو-</span><span class="sxs-lookup"><span data-stu-id="f39a8-180">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="f39a8-181">Modern POS for iOS أو Cloud POS مع محطة أجهزة مشتركة متصلة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-181">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

### <a name="basic-principle-supporting-omni-channel-payments"></a><span data-ttu-id="f39a8-182">المبدأ الأساسي لدعم دفعات القناة متعددة الاتجاهات</span><span class="sxs-lookup"><span data-stu-id="f39a8-182">Basic principle supporting omni-channel payments</span></span>

<span data-ttu-id="f39a8-183">تستخدم موصلات الدفع ومعالجات الدفع الرموز المميزة أو المراجع للإشارة إلى التفاعلات المتعلقة بمدفوعات البطاقات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-183">Payment connectors and payment processors use tokens, or references, to reference interactions that are related to card payments.</span></span> <span data-ttu-id="f39a8-184">على سبيل المثال ، عند طلب تفويض بالدفع ، يتم توفير إشارة إلى ذلك التفويض.</span><span class="sxs-lookup"><span data-stu-id="f39a8-184">For example, when a payment authorization is requested, a reference to that authorization is provided.</span></span> <span data-ttu-id="f39a8-185">لذلك ، يمكن الرجوع إلى التفويض لاحقًا ، عندما يتم جمع الأموال في وقت التنفيذ.</span><span class="sxs-lookup"><span data-stu-id="f39a8-185">Therefore, the authorization can be referenced later, when funds are captured at the time of fulfillment.</span></span> <span data-ttu-id="f39a8-186">هذا التفويض فريد من نوعه للتاجر وموصل الدفع والمعالج.</span><span class="sxs-lookup"><span data-stu-id="f39a8-186">This authorization is unique to the merchant, payment connector, and processor.</span></span> 

<span data-ttu-id="f39a8-187">إذا تم استلام الطلب الذي تم إنشاؤه عبر الإنترنت في المتجر ، فيجب تذكر نفس تفاصيل الدفع لهذا الطلب واستخدامها.</span><span class="sxs-lookup"><span data-stu-id="f39a8-187">If an order that was created online is being picked up in the store, the same payment details for that order must be recalled and used.</span></span> <span data-ttu-id="f39a8-188">عندما يتم تقديم التفاصيل الأصلية كجزء من طلب الحصول على دفعة مقابل التخويل الأصلي ، سيتمكن معالج الدفع من معالجة الطلب والتقاط الدفعة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-188">When the original details are provided as part of the request to capture a payment against the original authorization, the payment processor will be able to handle the request and capture the payment.</span></span> 

<span data-ttu-id="f39a8-189">للإشارة بشكل صحيح إلى الطلب عبر الإنترنت ، يجب أن يتوفر أيضًا موصل دفع "بطاقة غير موجودة" يدعم نفس المعالج.</span><span class="sxs-lookup"><span data-stu-id="f39a8-189">To correctly reference the online order, a "card not present" payment connector that supports the same processor must also be available.</span></span> <span data-ttu-id="f39a8-190">وبهذه الطريقة ، يمكن أن يحتوي نظام نقطة البيع على معالج واحد لدفعات "البطاقة موجودة"، ولكن يمكن أيضًا الوصول إلى روابط الدفع الأخرى حتى يتمكن من الوفاء بالطلبات التي يتم إنشاؤها في قنوات أخرى باستخدام معالجات دفع مختلفة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-190">In this way, the POS system can have one processor for "card present" payments, but it can also have access to other payment connectors so that it can fulfill orders that are created in other channels by using different payment processors.</span></span> 

## <a name="supported-scenarios"></a><span data-ttu-id="f39a8-191">السيناريوهات المدعومة</span><span class="sxs-lookup"><span data-stu-id="f39a8-191">Supported scenarios</span></span>

<span data-ttu-id="f39a8-192">يتم دعم سيناريوهات دفعات القناة متعددة الاتجاهات التالية:</span><span class="sxs-lookup"><span data-stu-id="f39a8-192">The following omni-channel payment scenarios are supported:</span></span>

- <span data-ttu-id="f39a8-193">شراء على الإنترنت، انتقاء في المتجر</span><span class="sxs-lookup"><span data-stu-id="f39a8-193">Buy online, pick up in store</span></span>
- <span data-ttu-id="f39a8-194">شراء في مركز الاتصال، انتقاء في متجر</span><span class="sxs-lookup"><span data-stu-id="f39a8-194">Buy in call center, pick up in store</span></span>
- <span data-ttu-id="f39a8-195">شراء في المتجر A، انتقاء في المتجر B</span><span class="sxs-lookup"><span data-stu-id="f39a8-195">Buy in store A, pick up in store B</span></span>
- <span data-ttu-id="f39a8-196">شراء في المتجر A، شحن إلى العميل</span><span class="sxs-lookup"><span data-stu-id="f39a8-196">Buy in store A, ship to customer</span></span>

    > [!NOTE]
    > <span data-ttu-id="f39a8-197">يجب وضع علامة على الدُفعات التي يتم تسديدها في مركز الاتصال والمعيّنة إلى وظيفة الدفع "العادية" على أنها **دفعة مقدمة** = **نعم** كي تظهر في المبلغ المستحق عند استدعاء الأمر في نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-197">Payments made in the call center that map to the "Normal" payment function must be marked as **Prepay** = **Yes** to be reflected in the amount due when recalling the order in the POS.</span></span> <span data-ttu-id="f39a8-198">لا يتم التعرف على الدُفعات غير الدفع المقدم من النوع "عادي" عند استدعاء الأمر في نقطة البيع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-198">Non-prepay payments of type "Normal" are not recognized when the order is recalled in POS.</span></span> 

<span data-ttu-id="f39a8-199">كما يتم دعم الأشكال المختلفة لهذه السيناريوهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-199">Variations of these scenarios are also supported.</span></span> <span data-ttu-id="f39a8-200">على سبيل المثال ، قد يتضمن الطلب عبر الإنترنت كلا الخطين اللذين سيتم شحنهما إلى العميل والخطوط التي سيتم التقاطها في أحد المتاجر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-200">For example, an online order might include both lines that will be shipped to the customer and lines that will be picked up in a store.</span></span> <span data-ttu-id="f39a8-201">يتم اعتماد كافة خيارات تنفيذ الأمر من خلال دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-201">All order fulfillment options are supported via omni-channel payments.</span></span> 

<span data-ttu-id="f39a8-202">تصف الأقسام التالية الخطوات الخاصة بكل سيناريو وتظهر كيفية تشغيل السيناريو باستخدام بيانات العرض التوضيحي.</span><span class="sxs-lookup"><span data-stu-id="f39a8-202">The following sections describe the steps for each scenario and show how to run the scenario by using demo data.</span></span> 

### <a name="buy-online-pick-up-in-store"></a><span data-ttu-id="f39a8-203">شراء على الإنترنت، انتقاء في المتجر</span><span class="sxs-lookup"><span data-stu-id="f39a8-203">Buy online, pick up in store</span></span>

<span data-ttu-id="f39a8-204">قبل البدء ، تأكد من توفر المتطلبات التالية:</span><span class="sxs-lookup"><span data-stu-id="f39a8-204">Before you start, make sure that the following prerequisites are in place:</span></span>

- <span data-ttu-id="f39a8-205">لديك واجهة مرجع حيث تم تكوين موصل Adyen.</span><span class="sxs-lookup"><span data-stu-id="f39a8-205">You have a reference storefront where the Adyen connector is configured.</span></span>
- <span data-ttu-id="f39a8-206">تم تعيين خيار **دفعات القناة متعددة الاتجاهات** في صفحة **معلمات Commerce المشتركة** إلى **True**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-206">The **Omni-channel payments** option on the **Commerce shared parameters** page is set to **True**.</span></span> <span data-ttu-id="f39a8-207">في الإصدارات اللاحقة، تم نقل هذا الإعداد إلى مساحة عمل **إدارة الميزات** حيث يمكنك تحديد ميزة **دفعات القناة متعددة الاتجاهات** والنقر فوق **تمكين الآن**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-207">In later versions this settng is moved to the **Feature Management** workspace where you can select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="f39a8-208">تم تكوين موصل دفع Adyen لسجل نقطة بيع هوستون.</span><span class="sxs-lookup"><span data-stu-id="f39a8-208">The Adyen payment connector is configured for the Houston POS register.</span></span>
- <span data-ttu-id="f39a8-209">The Retail Modern POS لـ Windows أو Android مع محطة أجهزة مضمنة -أو-</span><span class="sxs-lookup"><span data-stu-id="f39a8-209">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="f39a8-210">Modern POS for iOS أو Cloud POS مع محطة أجهزة مشتركة متصلة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-210">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

<span data-ttu-id="f39a8-211">اتبع هذه الخطوات لتشغيل السيناريو.</span><span class="sxs-lookup"><span data-stu-id="f39a8-211">Follow these steps to run the scenario.</span></span>

1. <span data-ttu-id="f39a8-212">في واجهة المتجر المرجعية ، أنشئ طلبًا للاستلام داخل المتجر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-212">In the reference storefront, create an order for in-store pickup.</span></span> <span data-ttu-id="f39a8-213">تأكد من تحديد متجر **هوستون**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-213">Be sure to select the **Houston** store.</span></span> 
2. <span data-ttu-id="f39a8-214">انتقل إلى خطوات الخروج، وادفع باستخدام رقم بطاقة ائتمان اختبار.</span><span class="sxs-lookup"><span data-stu-id="f39a8-214">Go through the checkout steps, and pay by using a test credit card number.</span></span> <span data-ttu-id="f39a8-215">يمكنك العثور على أرقام بطاقات الائتمان الخاصة بالاختبارات في صفحة [أرقام بطاقات اختبارات Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)></span><span class="sxs-lookup"><span data-stu-id="f39a8-215">You can find test credit card numbers on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description).</span></span>
3. <span data-ttu-id="f39a8-216">في Commerce، استخدم الوظيفة الدفعية **مزامنة الأوامر** وجدول توزيع **P-001** لإنشاء الأوامر في مكتب الدعم.</span><span class="sxs-lookup"><span data-stu-id="f39a8-216">In Commerce, use the **Synchronize orders** batch job and the **P-001** distribution schedule to create the orders in the back office.</span></span>
4. <span data-ttu-id="f39a8-217">في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-217">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
5. <span data-ttu-id="f39a8-218">حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-218">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="f39a8-219">تم استرداد الطلب من مكتب الدعم.</span><span class="sxs-lookup"><span data-stu-id="f39a8-219">The order is retrieved from the back office.</span></span> 

6. <span data-ttu-id="f39a8-220">عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-220">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
7. <span data-ttu-id="f39a8-221">حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.</span><span class="sxs-lookup"><span data-stu-id="f39a8-221">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="f39a8-222">يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر).</span><span class="sxs-lookup"><span data-stu-id="f39a8-222">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span> 

8. <span data-ttu-id="f39a8-223">حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت.</span><span class="sxs-lookup"><span data-stu-id="f39a8-223">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
9. <span data-ttu-id="f39a8-224">حدد أي طريقة دفع لإكمال المعاملة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-224">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-call-center-pick-up-in-store"></a><span data-ttu-id="f39a8-225">شراء في مركز الاتصال، انتقاء في متجر</span><span class="sxs-lookup"><span data-stu-id="f39a8-225">Buy in call center, pick up in store</span></span>

1. <span data-ttu-id="f39a8-226">في Commerce، في صفحة **خدمة العملاء**، أدخل **كارين بيرغ** في ‬شريط البحث، ثم حدد **بحث**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-226">In Commerce, on the **Customer service** page, enter **Karen Berg** in the search bar, and then select **Search**.</span></span> 
3. <span data-ttu-id="f39a8-227">حدد **كارين بيرغ** في نتائج البحث.</span><span class="sxs-lookup"><span data-stu-id="f39a8-227">Select **Karen Berg** in the search results.</span></span>
4. <span data-ttu-id="f39a8-228">بعد تحميل كارين على صفحة **خدمة العملاء**، حدد **أمر المبيعات الجديد**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-228">After Karen is loaded onto the **Customer service** page, select **New sales order**.</span></span>
5. <span data-ttu-id="f39a8-229">في صفحة أمر المبيعات الجديد، حدد **الرأس** لعرض رأس الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-229">On the new sales order page, select **Header** to view the order header.</span></span> 
6. <span data-ttu-id="f39a8-230">في صفحة **رأس الأمر**، قم بتعيين الموقع إلى **مركزي** والمستودع إلى **هوستون**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-230">On the **Order header** page, set the site to **Central** and the warehouse to **Houston**.</span></span>
7. <span data-ttu-id="f39a8-231">في علامة التبويب **تسليم**، قم بتعيين حقل **طريقة التسليم** إلى **60** لانتقاء العميل.</span><span class="sxs-lookup"><span data-stu-id="f39a8-231">On the **Deliver** tab, set the **Mode of delivery** field to **60** for customer pickup.</span></span>
8. <span data-ttu-id="f39a8-232">حدد **بنود**، ثم أضف بندًا واحدًا أو أكثر إلى الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-232">Select **Lines**, and then add one or more lines to the order.</span></span> 
9. <span data-ttu-id="f39a8-233">حدد **إكمال** لإدخال تدفق إكمال الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-233">Select **Complete** to enter the order completion flow.</span></span>
10. <span data-ttu-id="f39a8-234">قم بالتمرير لأسفل إلى قسم الدفعات، وحدد **إضافة**، ثم حدد البند الذي يتم فيه تعيين نوع طريقة الدفع إلى **البطاقات**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-234">Scroll down to the payments section, select **Add**, and then select a line where the payment method type is set to **Cards**.</span></span> 
11. <span data-ttu-id="f39a8-235">حدد علامة الجمع (**+**) لإضافة دفع بالبطاقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-235">Select the plus sign (**+**) to add a card payment.</span></span> 
12. <span data-ttu-id="f39a8-236">أدخل التفاصيل الخاصة برقم بطاقة ائتمان الاختبار الذي وجدته على [صفحة أرقام بطاقات اختبار Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)، ثم حدد **موافق**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-236">Enter the details for a test credit card number that you found on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description), and then select **OK**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f39a8-237">إذا كانت علامة البطاقة الخاصة برقم البطاقة التي أدخلتها تختلف عن العلامة التجارية التي تم تحديدها عند بدء الدفع ، فسيستمر الدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-237">If the card brand for the card number that you entered differs from the brand that was selected when the payment was initiated, the payment will still go through.</span></span> <span data-ttu-id="f39a8-238">ومع ذلك ، سيتم نشرها على الحسابات التي تم تعيينها إلى علامة البطاقة التي حددتها في الخطوة 10.</span><span class="sxs-lookup"><span data-stu-id="f39a8-238">However, it will be posted to the accounts that are mapped to the card brand that you selected in step 10.</span></span>

12. <span data-ttu-id="f39a8-239">حدد **موافق** مره أخرى لإغلاق مربع حوار **دفعات إكمال الأوامر**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-239">Select **OK** again to close the **Order completion payments** dialog box.</span></span>
13. <span data-ttu-id="f39a8-240">في صفحة **ملخص أمر المبيعات**، حدد **إرسال**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-240">On the **Sales order summary** page, select **Submit**.</span></span>
14. <span data-ttu-id="f39a8-241">في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-241">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="f39a8-242">حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-242">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="f39a8-243">تم استرداد الطلب من مكتب الدعم.</span><span class="sxs-lookup"><span data-stu-id="f39a8-243">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="f39a8-244">عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-244">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="f39a8-245">حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.</span><span class="sxs-lookup"><span data-stu-id="f39a8-245">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="f39a8-246">يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر).</span><span class="sxs-lookup"><span data-stu-id="f39a8-246">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="f39a8-247">حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت.</span><span class="sxs-lookup"><span data-stu-id="f39a8-247">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="f39a8-248">حدد أي طريقة دفع لإكمال المعاملة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-248">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-pick-up-in-store-b"></a><span data-ttu-id="f39a8-249">شراء في المتجر A، انتقاء في المتجر B</span><span class="sxs-lookup"><span data-stu-id="f39a8-249">Buy in store A, pick up in store B</span></span>

1. <span data-ttu-id="f39a8-250">ابدأ تشغيل نقطة البيع لمتجر هوستون.</span><span class="sxs-lookup"><span data-stu-id="f39a8-250">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="f39a8-251">في صفحة **الحركة**، أضف كارين بيرغ إلى الحركة باستخدام لوحه الأرقام لإدخال **2001**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-251">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="f39a8-252">أضف بند واحد أو أكثر إلى الحركة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-252">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="f39a8-253">حدد **الأوامر** لعرض خيارات الأوامر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-253">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="f39a8-254">حدد **انتقاء الكل**، ثم عند المطالبة، حدد **أمر العميل**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-254">Select **Pick up all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="f39a8-255">في شريط البحث، أدخل **سياتل**، ثم حدد متجر **سياتل** للانتقاء.</span><span class="sxs-lookup"><span data-stu-id="f39a8-255">In the search bar, enter **Seattle**, and then select the **Seattle** store for pickup.</span></span> 
7. <span data-ttu-id="f39a8-256">حدد **موافق** لقبول التاريخ الحالي كتاريخ انتقاء.</span><span class="sxs-lookup"><span data-stu-id="f39a8-256">Select **OK** to accept the current date as the date of pickup.</span></span>
9. <span data-ttu-id="f39a8-257">حدد **بطاقة الدفع** لبدء الدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-257">Select **Pay card** to initiate the payment.</span></span>
10. <span data-ttu-id="f39a8-258">اعرض دفع البطاقة للمبلغ المستحق للإيداع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-258">Tender the card payment for the amount that is due for the deposit.</span></span> 
11. <span data-ttu-id="f39a8-259">أكمل دفع الوديعة في الوحدة الطرفية للدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-259">Complete the deposit payment on the payment terminal.</span></span> 
12. <span data-ttu-id="f39a8-260">بعد دفع الإيداع ، حدد خيار استخدام نفس البطاقة للوفاء ، وانتظر حتى يكتمل الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-260">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span> 
13. <span data-ttu-id="f39a8-261">ابدأ تشغيل نقطة البيع لمتجر ساتيل.</span><span class="sxs-lookup"><span data-stu-id="f39a8-261">Start the POS for the Seattle store.</span></span>
14. <span data-ttu-id="f39a8-262">في نقطة البيع ، في صفحة الترحيب، حدد عملية **الأوامر المراد انتقاؤها** للاطلاع على الأوامر الخاصة بعملية الانتقاء داخل المتجر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-262">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="f39a8-263">حدد سطرًا واحدًا أو أكثر من الأمر الذي تم إنشاؤه في واجهة المتجر المرجعية، ثم حدد **انتقاء**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-263">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="f39a8-264">تم استرداد الطلب من مكتب الدعم.</span><span class="sxs-lookup"><span data-stu-id="f39a8-264">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="f39a8-265">عندما يتم استرداد تفاصيل سطر الطلب من مكتب الدعم، ويتم الكشف عن دفع بطاقة يمكن استخدامه في قناة متعددة الاتجاهات، فأنت على علم بأن طريقة الدفع متاحة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-265">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="f39a8-266">حدد **استخدام طريقة دفع متاحة** لإكمال المعاملة باستخدام تفاصيل البطاقة التي تم إدخالها في واجهة المتجر المرجعية.</span><span class="sxs-lookup"><span data-stu-id="f39a8-266">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="f39a8-267">يتم تحميل أسطر الأوامر على صفحة المعاملة، والرصيد المستحق هو 0 (صفر).</span><span class="sxs-lookup"><span data-stu-id="f39a8-267">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="f39a8-268">حدد علامة التبويب **دفعات** لعرض بند الدفع الذي تم سحبه من الأمر عبر الإنترنت.</span><span class="sxs-lookup"><span data-stu-id="f39a8-268">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="f39a8-269">حدد أي طريقة دفع لإكمال المعاملة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-269">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-ship-to-customer"></a><span data-ttu-id="f39a8-270">شراء في المتجر A، شحن إلى العميل</span><span class="sxs-lookup"><span data-stu-id="f39a8-270">Buy in store A, ship to customer</span></span>

1. <span data-ttu-id="f39a8-271">ابدأ تشغيل نقطة البيع لمتجر هوستون.</span><span class="sxs-lookup"><span data-stu-id="f39a8-271">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="f39a8-272">في صفحة **الحركة**، أضف كارين بيرغ إلى الحركة باستخدام لوحه الأرقام لإدخال **2001**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-272">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="f39a8-273">أضف بند واحد أو أكثر إلى الحركة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-273">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="f39a8-274">حدد **الأوامر** لعرض خيارات الأوامر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-274">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="f39a8-275">حدد **شحن الكل**، ثم عند المطالبة، حدد **أمر العميل**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-275">Select **Ship all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="f39a8-276">في صفحة أسلوب الشحن، حدد **ليلي قياسي**، ثم حدد **موافق** لقبول تاريخ اليوم كتاريخ الشحن.</span><span class="sxs-lookup"><span data-stu-id="f39a8-276">In the shipping method page, select **Standard overnight**, and then select **OK** to accept today's date as the shipping date.</span></span> 
7. <span data-ttu-id="f39a8-277">حدد **موافق** لقبول التاريخ الحالي كتاريخ انتقاء.</span><span class="sxs-lookup"><span data-stu-id="f39a8-277">Select **OK** to accept the current date as the date of pickup.</span></span>
8. <span data-ttu-id="f39a8-278">حدد **بطاقة الدفع** لبدء الدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-278">Select **Pay card** to initiate the payment.</span></span>
9. <span data-ttu-id="f39a8-279">اعرض دفع البطاقة للمبلغ المستحق للإيداع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-279">Tender the card payment for the amount that is due for the deposit.</span></span> 
10. <span data-ttu-id="f39a8-280">أكمل دفع الوديعة في الوحدة الطرفية للدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-280">Complete the deposit payment on the payment terminal.</span></span> 
11. <span data-ttu-id="f39a8-281">بعد دفع الإيداع ، حدد خيار استخدام نفس البطاقة للوفاء ، وانتظر حتى يكتمل الأمر.</span><span class="sxs-lookup"><span data-stu-id="f39a8-281">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span>

<span data-ttu-id="f39a8-282">عند اختيار الطلب وتعبئته وفوترته في مكتب الدعم، سيتم استخدام تفاصيل الدفع التي يتم توفيرها في نقاط البيع لالتقاط الأموال للبضائع التي يتم شحنها إلى العميل.</span><span class="sxs-lookup"><span data-stu-id="f39a8-282">When the order is picked, packed, and invoiced in the back office, the payment details that are provided at the POS will be used to capture the funds for the goods that are being shipped to the customer.</span></span> 

## <a name="scenario-details"></a><span data-ttu-id="f39a8-283">تفاصيل السيناريو</span><span class="sxs-lookup"><span data-stu-id="f39a8-283">Scenario details</span></span>

<span data-ttu-id="f39a8-284">بالإضافة إلى السيناريوهات الأساسية التي تم وصفها للتو، تم إجراء العديد من التحسينات على مجموعة تطوير برامج الدفع لدعم دفعات القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-284">In addition to the basic scenarios that were just described, several enhancements have been made to the Payments SDK to support omni-channel payments.</span></span> 

### <a name="pos"></a><span data-ttu-id="f39a8-285">نقطة البيع</span><span class="sxs-lookup"><span data-stu-id="f39a8-285">POS</span></span>

#### <a name="single-swipedip-for-customer-orders"></a><span data-ttu-id="f39a8-286">مسح/تمرير واحد لأوامر العملاء</span><span class="sxs-lookup"><span data-stu-id="f39a8-286">Single swipe/dip for customer orders</span></span>

<span data-ttu-id="f39a8-287">قبل تنفيذ ميزة دفعات القناة متعددة الاتجاهات، عندما تم إنشاء أوامر العملاء التي تضمنت الودائع في نقاط البيع، كان يتعين على العملاء مسح (أو تمرير) بطاقتهم مرتين: مرة واحدة لدفع الإيداع ومرة واحدة لتذكير البطاقة لاستيفاء أمر لاحق.</span><span class="sxs-lookup"><span data-stu-id="f39a8-287">Before the omni-channel payments feature was implemented, when customer orders that included deposits were created at the POS, customers were required to swipe (or dip) their card two times: one time to pay the deposit and one time to tokenize the card for subsequent order fulfillment.</span></span> <span data-ttu-id="f39a8-288">عند تشغيل ميزة الرمز المميز للقناة متعددة الاتجاهات، يتعين على العملاء تمرير بطاقتهم مرة واحدة فقط لدفع الإيداع وتفويض المبلغ المستحق للسلع التي سيتم الوفاء بها لاحقًا.</span><span class="sxs-lookup"><span data-stu-id="f39a8-288">When the omni-channel tokenization feature is turned on, customers must swipe their card only one time to both pay the deposit and authorize the amount that is due for goods that will be fulfilled later.</span></span> <span data-ttu-id="f39a8-289">في وقت الوفاء ، يتم الحصول على الأموال المصرح بها.</span><span class="sxs-lookup"><span data-stu-id="f39a8-289">At the time of fulfillment, the authorized funds are captured.</span></span> <span data-ttu-id="f39a8-290">قبل تنفيذ ميزة رمز القناة متعددة الاتجاهات، تم إنشاء رمز مميز للبطاقة المتكررة للوفاء بالطلبات اللاحقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-290">Before the omni-channel tokenization feature was implemented, only a recurring card token was created for subsequent order fulfillment.</span></span> <span data-ttu-id="f39a8-291">لذلك ، لم يتم التصريح بأموال الوفاء المعلقة، ولأن هذه الأموال لم تكن محتجزة لهذا الشراء المحدد ، فقد كان من المحتمل أن يتم الاستيلاء عليها لاحقًا.</span><span class="sxs-lookup"><span data-stu-id="f39a8-291">Therefore, the funds for the pending fulfillment weren't authorized, and because those funds weren't being held for that specific purchase, it was less likely that they could be captured later.</span></span>

> [!NOTE]
> <span data-ttu-id="f39a8-292">التمرير المفرد غير مدعوم في إصدار Retail رقم 8.1.3.</span><span class="sxs-lookup"><span data-stu-id="f39a8-292">Single swipe isn't supported in Retail version 8.1.3.</span></span> <span data-ttu-id="f39a8-293">تستخدم أوامر العملاء في الإصدار 8.1.3 نفس التدفق الذي تم استخدامه قبل تطبيق ميزة ترميز رموز القناة متعددة الاتجاهات.</span><span class="sxs-lookup"><span data-stu-id="f39a8-293">Customer orders in version 8.1.3 use the same flow that was used before the omni-channel tokenization feature was implemented.</span></span> 

### <a name="cards-that-cant-issue-recurring-card-tokens"></a><span data-ttu-id="f39a8-294">البطاقات التي لا يمكنها إصدار رموز بطاقات متكررة</span><span class="sxs-lookup"><span data-stu-id="f39a8-294">Cards that can't issue recurring card tokens</span></span>

<span data-ttu-id="f39a8-295">لا يمكن استخدام بعض البطاقات لدفعات القناة متعددة الاتجاهات، لأنها لا تدعم إصدار الرموز المميزة للبطاقات المتكررة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-295">Some cards can't be used for omni-channel payments, because they don't support issuing recurring card tokens.</span></span> <span data-ttu-id="f39a8-296">عند إنشاء أمر في نقطة البيع، إذا تم دفع الإيداع باستخدام بطاقة لا تدعم الرموز المميزة للبطاقة المتكررة، فسيتم استخدام تدفق الرمز المميز للبطاقة السابق.</span><span class="sxs-lookup"><span data-stu-id="f39a8-296">When an order is created at the POS, if the deposit is paid by using a card that doesn't support recurring card tokens, the previous card tokenization flow is used.</span></span> <span data-ttu-id="f39a8-297">لذلك ، يجب على العميل الذي يرغب في تقديم دفعة يتم استخدامها لتنفيذ الأمر اللاحق تقديم بطاقة ثانية.</span><span class="sxs-lookup"><span data-stu-id="f39a8-297">Therefore, a customer who wants to provide a payment that will be used for subsequent order fulfillment must present a second card.</span></span> <span data-ttu-id="f39a8-298">إذا كانت البطاقة الثانية لا تدعم الرموز المميزة للبطاقات المتكررة ، فسيتم رفض إجراء الرمز المميز ، وسيُطلب من الكاشير مطالبة العميل بتقديم بطاقة مختلفة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-298">If the second card doesn't support recurring card tokens, the tokenization action will be declined, and the cashier will be prompted to ask the customer to provide a different card.</span></span> 

### <a name="using-a-different-card"></a><span data-ttu-id="f39a8-299">استخدام بطاقة مختلفة</span><span class="sxs-lookup"><span data-stu-id="f39a8-299">Using a different card</span></span>

<span data-ttu-id="f39a8-300">لدى العميل الذي يأتي إلى المتجر لاستلام الطلبات خيار استخدام بطاقة مختلفة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-300">A customer who comes to the store for order pickup has the option to use a different card.</span></span> <span data-ttu-id="f39a8-301">عندما يستلم الكاشير مطالبة **استخدام طريقة الدفع المتاحة** في وقت استلام الطلب ، يمكن له أو هي أن تسأل عما إذا كان العميل يريد استخدام نفس البطاقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-301">When the cashier receives the **Use available payment method** prompt at the time of order pickup, he or she can ask whether the customer wants to use the same card.</span></span> <span data-ttu-id="f39a8-302">إذا فقد العميل البطاقة التي تم استخدامها لإنشاء الأمر ويريد دفع ثمن الأمر باستخدام بطاقة مختلفة، يستطيع الكاشير تحديد **استخدام بطاقة دفع مختلفة**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-302">If the customer has lost the card that was used to create the order and wants to pay for the order by using a different card, the cashier can select **Use a different payment method**.</span></span> <span data-ttu-id="f39a8-303">إذا عاد العميل لاحقًا لالتقاط المزيد من العناصر لنفس الأمر، وإذا كان ترخيص البطاقة الأصلي لا يزال صالحًا، يستطيع الكاشير مرة أخرى أن يسأل عما إذا كان العميل يريد استخدام تلك البطاقة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-303">If the customer comes back later to pick up more items for the same order, if the original card authorization is still valid, the cashier can again ask whether the customer wants to use that card.</span></span>

### <a name="invalid-authorizations"></a><span data-ttu-id="f39a8-304">التخويلات غير الصالحة</span><span class="sxs-lookup"><span data-stu-id="f39a8-304">Invalid authorizations</span></span>

<span data-ttu-id="f39a8-305">إذا لم تعد البطاقة التي تم استخدامها لإنشاء أمر صالحة، عند اختيار المنتجات للاستلام، فسيفشل طلب التقاط الدفع.</span><span class="sxs-lookup"><span data-stu-id="f39a8-305">If the card that was used to create an order is no longer valid, when products are selected for pickup, the payment capture request will fail.</span></span> <span data-ttu-id="f39a8-306">سيحاول موصل الدفع نقطة البيع إنشاء ترخيص جديد والالتقاط باستخدام تفاصيل البطاقة نفسها.</span><span class="sxs-lookup"><span data-stu-id="f39a8-306">The POS payment connector will then try to create a new authorization and capture by using the same card details.</span></span> <span data-ttu-id="f39a8-307">في حالة فشل التفويض الجديد أو الالتقاط، سيتم إبلاغ الكاشير بأنه لا يمكن معالجة الدفعة.</span><span class="sxs-lookup"><span data-stu-id="f39a8-307">If the new authorization or capture fails, the cashier will be informed that the payment could not be processed.</span></span> <span data-ttu-id="f39a8-308">ويجب على الكاشير الحصول على دفعة جديدة من العميل.</span><span class="sxs-lookup"><span data-stu-id="f39a8-308">The cashier must then get a new payment from the customer.</span></span> 

### <a name="multiple-available-payments"></a><span data-ttu-id="f39a8-309">الدفعات المتعددة المتوفرة</span><span class="sxs-lookup"><span data-stu-id="f39a8-309">Multiple available payments</span></span>

<span data-ttu-id="f39a8-310">عندما يتم استلام أمر يحتوي على العديد من المناقصات والبنود المتعددة، يتلقى الكاشير أولاً مطالبة **استخدام طريقة الدفع المتاحة**.</span><span class="sxs-lookup"><span data-stu-id="f39a8-310">When an order that has multiple tenders and multiple lines is picked up, the cashier first receives the **Use available payment method** prompt.</span></span> <span data-ttu-id="f39a8-311">في حالة وجود بطاقات متعددة، عندما يحدد الكاشير **استخدام طريقة الدفع المتاحة**، سيتم التقاط بنود المناقصات الحالية للبطاقة حتى يتم تحقيق الرصيد للبضائع التي يتم التقاطها حاليًا.</span><span class="sxs-lookup"><span data-stu-id="f39a8-311">If there are multiple cards, when the cashier selects **Use available payment method**, existing card tender lines will be captured until the balance is met for the goods that are currently being picked up.</span></span> <span data-ttu-id="f39a8-312">لن يكون لدى الكاشير خيار تحديد البطاقة التي يجب استخدامها للبضائع التي يتم التقاطها.</span><span class="sxs-lookup"><span data-stu-id="f39a8-312">The cashier won't have the option to select the card that should be used for the goods that are being picked up.</span></span> 

## <a name="related-topics"></a><span data-ttu-id="f39a8-313">مواضيع مرتبطة</span><span class="sxs-lookup"><span data-stu-id="f39a8-313">Related topics</span></span>

- [<span data-ttu-id="f39a8-314">الأسئلة المتداولة حول الدفعات</span><span class="sxs-lookup"><span data-stu-id="f39a8-314">Payments FAQ</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/payments-retail)
- [<span data-ttu-id="f39a8-315">موصل دفع Dynamics 365 لـ Adyen</span><span class="sxs-lookup"><span data-stu-id="f39a8-315">Dynamics 365 Payment Connector for Adyen</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3)
- [<span data-ttu-id="f39a8-316">تكوين BOPIS في بيئة تقييم Dynamics 365 Commerce</span><span class="sxs-lookup"><span data-stu-id="f39a8-316">Configure BOPIS in a Dynamics 365 Commerce evaluation environment</span></span>](https://docs.microsoft.com/dynamics365/commerce/cpe-bopis)



[!INCLUDE[footer-include](../includes/footer-banner.md)]